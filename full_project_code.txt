Project: The Collegiate Grill POS System
Description: Full Source Code Context


==================================================
FILE PATH: src\app\admin\categories\page.tsx
==================================================
"use client";
import { useState, useEffect } from 'react';
import { createBrowserClient } from '@supabase/ssr';

interface Category {
    id: string;
    name: string;
    sort_order: number;
    items: { count: number }[]; // Supabaseì—ì„œ countë§Œ ê°€ì ¸ì˜¤ê¸° ìœ„í•œ íƒ€ì…
}

export default function AdminCategoriesPage() {
    const [categories, setCategories] = useState<Category[]>([]);
    const [loading, setLoading] = useState(true);

    const supabase = createBrowserClient(
        process.env.NEXT_PUBLIC_SUPABASE_URL!,
        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
    );

    useEffect(() => {
        fetchCategories();
    }, []);

    // ---------------------------------------------------------
    // ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° (ì•„ì´í…œ ê°œìˆ˜ í¬í•¨ & ìˆœì„œëŒ€ë¡œ ì •ë ¬)
    // ---------------------------------------------------------
    const fetchCategories = async () => {
        setLoading(true);
        // items(count)ëŠ” Supabaseì˜ ê°•ë ¥í•œ ê¸°ëŠ¥ìœ¼ë¡œ, ì‹¤ì œ ë°ì´í„°ë¥¼ ë‹¤ ì•ˆ ê°€ì ¸ì˜¤ê³  ê°œìˆ˜ë§Œ ì…‰ë‹ˆë‹¤.
        const { data, error } = await supabase
            .from('categories')
            .select('*, items(count)')
            .order('sort_order', { ascending: true });

        if (error) {
            alert("Error loading categories");
            console.error(error);
        } else {
            // items ë°°ì—´ì˜ ê¸¸ì´ë¥¼ countë¡œ ë³€í™˜í•˜ì—¬ ì €ì¥
            setCategories(data as any);
        }
        setLoading(false);
    };

    // ---------------------------------------------------------
    // ê¸°ëŠ¥ í•¸ë“¤ëŸ¬
    // ---------------------------------------------------------

    // 1. ì¹´í…Œê³ ë¦¬ ì¶”ê°€
    const handleAdd = async () => {
        const name = prompt("Enter new Category Name (e.g., 'Desserts')");
        if (!name) return;

        // í˜„ì¬ ê°€ì¥ í° sort_order ì°¾ê¸°
        const maxOrder = categories.length > 0 ? Math.max(...categories.map(c => c.sort_order)) : 0;

        // ì‹ë‹¹ ID ê°€ì ¸ì˜¤ê¸°
        const { data: restData } = await supabase.from('restaurants').select('id').single();
        if (!restData) return;

        const { error } = await supabase.from('categories').insert({
            restaurant_id: restData.id,
            name: name,
            sort_order: maxOrder + 1
        });

        if (!error) fetchCategories();
    };

    // 2. ì´ë¦„ ìˆ˜ì •
    const handleRename = async (id: string, currentName: string) => {
        const newName = prompt("Rename Category:", currentName);
        if (!newName || newName === currentName) return;

        const { error } = await supabase
            .from('categories')
            .update({ name: newName })
            .eq('id', id);

        if (!error) fetchCategories();
    };

    // 3. ì‚­ì œ
    const handleDelete = async (id: string, itemCount: number) => {
        if (itemCount > 0) {
            alert(`âš ï¸ Cannot delete!\nThis category contains ${itemCount} items.\nPlease move or delete the items first in 'Menu Management'.`);
            return;
        }

        if (!confirm("Are you sure you want to delete this empty category?")) return;

        await supabase.from('categories').delete().eq('id', id);
        fetchCategories();
    };

    // 4. ìˆœì„œ ë³€ê²½ (í•µì‹¬ ë¡œì§)
    const handleMove = async (index: number, direction: 'up' | 'down') => {
        if (direction === 'up' && index === 0) return;
        if (direction === 'down' && index === categories.length - 1) return;

        const targetIndex = direction === 'up' ? index - 1 : index + 1;

        // ë°°ì—´ ë³µì‚¬
        const newCategories = [...categories];
        const itemA = newCategories[index];
        const itemB = newCategories[targetIndex];

        // 1. í™”ë©´ìƒì—ì„œ ë¨¼ì € ìˆœì„œ ë°”ê¾¸ê¸° (Optimistic UI)
        newCategories[index] = itemB;
        newCategories[targetIndex] = itemA;
        setCategories(newCategories);

        // 2. DB ì—…ë°ì´íŠ¸ (sort_order ê°’ì„ ì„œë¡œ ë§êµí™˜)
        // Aì˜ ìˆœì„œë¥¼ Bì˜ ìˆœì„œê°’ìœ¼ë¡œ, Bì˜ ìˆœì„œë¥¼ Aì˜ ìˆœì„œê°’ìœ¼ë¡œ ì—…ë°ì´íŠ¸
        const { error: error1 } = await supabase
            .from('categories')
            .update({ sort_order: itemB.sort_order })
            .eq('id', itemA.id);

        const { error: error2 } = await supabase
            .from('categories')
            .update({ sort_order: itemA.sort_order })
            .eq('id', itemB.id);

        if (error1 || error2) {
            alert("Error reordering. Refreshing...");
            fetchCategories();
        }
    };

    return (
        <div className="p-10 max-w-4xl mx-auto min-h-screen">
            <div className="flex justify-between items-center mb-8">
                <div>
                    <h1 className="text-3xl font-bold text-gray-800">Category Management</h1>
                    <p className="text-gray-500 mt-1">Reorder tabs or rename categories.</p>
                </div>
                <button
                    onClick={handleAdd}
                    className="bg-blue-600 text-white px-5 py-3 rounded-xl font-bold hover:bg-blue-700 shadow-md flex items-center gap-2"
                >
                    <span>+</span> Create Category
                </button>
            </div>

            <div className="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden">
                {loading ? (
                    <div className="p-10 text-center text-gray-400">Loading...</div>
                ) : categories.length === 0 ? (
                    <div className="p-10 text-center text-gray-400">No categories found.</div>
                ) : (
                    <ul className="divide-y divide-gray-100">
                        {categories.map((cat, index) => {
                            // Supabase items(count) ê²°ê³¼ íŒŒì‹±
                            const itemCount = cat.items && cat.items[0] ? cat.items[0].count : 0;

                            return (
                                <li key={cat.id} className="p-4 flex items-center hover:bg-gray-50 transition-colors">

                                    {/* ìˆœì„œ ë³€ê²½ ë²„íŠ¼ */}
                                    <div className="flex flex-col mr-4 gap-1">
                                        <button
                                            onClick={() => handleMove(index, 'up')}
                                            disabled={index === 0}
                                            className="w-8 h-8 flex items-center justify-center rounded bg-gray-100 text-gray-600 hover:bg-blue-100 hover:text-blue-600 disabled:opacity-30 disabled:hover:bg-gray-100 disabled:cursor-not-allowed"
                                        >
                                            â–²
                                        </button>
                                        <button
                                            onClick={() => handleMove(index, 'down')}
                                            disabled={index === categories.length - 1}
                                            className="w-8 h-8 flex items-center justify-center rounded bg-gray-100 text-gray-600 hover:bg-blue-100 hover:text-blue-600 disabled:opacity-30 disabled:hover:bg-gray-100 disabled:cursor-not-allowed"
                                        >
                                            â–¼
                                        </button>
                                    </div>

                                    {/* ì¹´í…Œê³ ë¦¬ ì •ë³´ */}
                                    <div className="flex-1">
                                        <div className="flex items-center gap-3">
                                            <span className="text-lg font-bold text-gray-800">{cat.name}</span>
                                            <span className="text-xs px-2 py-1 bg-gray-100 rounded text-gray-500 font-bold">
                                                {itemCount} Items
                                            </span>
                                        </div>
                                    </div>

                                    {/* ì•¡ì…˜ ë²„íŠ¼ */}
                                    <div className="flex gap-3">
                                        <button
                                            onClick={() => handleRename(cat.id, cat.name)}
                                            className="px-4 py-2 border border-gray-200 rounded-lg text-gray-600 font-bold hover:bg-white hover:border-gray-400 transition-all text-sm"
                                        >
                                            Rename
                                        </button>
                                        <button
                                            onClick={() => handleDelete(cat.id, itemCount)}
                                            className={`px-4 py-2 rounded-lg font-bold text-sm transition-all
                        ${itemCount > 0
                                                    ? 'bg-gray-100 text-gray-400 cursor-not-allowed'
                                                    : 'bg-red-50 text-red-600 hover:bg-red-100'}`}
                                        >
                                            Delete
                                        </button>
                                    </div>
                                </li>
                            );
                        })}
                    </ul>
                )}
            </div>
        </div>
    );
}

==================================================
FILE PATH: src\app\admin\employees\page.tsx
==================================================
"use client";
import { useState, useEffect } from 'react';
import { createBrowserClient } from '@supabase/ssr';

export default function AdminEmployeesPage() {
  const [employees, setEmployees] = useState<any[]>([]);
  const [loading, setLoading] = useState(true);
  const [supabase] = useState(() => createBrowserClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  ));

  useEffect(() => { fetchEmployees(); }, []);

  const fetchEmployees = async () => {
    const { data } = await supabase.from('employees').select('*').order('id');
    if (data) setEmployees(data);
    setLoading(false);
  };

  const handleAddEmployee = async () => {
    const name = prompt("Enter Employee Name:");
    if (!name) return;
    const pin = prompt(`Enter 4-digit PIN for ${name}:`);
    if (!pin) return;

    const { error } = await supabase.from('employees').insert({ name, pin_code: pin });
    if (error) alert("Error: " + error.message);
    else fetchEmployees();
  };

  const handleDelete = async (id: number) => {
    if (!confirm("Delete this employee?")) return;
    await supabase.from('employees').delete().eq('id', id);
    fetchEmployees();
  };

  return (
    <div className="p-8 max-w-5xl mx-auto">
      <div className="flex justify-between items-center mb-8">
        <h1 className="text-3xl font-bold text-gray-800">Employee Management</h1>
        <button onClick={handleAddEmployee} className="bg-blue-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-blue-700">+ Add Employee</button>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {employees.map((emp) => (
          <div key={emp.id} className="bg-white p-6 rounded-2xl shadow-sm border border-gray-200 flex justify-between items-center">
            <div>
              <h3 className="text-xl font-bold text-gray-900">{emp.name}</h3>
              <p className="text-gray-500 font-mono text-sm mt-1">PIN: ****</p>
              <span className="inline-block mt-2 px-2 py-1 bg-gray-100 text-xs font-bold text-gray-600 rounded uppercase">{emp.role}</span>
            </div>
            <button onClick={() => handleDelete(emp.id)} className="text-red-500 hover:bg-red-50 p-2 rounded-lg font-bold">Delete</button>
          </div>
        ))}
      </div>
    </div>
  );
}

==================================================
FILE PATH: src\app\admin\layout.tsx
==================================================
// src/app/admin/layout.tsx
"use client";
import { useState } from 'react'; 
import Link from 'next/link';
import { usePathname, useRouter } from 'next/navigation';
import { createBrowserClient } from '@supabase/ssr';

export default function AdminLayout({ children }: { children: React.ReactNode }) {
  const pathname = usePathname();
  const router = useRouter();
  
  // useStateë¡œ ê°ì‹¸ì„œ ìµœì´ˆ 1íšŒë§Œ ìƒì„±ë˜ë„ë¡ ìœ ì§€
  const [supabase] = useState(() => createBrowserClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  ));

  const handleLogout = async () => {
    await supabase.auth.signOut();
    router.push('/login');
    router.refresh();
  };

  // âœ¨ [ìˆ˜ì •] Employeesì™€ Reports ë©”ë‰´ë¥¼ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.
  const menuItems = [
    { name: 'Dashboard', path: '/admin', icon: 'ğŸ ' },
    { name: 'Category Management', path: '/admin/categories', icon: 'ğŸ“‘' },
    { name: 'Menu Management', path: '/admin/menu', icon: 'ğŸ”' },
    { name: 'Modifier Management', path: '/admin/modifiers', icon: 'âœ…' },
    { name: 'Order History', path: '/admin/orders', icon: 'ğŸ§¾' },
    
    // âœ¨ ìƒˆë¡œ ì¶”ê°€ëœ ê¸°ëŠ¥ë“¤
    { name: 'Employees', path: '/admin/employees', icon: 'ğŸ‘¥' },
    { name: 'Reports', path: '/admin/reports', icon: 'ğŸ“Š' },
    
    // ì„¤ì • í˜ì´ì§€
    { name: 'Store Settings', path: '/admin/settings', icon: 'âš™ï¸' },
  ];

  return (
    <div className="flex h-screen bg-gray-100">
      <aside className="w-64 bg-gray-900 text-white flex flex-col shadow-xl z-20">
        <div className="h-20 flex items-center justify-center border-b border-gray-700">
          <h1 className="text-xl font-bold tracking-wider">ADMIN PORTAL</h1>
        </div>
        <nav className="flex-1 py-6 px-3 space-y-2">
          {menuItems.map((item) => {
            const isActive = pathname === item.path;
            return (
              <Link 
                key={item.path} 
                href={item.path}
                className={`flex items-center gap-3 px-4 py-3 rounded-xl transition-all font-medium
                  ${isActive 
                    ? 'bg-blue-600 text-white shadow-lg translate-x-1' 
                    : 'text-gray-400 hover:bg-gray-800 hover:text-white'}`}
              >
                <span className="text-xl">{item.icon}</span>
                <span>{item.name}</span>
              </Link>
            );
          })}
        </nav>
        <div className="p-4 border-t border-gray-800">
          <button 
            onClick={handleLogout}
            className="flex items-center gap-3 w-full px-4 py-3 text-red-400 hover:bg-gray-800 hover:text-red-300 rounded-xl transition-colors font-bold"
          >
            <span>ğŸšª</span>
            <span>Sign Out</span>
          </button>
        </div>
      </aside>
      <main className="flex-1 overflow-y-auto bg-gray-50 relative">
        {children}
      </main>
    </div>
  );
}

==================================================
FILE PATH: src\app\admin\menu\page.tsx
==================================================
"use client";
import { useState, useEffect } from 'react';
import { createBrowserClient } from '@supabase/ssr';

interface MenuItem {
  id: string;
  name: string;
  // âœ¨ [ì¶”ê°€] POS ì „ìš© ì´ë¦„ í•„ë“œ
  pos_name?: string | null; 
  price: number;
  description: string | null;
  is_available: boolean;
  category_id: string;
  image_url: string | null;
  sort_order: number;
  restaurant_id?: string;
  is_kiosk_visible?: boolean;
  is_pos_visible?: boolean;
}

export default function AdminMenuPage() {
  const [supabase] = useState(() => createBrowserClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  ));

  const [categories, setCategories] = useState<any[]>([]);
  const [selectedCatId, setSelectedCatId] = useState<string | null>(null);
  const [items, setItems] = useState<MenuItem[]>([]);
  const [editingId, setEditingId] = useState<string | null>(null);
  const [editForm, setEditForm] = useState<Partial<MenuItem>>({}); 

  useEffect(() => {
    fetchCategories();
  }, []);

  useEffect(() => {
    if (selectedCatId) fetchItems(selectedCatId);
  }, [selectedCatId]);

  const fetchCategories = async () => {
    const { data } = await supabase.from('categories').select('*').order('sort_order');
    if (data && data.length > 0) {
      setCategories(data);
      if (!selectedCatId) setSelectedCatId(data[0].id);
    }
  };

  const fetchItems = async (catId: string) => {
    const { data } = await supabase
      .from('items')
      .select('*')
      .eq('category_id', catId)
      .order('sort_order', { ascending: true });
    
    if (data) setItems(data);
  };

  const handleAddNewItem = async () => {
    if (!selectedCatId) return;
    const name = prompt("Enter new Item Name:");
    if (!name) return;

    const maxOrder = items.length > 0 ? Math.max(...items.map(i => i.sort_order || 0)) : 0;

    const { error } = await supabase.from('items').insert({
      restaurant_id: categories[0].restaurant_id, 
      category_id: selectedCatId,
      name: name,
      pos_name: '', // ì´ˆê¸°ê°’ ë¹ˆ ë¬¸ìì—´
      price: 0,
      description: '', 
      is_available: true,
      sort_order: maxOrder + 1,
      is_kiosk_visible: true,
      is_pos_visible: true
    });

    if (error) alert("Error adding item: " + error.message);
    else fetchItems(selectedCatId);
  };

  const startEditing = (item: MenuItem) => {
    setEditingId(item.id);
    setEditForm({ 
        ...item,
        description: item.description || '',
        pos_name: item.pos_name || '', // nullì´ë©´ ë¹ˆê°’ìœ¼ë¡œ
        is_kiosk_visible: item.is_kiosk_visible ?? true,
        is_pos_visible: item.is_pos_visible ?? true
    }); 
  };

  const saveItem = async () => {
    if (!editForm.name) return alert("Name is required");

    const { data, error } = await supabase
      .from('items')
      .update({
        name: editForm.name,
        // âœ¨ [ì €ì¥] POS Name ì €ì¥
        pos_name: editForm.pos_name, 
        description: editForm.description, 
        price: typeof editForm.price === 'string' ? parseFloat(editForm.price) : editForm.price,
        is_available: editForm.is_available,
        category_id: editForm.category_id,
        is_kiosk_visible: editForm.is_kiosk_visible,
        is_pos_visible: editForm.is_pos_visible
      })
      .eq('id', editingId)
      .select(); 

    if (error) {
      alert("Error saving: " + error.message);
    } else {
      if (data && data.length > 0) {
        setEditingId(null);
        fetchItems(selectedCatId!);
      } else {
        alert("Update failed. Check permissions.");
      }
    }
  };

  const handleDeleteItem = async (itemId: string) => {
    if (!confirm("Delete this item?")) return;
    await supabase.from('items').delete().eq('id', itemId);
    fetchItems(selectedCatId!);
  };

  const handleImageUpload = async (itemId: string, file: File) => {
    if (!confirm("Upload image?")) return;
    const fileExt = file.name.split('.').pop();
    const fileName = `${Date.now()}.${fileExt}`;
    const filePath = `items/${fileName}`;

    const { error: uploadError } = await supabase.storage
      .from('menu-images')
      .upload(filePath, file);

    if (uploadError) return alert("Upload Failed: " + uploadError.message);

    const { data: urlData } = supabase.storage.from('menu-images').getPublicUrl(filePath);

    await supabase.from('items').update({ image_url: urlData.publicUrl }).eq('id', itemId);
    alert("Image uploaded!");
    fetchItems(selectedCatId!);
  };

  const handleMoveItem = async (index: number, direction: 'prev' | 'next') => {
    if (direction === 'prev' && index === 0) return;
    if (direction === 'next' && index === items.length - 1) return;

    const targetIndex = direction === 'prev' ? index - 1 : index + 1;
    
    const newItems = [...items];
    const temp = newItems[index];
    newItems[index] = newItems[targetIndex];
    newItems[targetIndex] = temp;
    
    setItems(newItems); 

    const updates = newItems.map((item, idx) => ({
        id: item.id,
        sort_order: idx + 1 
    }));

    try {
        const updatePromises = updates.map(u => 
            supabase.from('items').update({ sort_order: u.sort_order }).eq('id', u.id)
        );
        await Promise.all(updatePromises);
    } catch (error) {
        console.error("Reorder failed", error);
        alert("Failed to save order.");
        fetchItems(selectedCatId!); 
    }
  };

  return (
    <div className="flex h-screen bg-gray-50">
      <div className="w-64 bg-white border-r flex flex-col">
        <div className="p-5 border-b bg-gray-100">
          <h2 className="text-lg font-bold text-gray-800">Filter by Category</h2>
        </div>
        <ul className="overflow-y-auto flex-1 p-2 space-y-1">
          {categories.map(cat => (
            <li 
              key={cat.id}
              onClick={() => { setSelectedCatId(cat.id); setEditingId(null); }}
              className={`p-3 cursor-pointer rounded-lg font-medium transition-all flex justify-between
                ${selectedCatId === cat.id ? 'bg-blue-600 text-white shadow-md' : 'text-gray-600 hover:bg-gray-100'}`}
            >
              <span>{cat.name}</span>
              {selectedCatId === cat.id && <span>ğŸ‘‰</span>}
            </li>
          ))}
        </ul>
      </div>

      <div className="flex-1 p-8 overflow-y-auto">
        <div className="flex justify-between items-center mb-6">
          <div>
            <h1 className="text-2xl font-bold text-gray-800">Menu Items</h1>
            <p className="text-gray-500 text-sm">
              Current Category: <span className="font-bold text-blue-600">{categories.find(c => c.id === selectedCatId)?.name}</span>
            </p>
          </div>
          <button onClick={handleAddNewItem} className="bg-green-600 text-white px-5 py-2 rounded-lg hover:bg-green-700 font-bold shadow-sm flex items-center gap-2">
            <span>+</span> New Item
          </button>
        </div>

        {items.length === 0 ? (
          <div className="text-center py-20 bg-white rounded-xl border border-dashed border-gray-300">
            <p className="text-gray-400">No items in this category.</p>
            <button onClick={handleAddNewItem} className="text-blue-500 font-bold mt-2 hover:underline">Create one?</button>
          </div>
        ) : (
          <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
            {items.map((item, index) => {
              const isEditing = editingId === item.id;
              const displayData = isEditing ? (editForm as MenuItem) : item;

              return (
                <div key={item.id} className={`bg-white p-5 rounded-2xl shadow-sm border transition-all 
                  ${isEditing ? 'ring-2 ring-blue-500 border-transparent shadow-xl z-10 scale-[1.02]' : 'border-gray-200'}`}>
                  
                  {!isEditing && (
                    <div className="flex justify-between mb-2">
                        <button onClick={() => handleMoveItem(index, 'prev')} disabled={index === 0} className="text-gray-400 hover:text-blue-600 disabled:opacity-20 text-lg font-bold px-2">â—€</button>
                        <span className="text-xs text-gray-300 pt-1">Order: {item.sort_order}</span>
                        <button onClick={() => handleMoveItem(index, 'next')} disabled={index === items.length - 1} className="text-gray-400 hover:text-blue-600 disabled:opacity-20 text-lg font-bold px-2">â–¶</button>
                    </div>
                  )}

                  <div className="aspect-square bg-gray-100 rounded-xl relative overflow-hidden group mb-4 flex items-center justify-center">
                      {displayData.image_url ? (
                        <img src={displayData.image_url} alt={displayData.name} className="w-full h-full object-cover" onError={(e) => { e.currentTarget.style.display = 'none'; }} />
                      ) : ( <span className="text-gray-400 text-sm font-bold">No Image</span> )}
                      <label className="absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer text-white font-bold text-sm z-20">
                        Change Photo
                        <input type="file" className="hidden" accept="image/*" onChange={(e) => e.target.files?.[0] && handleImageUpload(item.id, e.target.files[0])} />
                      </label>
                  </div>

                  <div className="space-y-3">
                    {isEditing && (
                      <div className="bg-yellow-50 p-2 rounded border border-yellow-200">
                        <label className="text-xs text-gray-500 font-bold uppercase block mb-1">Move Category</label>
                        <select
                          value={editForm.category_id}
                          onChange={(e) => setEditForm(prev => ({ ...prev, category_id: e.target.value }))}
                          className="w-full p-1 bg-white border border-gray-300 rounded text-sm font-bold text-gray-800"
                        >
                          {categories.map(cat => (<option key={cat.id} value={cat.id}>{cat.name}</option>))}
                        </select>
                      </div>
                    )}

                    <div>
                      <label className="text-xs text-gray-400 font-bold uppercase">Item Name</label>
                      <input 
                        type="text" 
                        disabled={!isEditing}
                        value={displayData.name || ''}
                        onChange={(e) => setEditForm(prev => ({ ...prev, name: e.target.value }))}
                        className={`w-full text-lg font-bold bg-transparent outline-none border-b-2 py-1 ${isEditing ? 'border-blue-500 text-gray-900' : 'border-transparent text-gray-800'}`}
                      />
                    </div>

                    {/* âœ¨ [ì¶”ê°€] POS Name ì…ë ¥ì¹¸ */}
                    <div>
                        <label className="text-xs text-blue-500 font-bold uppercase">POS Name (Short)</label>
                        {isEditing ? (
                            <input 
                                type="text"
                                value={editForm.pos_name || ''} 
                                onChange={(e) => setEditForm(prev => ({ ...prev, pos_name: e.target.value }))}
                                placeholder="(Optional) Name for POS only"
                                className="w-full text-sm font-medium bg-blue-50 border-b-2 border-blue-200 focus:border-blue-500 outline-none py-1 px-1 rounded-t"
                            />
                        ) : (
                            <p className="text-sm text-gray-600 min-h-[1.2rem] font-medium">
                                {displayData.pos_name ? <span className="text-blue-600">ğŸ–¥ï¸ {displayData.pos_name}</span> : <span className="text-gray-300 text-xs">Same as Name</span>}
                            </p>
                        )}
                    </div>

                    <div>
                        <label className="text-xs text-gray-400 font-bold uppercase">Description</label>
                        {isEditing ? (
                            <textarea
                                value={editForm.description || ''} 
                                onChange={(e) => setEditForm(prev => ({ ...prev, description: e.target.value }))}
                                rows={2}
                                className="w-full text-sm bg-gray-50 border border-gray-300 rounded p-2 mt-1 resize-none focus:outline-none focus:border-blue-500"
                                placeholder="Enter item description..."
                            />
                        ) : (
                            <p className="text-sm text-gray-500 mt-1 line-clamp-2 min-h-[1.5rem]">
                                {displayData.description || <span className="text-gray-300 italic">No description</span>}
                            </p>
                        )}
                    </div>
                    
                    <div className="flex justify-between gap-4">
                       <div className="flex-1">
                          <label className="text-xs text-gray-400 font-bold uppercase">Price ($)</label>
                          <input 
                              type="number" step="0.01" disabled={!isEditing}
                              value={displayData.price}
                              onChange={(e) => setEditForm((prev: any) => ({ ...prev, price: e.target.value }))}
                              className={`w-full text-lg font-bold bg-transparent outline-none border-b-2 py-1 ${isEditing ? 'border-blue-500 text-gray-900' : 'border-transparent text-gray-800'}`}
                            />
                       </div>
                       <div className="flex items-end pb-2">
                          <button 
                            disabled={!isEditing}
                            onClick={() => setEditForm(prev => ({ ...prev, is_available: !prev.is_available }))}
                            className={`text-xs font-bold px-3 py-1 rounded-full transition-colors ${displayData.is_available ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}
                          >
                            {displayData.is_available ? 'IN STOCK' : 'SOLD OUT'}
                          </button>
                       </div>
                    </div>

                    {isEditing && (
                        <div className="grid grid-cols-2 gap-2 mt-2 pt-2 border-t border-gray-100">
                            <label className="flex items-center space-x-2 cursor-pointer bg-gray-50 p-2 rounded hover:bg-gray-100">
                                <input 
                                    type="checkbox" 
                                    checked={editForm.is_kiosk_visible ?? true}
                                    onChange={(e) => setEditForm(prev => ({ ...prev, is_kiosk_visible: e.target.checked }))}
                                    className="w-4 h-4 text-blue-600 rounded"
                                />
                                <span className="text-xs font-bold text-gray-600">Show on Kiosk</span>
                            </label>
                            <label className="flex items-center space-x-2 cursor-pointer bg-gray-50 p-2 rounded hover:bg-gray-100">
                                <input 
                                    type="checkbox" 
                                    checked={editForm.is_pos_visible ?? true}
                                    onChange={(e) => setEditForm(prev => ({ ...prev, is_pos_visible: e.target.checked }))}
                                    className="w-4 h-4 text-green-600 rounded"
                                />
                                <span className="text-xs font-bold text-gray-600">Show on POS</span>
                            </label>
                        </div>
                    )}
                    
                    {!isEditing && (
                        <div className="flex gap-2 mt-1">
                            {!displayData.is_kiosk_visible && <span className="text-[10px] bg-gray-200 text-gray-500 px-2 py-0.5 rounded border border-gray-300">Hidden on Kiosk</span>}
                            {!displayData.is_pos_visible && <span className="text-[10px] bg-gray-200 text-gray-500 px-2 py-0.5 rounded border border-gray-300">Hidden on POS</span>}
                        </div>
                    )}

                  </div>

                  <div className="mt-4 pt-4 border-t flex justify-between items-center">
                    {isEditing ? (
                      <>
                        <button onClick={() => handleDeleteItem(item.id)} className="text-red-500 text-sm font-bold hover:underline px-2">Delete</button>
                        <div className="flex gap-2">
                          <button onClick={() => setEditingId(null)} className="px-3 py-2 text-gray-600 font-bold hover:bg-gray-100 rounded-lg text-sm">Cancel</button>
                          <button onClick={saveItem} className="px-5 py-2 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 shadow-md text-sm">Save</button>
                        </div>
                      </>
                    ) : (
                      <button onClick={() => startEditing(item)} className="w-full py-2 bg-gray-50 text-gray-600 font-bold rounded-lg hover:bg-gray-100 border border-gray-200 text-sm">Edit Item</button>
                    )}
                  </div>
                </div>
              );
            })}
          </div>
        )}
      </div>
    </div>
  );
}

==================================================
FILE PATH: src\app\admin\modifiers\page.tsx
==================================================
"use client";
import { useState, useEffect } from 'react';
import { createBrowserClient } from '@supabase/ssr';

// íƒ€ì… ì •ì˜
interface ModifierGroup {
    id: string;
    name: string;
}
interface ModifierOption {
    id: string;
    name: string;
    price: number;
    sort_order: number; // âœ¨ [New] ìˆœì„œ í•„ë“œ ì¶”ê°€
}
interface SimpleItem {
    id: string;
    name: string;
    category_id: string; 
}

export default function AdminModifiersPage() {
    const supabase = createBrowserClient(
        process.env.NEXT_PUBLIC_SUPABASE_URL!,
        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
    );

    // ë°ì´í„° ìƒíƒœ
    const [groups, setGroups] = useState<ModifierGroup[]>([]);
    const [selectedGroup, setSelectedGroup] = useState<ModifierGroup | null>(null);

    const [options, setOptions] = useState<ModifierOption[]>([]);
    const [linkedItemIds, setLinkedItemIds] = useState<string[]>([]); 
    const [allItems, setAllItems] = useState<SimpleItem[]>([]); 

    // ì˜µì…˜ ìˆ˜ì •ìš© ìƒíƒœ
    const [editingOptionId, setEditingOptionId] = useState<string | null>(null);
    const [editOptionForm, setEditOptionForm] = useState({ name: '', price: 0 });

    // ë¡œë”© ìƒíƒœ
    const [loadingOptions, setLoadingOptions] = useState(false);

    // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
    useEffect(() => {
        fetchGroups();
        fetchAllItems();
    }, []);

    useEffect(() => {
        if (selectedGroup) {
            fetchOptions(selectedGroup.id);
            fetchLinkedItems(selectedGroup.id);
            setEditingOptionId(null); 
        } else {
            setOptions([]);
            setLinkedItemIds([]);
        }
    }, [selectedGroup]);

    // ---------------------------------------------------------
    // Fetch Functions
    // ---------------------------------------------------------
    const fetchGroups = async () => {
        const { data } = await supabase.from('modifier_groups').select('*').order('name');
        if (data) setGroups(data);
    };

    const fetchAllItems = async () => {
        const { data } = await supabase.from('items').select('id, name, category_id').order('name');
        if (data) setAllItems(data);
    };

    const fetchOptions = async (groupId: string) => {
        setLoadingOptions(true);
        // âœ¨ [ìˆ˜ì •] ì •ë ¬ ê¸°ì¤€ì„ price -> sort_order ë¡œ ë³€ê²½
        const { data } = await supabase
            .from('modifiers')
            .select('*')
            .eq('group_id', groupId)
            .order('sort_order', { ascending: true }); 
        if (data) setOptions(data);
        setLoadingOptions(false);
    };

    const fetchLinkedItems = async (groupId: string) => {
        const { data } = await supabase.from('item_modifier_groups').select('item_id').eq('group_id', groupId);
        if (data) {
            setLinkedItemIds(data.map(d => d.item_id));
        }
    };

    // ---------------------------------------------------------
    // Handlers (Groups)
    // ---------------------------------------------------------
    const handleAddGroup = async () => {
        const name = prompt("Enter new Group Name (e.g., 'Steak Temperature')");
        if (!name) return;

        const { data: restData } = await supabase.from('restaurants').select('id').single();
        if (!restData) return alert("Restaurant not found");

        const { error } = await supabase.from('modifier_groups').insert({
            restaurant_id: restData.id,
            name: name
        });

        if (!error) fetchGroups();
        else alert(error.message);
    };

    const handleDeleteGroup = async (id: string) => {
        if (!confirm("Delete this group? All options inside it will be deleted.")) return;
        await supabase.from('modifier_groups').delete().eq('id', id);
        setSelectedGroup(null);
        fetchGroups();
    };

    // ---------------------------------------------------------
    // Handlers (Options - Add, Edit, Delete, Move)
    // ---------------------------------------------------------
    const handleAddOption = async () => {
        if (!selectedGroup) return;
        const name = prompt("Enter Option Name (e.g., 'Medium Rare')");
        if (!name) return;
        const priceStr = prompt("Enter Price (0 for free)", "0");
        const price = parseFloat(priceStr || "0");

        // âœ¨ [New] í˜„ì¬ ê°€ì¥ í° ìˆœì„œ ë²ˆí˜¸ ì°¾ê¸° (ë§¨ ë’¤ì— ì¶”ê°€í•˜ê¸° ìœ„í•´)
        const maxOrder = options.length > 0 ? Math.max(...options.map(o => o.sort_order || 0)) : 0;

        await supabase.from('modifiers').insert({
            group_id: selectedGroup.id,
            name,
            price,
            sort_order: maxOrder + 1 // âœ¨ ìˆœì„œ ë¶€ì—¬
        });
        fetchOptions(selectedGroup.id);
    };

    const handleDeleteOption = async (id: string) => {
        if (!confirm("Delete this option?")) return;
        await supabase.from('modifiers').delete().eq('id', id);
        if (selectedGroup) fetchOptions(selectedGroup.id);
    };

    const startEditingOption = (opt: ModifierOption) => {
        setEditingOptionId(opt.id);
        setEditOptionForm({ name: opt.name, price: opt.price });
    };

    const handleUpdateOption = async () => {
        if (!editingOptionId || !selectedGroup) return;
        if (!editOptionForm.name) return alert("Name is required");

        const { error } = await supabase
            .from('modifiers')
            .update({
                name: editOptionForm.name,
                price: editOptionForm.price
            })
            .eq('id', editingOptionId);

        if (error) {
            alert("Error updating: " + error.message);
        } else {
            setEditingOptionId(null);
            fetchOptions(selectedGroup.id);
        }
    };

    // âœ¨ [New] ì˜µì…˜ ìˆœì„œ ë³€ê²½ í•¸ë“¤ëŸ¬
    const handleMoveOption = async (index: number, direction: 'up' | 'down') => {
        if (direction === 'up' && index === 0) return;
        if (direction === 'down' && index === options.length - 1) return;
    
        const targetIndex = direction === 'up' ? index - 1 : index + 1;
        
        // UI ë‚™ê´€ì  ì—…ë°ì´íŠ¸
        const newOptions = [...options];
        const optA = newOptions[index];
        const optB = newOptions[targetIndex];
        
        newOptions[index] = optB;
        newOptions[targetIndex] = optA;
        setOptions(newOptions);
    
        // DB ì—…ë°ì´íŠ¸ (ì„œë¡œì˜ sort_order êµí™˜)
        // ì£¼ì˜: DBì— sort_orderê°€ nullì¸ ë°ì´í„°ê°€ ìˆë‹¤ë©´ 0ìœ¼ë¡œ ì·¨ê¸‰
        const orderA = optA.sort_order || 0;
        const orderB = optB.sort_order || 0;

        // ë§Œì•½ ë‘˜ì˜ sort_orderê°€ ê°™ë‹¤ë©´(ì´ˆê¸°ìƒíƒœ), ì¸ë±ìŠ¤ ê¸°ë°˜ìœ¼ë¡œ ì¬ì •ë ¬ í•„ìš”í•  ìˆ˜ ìˆìŒ.
        // ì—¬ê¸°ì„œëŠ” ë‹¨ìˆœ êµí™˜ ë°©ì‹ ì‚¬ìš©
        const { error: e1 } = await supabase.from('modifiers').update({ sort_order: orderB }).eq('id', optA.id);
        const { error: e2 } = await supabase.from('modifiers').update({ sort_order: orderA }).eq('id', optB.id);
    
        if (e1 || e2) {
            console.error("Reorder failed", e1, e2);
            if (selectedGroup) fetchOptions(selectedGroup.id); // ì‹¤íŒ¨ ì‹œ ì›ë³µ
        }
    };

    // ---------------------------------------------------------
    // Handlers (Linking Items)
    // ---------------------------------------------------------
    const toggleItemLink = async (itemId: string, isLinked: boolean) => {
        if (!selectedGroup) return;

        if (isLinked) {
            const { error } = await supabase
                .from('item_modifier_groups')
                .delete()
                .eq('item_id', itemId)
                .eq('group_id', selectedGroup.id);

            if (!error) {
                setLinkedItemIds(prev => prev.filter(id => id !== itemId));
            }
        } else {
            const { error } = await supabase
                .from('item_modifier_groups')
                .insert({
                    item_id: itemId,
                    group_id: selectedGroup.id
                });

            if (!error) {
                setLinkedItemIds(prev => [...prev, itemId]);
            }
        }
    };

    return (
        <div className="flex h-screen bg-gray-100 overflow-hidden">

            {/* 1. ì¢Œì¸¡: Modifier Groups ëª©ë¡ */}
            <div className="w-1/4 bg-white border-r flex flex-col min-w-[250px]">
                <div className="p-4 border-b flex justify-between items-center bg-gray-50">
                    <h2 className="font-bold text-gray-800">1. Groups</h2>
                    <button onClick={handleAddGroup} className="text-xs bg-blue-600 text-white px-2 py-1 rounded hover:bg-blue-700">+ Add</button>
                </div>
                <ul className="flex-1 overflow-y-auto p-2 space-y-1">
                    {groups.map(group => (
                        <li
                            key={group.id}
                            onClick={() => setSelectedGroup(group)}
                            className={`p-3 rounded-lg cursor-pointer flex justify-between group items-center
                ${selectedGroup?.id === group.id ? 'bg-blue-100 text-blue-800 font-bold border-blue-200 border' : 'hover:bg-gray-50 text-gray-600'}`}
                        >
                            <span>{group.name}</span>
                            {selectedGroup?.id === group.id && (
                                <button
                                    onClick={(e) => { e.stopPropagation(); handleDeleteGroup(group.id); }}
                                    className="text-red-400 hover:text-red-600 px-2"
                                >
                                    Ã—
                                </button>
                            )}
                        </li>
                    ))}
                </ul>
            </div>

            {/* 2. ì¤‘ì•™: Options ê´€ë¦¬ (ìˆ˜ì •/ì‚­ì œ/ìˆœì„œë³€ê²½ ê¸°ëŠ¥ í†µí•©) */}
            <div className="w-1/3 bg-white border-r flex flex-col min-w-[350px]">
                <div className="p-4 border-b flex justify-between items-center bg-gray-50">
                    <h2 className="font-bold text-gray-800">
                        2. Options for: <span className="text-blue-600">{selectedGroup?.name || '-'}</span>
                    </h2>
                    <button
                        onClick={handleAddOption}
                        disabled={!selectedGroup}
                        className="text-xs bg-green-600 text-white px-2 py-1 rounded hover:bg-green-700 disabled:opacity-50"
                    >
                        + Add Option
                    </button>
                </div>

                <div className="flex-1 overflow-y-auto p-4 bg-gray-50">
                    {!selectedGroup ? (
                        <div className="text-center text-gray-400 mt-10">Select a group first</div>
                    ) : loadingOptions ? (
                        <div className="text-center text-gray-400 mt-10">Loading...</div>
                    ) : (
                        <ul className="space-y-3">
                            {options.length === 0 && <p className="text-sm text-gray-400 text-center">No options yet.</p>}
                            
                            {options.map((opt, index) => {
                                const isEditing = editingOptionId === opt.id;

                                return (
                                    <li key={opt.id} className={`bg-white p-3 rounded shadow-sm border flex flex-col gap-2 
                                        ${isEditing ? 'ring-2 ring-blue-500 border-transparent' : 'border-gray-200'}`}>
                                        
                                        {isEditing ? (
                                            // [ìˆ˜ì • ëª¨ë“œ]
                                            <div className="space-y-2">
                                                <div>
                                                    <label className="text-xs text-gray-400 font-bold">Name</label>
                                                    <input 
                                                        type="text" 
                                                        value={editOptionForm.name}
                                                        onChange={(e) => setEditOptionForm(prev => ({...prev, name: e.target.value}))}
                                                        className="w-full border-b border-blue-500 outline-none text-sm font-bold"
                                                    />
                                                </div>
                                                <div className="flex items-center gap-2">
                                                    <label className="text-xs text-gray-400 font-bold">Price($)</label>
                                                    <input 
                                                        type="number" 
                                                        step="0.01"
                                                        value={editOptionForm.price}
                                                        onChange={(e) => setEditOptionForm(prev => ({...prev, price: parseFloat(e.target.value) || 0}))}
                                                        className="w-20 border-b border-blue-500 outline-none text-sm font-bold"
                                                    />
                                                </div>
                                                <div className="flex justify-end gap-2 mt-2">
                                                    <button 
                                                        onClick={() => setEditingOptionId(null)}
                                                        className="px-2 py-1 text-xs text-gray-500 hover:bg-gray-100 rounded"
                                                    >
                                                        Cancel
                                                    </button>
                                                    <button 
                                                        onClick={handleUpdateOption}
                                                        className="px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 font-bold"
                                                    >
                                                        Save
                                                    </button>
                                                </div>
                                            </div>
                                        ) : (
                                            // [ë³´ê¸° ëª¨ë“œ]
                                            <div className="flex justify-between items-center">
                                                <div className="flex items-center gap-3">
                                                    {/* âœ¨ [New] ìˆœì„œ ë³€ê²½ í™”ì‚´í‘œ */}
                                                    <div className="flex flex-col">
                                                        <button 
                                                            onClick={() => handleMoveOption(index, 'up')}
                                                            disabled={index === 0}
                                                            className="text-gray-300 hover:text-blue-600 disabled:opacity-0 text-[10px] leading-none"
                                                        >
                                                            â–²
                                                        </button>
                                                        <button 
                                                            onClick={() => handleMoveOption(index, 'down')}
                                                            disabled={index === options.length - 1}
                                                            className="text-gray-300 hover:text-blue-600 disabled:opacity-0 text-[10px] leading-none"
                                                        >
                                                            â–¼
                                                        </button>
                                                    </div>

                                                    <div>
                                                        <span className="font-bold text-gray-800">{opt.name}</span>
                                                        {opt.price > 0 && <span className="text-sm text-green-600 ml-2">(+${opt.price})</span>}
                                                    </div>
                                                </div>

                                                <div className="flex gap-1">
                                                    <button
                                                        onClick={() => startEditingOption(opt)}
                                                        className="text-blue-400 hover:text-blue-600 text-xs font-bold px-2 py-1 bg-blue-50 hover:bg-blue-100 rounded"
                                                    >
                                                        Edit
                                                    </button>
                                                    <button
                                                        onClick={() => handleDeleteOption(opt.id)}
                                                        className="text-red-400 hover:text-red-600 text-xs font-bold px-2 py-1 bg-red-50 hover:bg-red-100 rounded"
                                                    >
                                                        Del
                                                    </button>
                                                </div>
                                            </div>
                                        )}
                                    </li>
                                );
                            })}
                        </ul>
                    )}
                </div>
            </div>

            {/* 3. ìš°ì¸¡: ì—°ê²°ëœ ì•„ì´í…œ (Link Items) */}
            <div className="flex-1 bg-white flex flex-col">
                <div className="p-4 border-b bg-gray-50">
                    <h2 className="font-bold text-gray-800">3. Apply to Items</h2>
                    <p className="text-xs text-gray-500">Check items that use the <span className="font-bold text-blue-600">{selectedGroup?.name || '...'}</span> group.</p>
                </div>

                <div className="flex-1 overflow-y-auto p-4">
                    {!selectedGroup ? (
                        <div className="text-center text-gray-400 mt-10">Select a group to manage links</div>
                    ) : (
                        <div className="grid grid-cols-2 lg:grid-cols-3 gap-3">
                            {allItems.map(item => {
                                const isLinked = linkedItemIds.includes(item.id);
                                return (
                                    <label
                                        key={item.id}
                                        className={`flex items-center p-3 border rounded cursor-pointer transition-all select-none
                      ${isLinked ? 'bg-blue-50 border-blue-300 ring-1 ring-blue-300' : 'hover:bg-gray-50 border-gray-200'}`}
                                    >
                                        <input
                                            type="checkbox"
                                            className="w-5 h-5 text-blue-600 rounded focus:ring-blue-500 mr-3"
                                            checked={isLinked}
                                            onChange={() => toggleItemLink(item.id, isLinked)}
                                        />
                                        <span className={`text-sm ${isLinked ? 'font-bold text-gray-800' : 'text-gray-600'}`}>
                                            {item.name}
                                        </span>
                                    </label>
                                );
                            })}
                        </div>
                    )}
                </div>
            </div>

        </div>
    );
}

==================================================
FILE PATH: src\app\admin\orders\page.tsx
==================================================
"use client";
import { useState, useEffect } from 'react';
import { createBrowserClient } from '@supabase/ssr';

// ë°ì´í„° íƒ€ì… ì •ì˜
interface OrderItem {
    item_name: string;
    quantity: number;
    price: number;
    options: any; // JSONB ë°ì´í„°
}

interface Order {
    id: string;
    total_amount: number;
    status: string;
    table_number: string | null;
    created_at: string;
    order_items: OrderItem[];
}

export default function AdminOrdersPage() {
    const [orders, setOrders] = useState<Order[]>([]);
    const [loading, setLoading] = useState(true);

    // Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
    const supabase = createBrowserClient(
        process.env.NEXT_PUBLIC_SUPABASE_URL!,
        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
    );

    useEffect(() => {
        fetchOrders();

        // ì‹¤ì‹œê°„ ì£¼ë¬¸ êµ¬ë… (ìƒˆ ì£¼ë¬¸ì´ ë“¤ì–´ì˜¤ë©´ ìë™ ê°±ì‹ )
        const channel = supabase
            .channel('realtime_orders')
            .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'orders' }, () => {
                console.log('New order received!');
                fetchOrders();
            })
            .subscribe();

        return () => {
            supabase.removeChannel(channel);
        };
    }, []);

    const fetchOrders = async () => {
        setLoading(true);
        const { data, error } = await supabase
            .from('orders')
            .select(`
        *,
        order_items (
          item_name,
          quantity,
          price,
          options
        )
      `)
            .order('created_at', { ascending: false }); // ìµœì‹ ìˆœ ì •ë ¬

        if (error) {
            console.error('Error fetching orders:', error);
        } else {
            setOrders(data || []);
        }
        setLoading(false);
    };

    const formatDate = (dateString: string) => {
        return new Date(dateString).toLocaleString('en-US', {
            month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit'
        });
    };

    return (
        <div className="p-8 max-w-6xl mx-auto min-h-screen bg-gray-50">
            <div className="flex justify-between items-center mb-8">
                <h1 className="text-3xl font-bold text-gray-800">Order History</h1>
                <button
                    onClick={fetchOrders}
                    className="bg-white border border-gray-300 px-4 py-2 rounded-lg text-gray-700 font-bold hover:bg-gray-50 shadow-sm flex items-center gap-2"
                >
                    <span>â†»</span> Refresh
                </button>
            </div>

            {loading ? (
                <div className="text-center py-20 text-gray-500 font-medium">Loading orders...</div>
            ) : orders.length === 0 ? (
                <div className="text-center py-20 bg-white rounded-2xl shadow-sm border border-gray-200">
                    <p className="text-xl text-gray-400 font-bold">No orders found yet.</p>
                </div>
            ) : (
                <div className="space-y-4">
                    {orders.map((order) => (
                        <div key={order.id} className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">

                            {/* ì£¼ë¬¸ í—¤ë” */}
                            <div className="bg-gray-100 px-6 py-4 flex flex-col md:flex-row justify-between items-start md:items-center gap-4 border-b border-gray-200">
                                <div className="flex flex-wrap gap-4 items-center">
                                    <span className="font-bold text-gray-700 text-lg">
                                        #{order.id.slice(0, 8).toUpperCase()}
                                    </span>

                                    {/* í…Œì´ë¸” ë²ˆí˜¸ ë°°ì§€ */}
                                    {order.table_number ? (
                                        <span className="bg-red-600 text-white px-3 py-1 rounded-lg font-extrabold text-xl shadow-sm animate-pulse">
                                            Table #{order.table_number}
                                        </span>
                                    ) : (
                                        <span className="bg-gray-200 text-gray-600 px-3 py-1 rounded-lg font-bold text-sm">
                                            Take Out
                                        </span>
                                    )}

                                    <span className="text-sm text-gray-500 font-medium">
                                        {formatDate(order.created_at)}
                                    </span>
                                </div>

                                <div className="flex items-center gap-4 self-end md:self-auto">
                                    <span className={`px-3 py-1 rounded-full text-xs font-bold uppercase
                    ${order.status === 'completed' ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700'}`}
                                    >
                                        {order.status}
                                    </span>
                                    <span className="text-2xl font-extrabold text-gray-900">
                                        ${order.total_amount.toFixed(2)}
                                    </span>
                                </div>
                            </div>

                            {/* ì£¼ë¬¸ ìƒì„¸ */}
                            <div className="p-6 bg-white">
                                <ul className="space-y-3">
                                    {order.order_items.map((item, idx) => (
                                        <li key={idx} className="flex justify-between items-start border-b border-gray-50 last:border-0 pb-3 last:pb-0">
                                            <div>
                                                <div className="flex items-center gap-2">
                                                    <span className="font-bold text-red-600 text-lg">{item.quantity}x</span>
                                                    <span className="font-bold text-gray-800 text-lg">{item.item_name}</span>
                                                </div>
                                                {item.options && Array.isArray(item.options) && item.options.length > 0 && (
                                                    <div className="text-sm text-gray-500 mt-1 ml-6 font-medium">
                                                        {item.options.map((opt: any, i: number) => (
                                                            <span key={i} className="block">
                                                                + {opt.name} {opt.price > 0 && `($${opt.price})`}
                                                            </span>
                                                        ))}
                                                    </div>
                                                )}
                                            </div>
                                            <span className="font-bold text-gray-700">
                                                ${item.price.toFixed(2)}
                                            </span>
                                        </li>
                                    ))}
                                </ul>
                            </div>
                        </div>
                    ))}
                </div>
            )}
        </div>
    );
}

==================================================
FILE PATH: src\app\admin\page.tsx
==================================================
// src/app/admin/page.tsx
import Link from 'next/link';

export default function AdminDashboard() {
    return (
        <div className="p-10">
            <h1 className="text-3xl font-bold text-gray-800 mb-2">Welcome Back, Manager! ğŸ‘‹</h1>
            <p className="text-gray-500 mb-8">Here is an overview of your restaurant.</p>

            {/* ë°”ë¡œê°€ê¸° ì¹´ë“œë“¤ */}
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">

                {/* ë©”ë‰´ ê´€ë¦¬ ë°”ë¡œê°€ê¸° */}
                <Link
                    href="/admin/menu"
                    className="bg-white p-6 rounded-2xl shadow-sm border border-gray-200 hover:shadow-md hover:border-blue-500 transition-all group cursor-pointer"
                >
                    <div className="flex justify-between items-start mb-4">
                        <div className="p-3 bg-blue-50 rounded-xl text-3xl group-hover:scale-110 transition-transform">ğŸ”</div>
                    </div>
                    <h2 className="text-xl font-bold text-gray-800 mb-1">Menu Management</h2>
                    <p className="text-sm text-gray-500">
                        Add items, update prices, manage stock.
                    </p>
                </Link>

                {/* ì£¼ë¬¸ ë‚´ì—­ ë°”ë¡œê°€ê¸° */}
                <Link
                    href="/admin/orders"
                    className="bg-white p-6 rounded-2xl shadow-sm border border-gray-200 hover:shadow-md hover:border-green-500 transition-all group cursor-pointer"
                >
                    <div className="flex justify-between items-start mb-4">
                        <div className="p-3 bg-green-50 rounded-xl text-3xl group-hover:scale-110 transition-transform">ğŸ§¾</div>
                    </div>
                    <h2 className="text-xl font-bold text-gray-800 mb-1">Order History</h2>
                    <p className="text-sm text-gray-500">
                        Check real-time orders and revenue.
                    </p>
                </Link>

            </div>
        </div>
    );
}

==================================================
FILE PATH: src\app\admin\reports\page.tsx
==================================================
"use client";
import { useState, useEffect } from 'react';
import { createBrowserClient } from '@supabase/ssr';

// ë°ì´í„° íƒ€ì… ì •ì˜
interface FinancialReportItem {
  report_date: string;
  total_orders: number;
  gross_sales: number;
  net_sales: number;
  total_tax: number;
  total_tips: number;
  cash_sales: number;
  card_sales: number;
  card_txn_count: number;
  // ê³„ì‚°ëœ í•„ë“œ
  stripe_fee?: number;
  doordash_sales?: number;
}

export default function AdminReportsPage() {
  const [supabase] = useState(() => createBrowserClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  ));

  // ë‚ ì§œ ì„¤ì • (ê¸°ë³¸ê°’: ì˜¤ëŠ˜)
  const today = new Date().toISOString().split('T')[0];
  const [startDate, setStartDate] = useState(today);
  const [endDate, setEndDate] = useState(today);

  // íƒ­ ìƒíƒœ
  const [activeTab, setActiveTab] = useState('financial'); // ê¸°ë³¸ê°’ì„ financialë¡œ ë³€ê²½
  
  // ë°ì´í„° ìƒíƒœ
  const [reportData, setReportData] = useState<any[]>([]);
  const [loading, setLoading] = useState(false);

  // ìš”ì•½ í†µê³„ ìƒíƒœ
  const [summary, setSummary] = useState({
    cashSales: 0,
    cardSales: 0,
    tips: 0,
    tax: 0,
    stripeFee: 0,
    doorDash: 0,
    grandTotal: 0
  });

  useEffect(() => {
    fetchReport();
  }, [activeTab, startDate, endDate]);

  const fetchReport = async () => {
    setLoading(true);
    let rpcName = '';
    let params = { start_date: startDate, end_date: endDate };

    // íƒ­ì— ë”°ë¼ í˜¸ì¶œí•  DB í•¨ìˆ˜ ê²°ì •
    if (activeTab === 'financial') rpcName = 'get_financial_report';
    else if (activeTab === 'employee') rpcName = 'get_sales_by_employee'; // ê¸°ì¡´ í•¨ìˆ˜ ìœ ì§€
    else if (activeTab === 'item') rpcName = 'get_sales_by_item';         // ê¸°ì¡´ í•¨ìˆ˜ ìœ ì§€

    const { data, error } = await supabase.rpc(rpcName, params);

    if (error) {
      console.error("Report Error:", error);
      alert("Failed to load report");
      setReportData([]);
    } else {
      let fetchedData = data || [];

      // Financial íƒ­ì¼ ê²½ìš° ì¶”ê°€ ê³„ì‚° (Stripe Fee ë“±)
      if (activeTab === 'financial') {
        let sumCash = 0;
        let sumCard = 0;
        let sumTips = 0;
        let sumTax = 0;
        let sumStripe = 0;
        let sumDoorDash = 0; // í˜„ì¬ëŠ” 0
        let sumTotal = 0;

        fetchedData = fetchedData.map((item: FinancialReportItem) => {
          // Stripe Fee ê³„ì‚°: (ì¹´ë“œë§¤ì¶œ * 2.7%) + (ì¹´ë“œê²°ì œê±´ìˆ˜ * $0.05)
          const stripeFee = (item.card_sales * 0.027) + (item.card_txn_count * 0.05);
          
          // ëˆ„ì  í•©ê³„ ê³„ì‚°
          sumCash += item.cash_sales;
          sumCard += item.card_sales;
          sumTips += item.total_tips;
          sumTax += item.total_tax;
          sumStripe += stripeFee;
          sumTotal += item.net_sales;

          return { ...item, stripe_fee: stripeFee, doordash_sales: 0 };
        });

        setSummary({
          cashSales: sumCash,
          cardSales: sumCard,
          tips: sumTips,
          tax: sumTax,
          stripeFee: sumStripe,
          doorDash: sumDoorDash,
          grandTotal: sumTotal
        });
      }

      setReportData(fetchedData);
    }
    setLoading(false);
  };

  // ë‚ ì§œ í”„ë¦¬ì…‹ ë²„íŠ¼
  const setDateRange = (days: number) => {
    const end = new Date();
    const start = new Date();
    start.setDate(end.getDate() - days);
    setEndDate(end.toISOString().split('T')[0]);
    setStartDate(start.toISOString().split('T')[0]);
  };

  return (
    <div className="p-6 max-w-7xl mx-auto min-h-screen bg-gray-50">
      <div className="flex justify-between items-center mb-6">
        <h1 className="text-3xl font-black text-gray-800">ğŸ“Š Admin Reports</h1>
        {/* ë‚ ì§œ í‘œì‹œ */}
        <div className="bg-white px-4 py-2 rounded-lg shadow-sm border border-gray-200 text-gray-600 font-bold">
           {startDate} ~ {endDate}
        </div>
      </div>

      {/* 1. ë‚ ì§œ ì„ íƒ íŒ¨ë„ */}
      <div className="bg-white p-5 rounded-2xl shadow-sm border border-gray-200 mb-6">
        <div className="flex flex-wrap gap-4 items-end justify-between">
          <div className="flex gap-4 items-center">
             <div>
                <label className="block text-xs font-bold text-gray-500 uppercase mb-1">Start</label>
                <input type="date" value={startDate} onChange={(e) => setStartDate(e.target.value)} className="border border-gray-300 rounded-lg p-2 font-bold text-gray-700 outline-none focus:border-blue-500" />
             </div>
             <span className="text-gray-400 font-bold pb-2">-</span>
             <div>
                <label className="block text-xs font-bold text-gray-500 uppercase mb-1">End</label>
                <input type="date" value={endDate} onChange={(e) => setEndDate(e.target.value)} className="border border-gray-300 rounded-lg p-2 font-bold text-gray-700 outline-none focus:border-blue-500" />
             </div>
          </div>
          <div className="flex gap-2">
            <button onClick={() => setDateRange(0)} className="px-4 py-2 bg-blue-50 text-blue-600 hover:bg-blue-100 rounded-lg text-sm font-bold">Today</button>
            <button onClick={() => setDateRange(1)} className="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-bold text-gray-600">Yesterday</button>
            <button onClick={() => setDateRange(7)} className="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-bold text-gray-600">Last 7 Days</button>
            <button onClick={() => setDateRange(30)} className="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-bold text-gray-600">This Month</button>
          </div>
        </div>
      </div>

      {/* 2. íƒ­ ë©”ë‰´ */}
      <div className="flex gap-6 mb-6 border-b border-gray-200">
        <button onClick={() => setActiveTab('financial')} className={`pb-3 px-2 text-lg font-bold transition-all border-b-4 ${activeTab === 'financial' ? 'border-blue-600 text-blue-600' : 'border-transparent text-gray-400'}`}>ğŸ’° Financial</button>
        <button onClick={() => setActiveTab('employee')} className={`pb-3 px-2 text-lg font-bold transition-all border-b-4 ${activeTab === 'employee' ? 'border-blue-600 text-blue-600' : 'border-transparent text-gray-400'}`}>ğŸ‘¤ By Employee</button>
        <button onClick={() => setActiveTab('item')} className={`pb-3 px-2 text-lg font-bold transition-all border-b-4 ${activeTab === 'item' ? 'border-blue-600 text-blue-600' : 'border-transparent text-gray-400'}`}>ğŸ” By Item</button>
      </div>

      {/* 3. Financial Summary Cards (Financial íƒ­ì¼ ë•Œë§Œ í‘œì‹œ) */}
      {activeTab === 'financial' && (
        <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8">
            <SummaryCard title="Cash Sales" amount={summary.cashSales} color="green" />
            <SummaryCard title="Card Sales" amount={summary.cardSales} color="blue" />
            <SummaryCard title="Tips (Payout)" amount={summary.tips} color="purple" />
            <SummaryCard title="Sales Tax (7%)" amount={summary.tax} color="gray" />
            <SummaryCard title="Stripe Fee" amount={summary.stripeFee} color="red" isFee />
            <SummaryCard title="DoorDash" amount={summary.doorDash} color="orange" />
        </div>
      )}

      {/* 4. ë¦¬í¬íŠ¸ í…Œì´ë¸” */}
      <div className="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden">
        {loading ? (
          <div className="p-20 text-center text-gray-400 font-bold animate-pulse">Loading Data...</div>
        ) : (
          <div className="overflow-x-auto">
            <table className="w-full text-left">
              <thead className="bg-gray-50 text-gray-500 uppercase text-xs font-bold border-b border-gray-200">
                <tr>
                  {activeTab === 'financial' && (
                    <>
                        <th className="p-4">Date</th>
                        <th className="p-4 text-right text-green-600">Cash</th>
                        <th className="p-4 text-right text-blue-600">Card</th>
                        <th className="p-4 text-right">Tips</th>
                        <th className="p-4 text-right">Tax</th>
                        <th className="p-4 text-right text-red-500">Stripe Fee</th>
                        <th className="p-4 text-right text-orange-500">DoorDash</th>
                        <th className="p-4 text-right font-black">Total Revenue</th>
                    </>
                  )}
                  {activeTab === 'employee' && (
                    <>
                        <th className="p-4">Employee</th>
                        <th className="p-4 text-right">Orders</th>
                        <th className="p-4 text-right">Total Sales</th>
                    </>
                  )}
                  {activeTab === 'item' && (
                    <>
                        <th className="p-4">Item Name</th>
                        <th className="p-4 text-right">Qty</th>
                        <th className="p-4 text-right">Total Sales</th>
                    </>
                  )}
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-100">
                {reportData.map((row, idx) => (
                  <tr key={idx} className="hover:bg-gray-50 transition-colors text-sm font-medium text-gray-700">
                    {activeTab === 'financial' && (
                        <>
                            <td className="p-4 font-bold">{row.report_date}</td>
                            <td className="p-4 text-right text-green-700">${row.cash_sales.toFixed(2)}</td>
                            <td className="p-4 text-right text-blue-700">${row.card_sales.toFixed(2)}</td>
                            <td className="p-4 text-right">${row.total_tips.toFixed(2)}</td>
                            <td className="p-4 text-right">${row.total_tax.toFixed(2)}</td>
                            <td className="p-4 text-right text-red-600">-${row.stripe_fee?.toFixed(2)}</td>
                            <td className="p-4 text-right text-orange-600">${row.doordash_sales?.toFixed(2)}</td>
                            <td className="p-4 text-right font-black text-gray-900">${row.net_sales.toFixed(2)}</td>
                        </>
                    )}
                    {activeTab === 'employee' && (
                        <>
                            <td className="p-4">{row.employee_name}</td>
                            <td className="p-4 text-right">{row.total_orders}</td>
                            <td className="p-4 text-right font-bold">${(row.total_revenue || 0).toFixed(2)}</td>
                        </>
                    )}
                    {activeTab === 'item' && (
                        <>
                            <td className="p-4">{row.item_name}</td>
                            <td className="p-4 text-right">{row.total_quantity}</td>
                            <td className="p-4 text-right font-bold">${(row.total_revenue || 0).toFixed(2)}</td>
                        </>
                    )}
                  </tr>
                ))}
                {reportData.length === 0 && (
                    <tr><td colSpan={8} className="p-10 text-center text-gray-400">No data found.</td></tr>
                )}
              </tbody>
            </table>
          </div>
        )}
      </div>
    </div>
  );
}

// ìš”ì•½ ì¹´ë“œ ì»´í¬ë„ŒíŠ¸
function SummaryCard({ title, amount, color, isFee = false }: { title: string, amount: number, color: string, isFee?: boolean }) {
    const colorClasses: {[key: string]: string} = {
        green: "bg-green-50 border-green-200 text-green-700",
        blue: "bg-blue-50 border-blue-200 text-blue-700",
        purple: "bg-purple-50 border-purple-200 text-purple-700",
        red: "bg-red-50 border-red-200 text-red-700",
        orange: "bg-orange-50 border-orange-200 text-orange-700",
        gray: "bg-gray-50 border-gray-200 text-gray-700",
    };

    return (
        <div className={`p-4 rounded-2xl border-2 ${colorClasses[color]} flex flex-col items-start shadow-sm`}>
            <span className="text-xs font-bold uppercase opacity-70 mb-1">{title}</span>
            <span className="text-2xl font-black tracking-tight">
                {isFee ? '-' : ''}${amount.toFixed(2)}
            </span>
        </div>
    );
}

==================================================
FILE PATH: src\app\admin\settings\page.tsx
==================================================
"use client";

import { useState, useEffect } from 'react';
import { createBrowserClient } from '@supabase/ssr';

export default function AdminSettingsPage() {
  const [loading, setLoading] = useState(true);
  const [isTableRequired, setIsTableRequired] = useState(true);

  const supabase = createBrowserClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  );

  // 1. í˜ì´ì§€ ë¡œë“œ ì‹œ í˜„ì¬ ì„¤ì • ê°€ì ¸ì˜¤ê¸°
  useEffect(() => {
    fetchSettings();
  }, []);

  const fetchSettings = async () => {
    setLoading(true);
    // ê°€ì¥ ìµœê·¼(ë˜ëŠ” ìœ ì¼í•œ) ì„¤ì • row ê°€ì ¸ì˜¤ê¸°
    const { data, error } = await supabase
      .from('store_settings')
      .select('*')
      .limit(1)
      .single();

    if (data) {
      setIsTableRequired(data.is_table_number_required);
    }
    setLoading(false);
  };

  // 2. í† ê¸€ ë³€ê²½ ì‹œ DB ì—…ë°ì´íŠ¸
  const toggleTableSetting = async () => {
    const newValue = !isTableRequired;
    setIsTableRequired(newValue); // UI ì¦‰ì‹œ ë°˜ì˜

    // DB ì—…ë°ì´íŠ¸ (idê°€ 1ì¸ rowë¼ê³  ê°€ì •í•˜ê±°ë‚˜, ë¡œì§ì— ë”°ë¼ ì²˜ë¦¬)
    // ì—¬ê¸°ì„œëŠ” ê°€ì¥ ì²« ë²ˆì§¸ í–‰ì„ ì—…ë°ì´íŠ¸í•œë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.
    // ì‹¤ë¬´ì—ì„œëŠ” idë¥¼ ëª…í™•íˆ ì§€ì •í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.
    const { error } = await supabase
      .from('store_settings')
      .update({ is_table_number_required: newValue })
      .gt('id', 0); // ëª¨ë“  id ëŒ€ìƒ (ë³´í†µ rowê°€ 1ê°œë¿ì´ë¯€ë¡œ)

    if (error) {
      alert("ì €ì¥ ì‹¤íŒ¨: " + error.message);
      setIsTableRequired(!newValue); // ì‹¤íŒ¨ ì‹œ ì›ë³µ
    }
  };

  if (loading) return <div className="p-10">Loading settings...</div>;

  return (
    <div className="p-8 max-w-4xl mx-auto">
      <h1 className="text-3xl font-bold mb-8 text-gray-800">Store Settings</h1>

      <div className="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 className="text-xl font-bold mb-4 border-b pb-2">Kiosk Options</h2>
        
        {/* ì˜µì…˜ 1: í…Œì´ë¸” ë²ˆí˜¸ ì…ë ¥ ì—¬ë¶€ */}
        <div className="flex items-center justify-between py-4">
          <div>
            <h3 className="text-lg font-semibold text-gray-900">Require Table Number</h3>
            <p className="text-gray-500 text-sm">
              If disabled, the Table Number modal will be skipped during checkout.
            </p>
          </div>
          
          {/* í† ê¸€ ìŠ¤ìœ„ì¹˜ UI */}
          <button
            onClick={toggleTableSetting}
            className={`relative inline-flex h-8 w-14 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 ${
              isTableRequired ? 'bg-green-500' : 'bg-gray-300'
            }`}
          >
            <span
              className={`inline-block h-6 w-6 transform rounded-full bg-white transition-transform ${
                isTableRequired ? 'translate-x-7' : 'translate-x-1'
              }`}
            />
          </button>
        </div>

        {/* ì¶”í›„ ì—¬ê¸°ì— ë‹¤ë¥¸ ì˜µì…˜ë“¤(íŒ í™”ë©´ ë“±)ì„ ê³„ì† ì¶”ê°€í•˜ë©´ ë©ë‹ˆë‹¤ */}
        {/* <div className="flex items-center justify-between py-4 border-t">...</div> */}

      </div>
    </div>
  );
}

==================================================
FILE PATH: src\app\api\clover\order\route.ts
==================================================
// src/app/api/clover/order/route.ts
import { NextResponse } from 'next/server';
import axios from 'axios';

// í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ
const CLOVER_URL = process.env.CLOVER_API_URL;
const MID = process.env.CLOVER_MERCHANT_ID;
const TOKEN = process.env.CLOVER_API_TOKEN;
const TENDER_ID = process.env.CLOVER_TENDER_ID; // Clover ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ë§Œë“  'External/Stripe' ê²°ì œìˆ˜ë‹¨ ID
const ORDER_TYPE_DINE_IN = process.env.CLOVER_ORDER_TYPE_DINE_IN;
const ORDER_TYPE_TO_GO = process.env.CLOVER_ORDER_TYPE_TO_GO;

const headers = {
  'Authorization': `Bearer ${TOKEN}`,
  'Content-Type': 'application/json',
};

// â³ ë”œë ˆì´ í•¨ìˆ˜: Clover ì„œë²„ê°€ ìˆ¨ ì‰´ í‹ˆì„ ì¤ë‹ˆë‹¤ (0.1ì´ˆ)
const delay = (ms: number) => new Promise(resolve => setTimeout(resolve, ms));

export async function POST(request: Request) {
  try {
    const body = await request.json();
    const { items, totalAmount, tableNumber, orderType, tipAmount } = body;

    // 1. ì£¼ë¬¸ ìœ í˜• (Dine In / To Go)
    let selectedOrderTypeId = ORDER_TYPE_DINE_IN; 
    if (orderType === 'to_go') {
        selectedOrderTypeId = ORDER_TYPE_TO_GO;
    }

    console.log(`ğŸš€ Clover Sync Start: Table ${tableNumber} | Total $${totalAmount}`);

    // [Step 1] ë¹ˆ ì£¼ë¬¸ì„œ(Order) ìƒì„±
    const orderRes = await axios.post<any>(`${CLOVER_URL}/v3/merchants/${MID}/orders`, {
      state: 'open',
      title: tableNumber ? `Table #${tableNumber}` : 'Kiosk Order',
      total: Math.round(totalAmount * 100),
      manualTransaction: false, // ì¤‘ìš”: ì‚¬ëŒì´ ì§ì ‘ ì°ì€ ê²Œ ì•„ë‹˜ì„ í‘œì‹œ
      orderType: selectedOrderTypeId ? { id: selectedOrderTypeId } : undefined
    }, { headers });
    
    const orderId = orderRes.data.id;
    console.log(`   - Order Created: ${orderId}`);

    // [Step 2] ë©”ë‰´ ì•„ì´í…œ í•˜ë‚˜ì”© ì…ë ¥ (ìˆœì°¨ ì²˜ë¦¬ + ë”œë ˆì´)
    // âš ï¸ Promise.allì„ ì“°ë©´ ë™ì‹œ ì ‘ì† ê³¼ë‹¤ë¡œ ì—ëŸ¬ê°€ ë°œìƒí•˜ë¯€ë¡œ forë¬¸ ì‚¬ìš© í•„ìˆ˜
    for (const item of items) {
      const unitPriceCents = Math.round((item.totalPrice || item.price) * 100);
      
      const payload = {
        name: item.name,
        price: unitPriceCents,
        unitQty: item.quantity || 1,
        userData: null 
      };

      try {
        await axios.post(`${CLOVER_URL}/v3/merchants/${MID}/orders/${orderId}/line_items`, 
            payload, 
            { headers }
        );
        // âœ¨ ë§ˆë²•ì˜ ì½”ë“œ: 0.1ì´ˆ ëŒ€ê¸° (ì´ê²Œ ìˆì–´ì•¼ Too Many Requests ì—ëŸ¬ê°€ ì•ˆ ë‚©ë‹ˆë‹¤)
        await delay(100); 
      } catch (err) {
        console.error(`   ! Item failed (${item.name}):`, err);
        // í•˜ë‚˜ ì‹¤íŒ¨í•´ë„ ë©ˆì¶”ì§€ ì•Šê³  ë‹¤ìŒ ê²ƒ ê¸°ë¡
      }
    }

    // [Step 2.5] íŒì´ ìˆë‹¤ë©´ í•­ëª©ìœ¼ë¡œ ì¶”ê°€
    if (tipAmount && tipAmount > 0) {
        try {
            await axios.post(`${CLOVER_URL}/v3/merchants/${MID}/orders/${orderId}/line_items`, {
                name: "Tip / Gratuity",
                price: Math.round(tipAmount * 100),
                unitQty: 1
            }, { headers });
            await delay(100);
        } catch (e) { console.error("   ! Tip add failed"); }
    }

    // [Step 3] ê²°ì œ "ì™„ë£Œ ì²˜ë¦¬" (ëˆì€ Stripeê°€ ë°›ì•˜ê³ , ì¥ë¶€ì—ë§Œ 'ë°›ì•˜ë‹¤'ê³  ê¸°ë¡)
    // ì‹¤ì œ ì¹´ë“œë¥¼ ê¸ëŠ” ê³¼ì •ì´ ì•„ë‹ˆë¼, 'ì´ë¯¸ ë°›ìŒ' ë„ì¥ì„ ì°ëŠ” ê³¼ì •ì…ë‹ˆë‹¤.
    await axios.post(`${CLOVER_URL}/v3/merchants/${MID}/orders/${orderId}/payments`, {
      tender: { id: TENDER_ID }, // 'Stripe' ë˜ëŠ” 'External'ë¡œ ì„¤ì •ëœ Tender ID
      amount: Math.round(totalAmount * 100),
      result: "SUCCESS",
      tipAmount: 0,
      externalPaymentId: `STRIPE-${Date.now()}` // ë‚˜ì¤‘ì— ëŒ€ì¡°í•˜ê¸° ì‰½ê²Œ ID ë‚¨ê¹€
    }, { headers });

    // [Step 4] ì£¼ë¬¸ ì ê¸ˆ (ìˆ˜ì • ë¶ˆê°€ ìƒíƒœë¡œ ë³€ê²½)
    await axios.post(`${CLOVER_URL}/v3/merchants/${MID}/orders/${orderId}`, 
        { state: 'locked' }, 
        { headers }
    );

    console.log(`âœ… Clover Sync Complete (ID: ${orderId})`);
    return NextResponse.json({ success: true, orderId });

  } catch (error: any) {
    const status = error.response?.status;
    const msg = error.response?.data?.message || error.message;
    console.error(`âŒ Clover Sync Failed [${status}]:`, msg);
    
    // ì—ëŸ¬ê°€ ë‚˜ë”ë¼ë„ í‚¤ì˜¤ìŠ¤í¬ëŠ” ë©ˆì¶”ì§€ ì•Šë„ë¡ ì²˜ë¦¬
    return NextResponse.json({ success: false, error: msg }, { status: 500 });
  }
}

==================================================
FILE PATH: src\app\api\clover\tenders\route.ts
==================================================
// src/app/api/clover/tenders/route.ts
import { NextResponse } from 'next/server';
import axios from 'axios';

const CLOVER_URL = process.env.CLOVER_API_URL;
const MID = process.env.CLOVER_MERCHANT_ID;
const TOKEN = process.env.CLOVER_API_TOKEN;

export async function GET() {
  try {
    // ë‚´ ê°€ê²Œì˜ ëª¨ë“  ê²°ì œ ìˆ˜ë‹¨(Tender) ê°€ì ¸ì˜¤ê¸°
    const res = await axios.get(`${CLOVER_URL}/v3/merchants/${MID}/tenders`, {
      headers: { 'Authorization': `Bearer ${TOKEN}` }
    });

    console.log("====== [ MY CLOVER TENDERS ] ======");
    res.data.elements.forEach((t: any) => {
      console.log(`Label: ${t.label} | ID: ${t.id}`);
    });
    console.log("===================================");

    return NextResponse.json(res.data);
  } catch (error: any) {
    console.error(error);
    return NextResponse.json({ error: error.message });
  }
}

==================================================
FILE PATH: src\app\api\display\route.ts
==================================================
import { NextResponse } from 'next/server';

// âœ¨ [í•µì‹¬] ì„œë²„ê°€ ì¬ì‹œì‘ë˜ì–´ë„ ìœ ì§€ë˜ë„ë¡ ì „ì—­ ë³€ìˆ˜(globalThis)ì— ì €ì¥í•©ë‹ˆë‹¤.
// ì´ë ‡ê²Œ ì•ˆ í•˜ë©´ Next.jsê°€ ê°€ë” ë©”ëª¨ë¦¬ë¥¼ ë¹„ì›Œë²„ë ¤ì„œ "3ê°œ ì´ë¯¸ì§€"ë§Œ ë‚˜ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
const globalStore = globalThis as unknown as { 
  posDisplayState: any 
};

// ì´ˆê¸°ê°’ ì„¤ì •
if (!globalStore.posDisplayState) {
  globalStore.posDisplayState = {
    mode: 'IDLE',
    cart: [],
    total: 0,
    activeItemName: '',
    availableGroups: [],
    lastUpdated: Date.now()
  };
}

export async function GET() {
  // ì†ë‹˜ í™”ë©´ì´ ë¬¼ì–´ë³¼ ë•Œ
  return NextResponse.json(globalStore.posDisplayState);
}

export async function POST(req: Request) {
  try {
    const body = await req.json();
    
    // ìƒíƒœ ì—…ë°ì´íŠ¸
    globalStore.posDisplayState = {
      ...body,
      lastUpdated: Date.now()
    };

    // ğŸ” [ë””ë²„ê¹… ë¡œê·¸] í„°ë¯¸ë„ì—ì„œ ì´ ë¡œê·¸ê°€ ì°íˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”!
    console.log(`ğŸ“¡ [API] ìƒíƒœ ì—…ë°ì´íŠ¸ë¨: ${body.mode} (Total: $${body.total})`);

    return NextResponse.json({ success: true });
  } catch (error) {
    console.error("âŒ [API] ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:", error);
    return NextResponse.json({ success: false }, { status: 500 });
  }
}

==================================================
FILE PATH: src\app\api\orders\create\route.ts
==================================================
import { createClient } from '@supabase/supabase-js';
import { NextResponse } from 'next/server';

const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
);

export async function POST(request: Request) {
  try {
    const body = await request.json();
    const { 
      items, 
      subtotal, 
      tax, 
      tip, 
      total, 
      paymentMethod, 
      orderType, 
      tableNum,
      employeeName,
      status,
      transactionId 
    } = body;

    console.log(`ğŸ“ DB ì €ì¥ ì‹œì‘... (Type: ${orderType}, Status: ${status || 'paid'})`);

    // 1. Orders í…Œì´ë¸” ì €ì¥
    const { data: orderData, error: orderError } = await supabase
      .from('orders')
      .insert({
        total_amount: total,
        status: status || 'paid', 
        table_number: tableNum,
        order_type: orderType,
        subtotal: subtotal,
        tax: tax,
        tip: tip,
        payment_method: paymentMethod,
        employee_name: employeeName,
        transaction_id: transactionId 
      })
      .select()
      .single();

    if (orderError) {
      console.error("âŒ Orders Insert Error:", orderError);
      throw orderError;
    }

    console.log(`âœ… ì£¼ë¬¸ ìƒì„± ì™„ë£Œ: #${orderData.order_number}`);

    // 2. Order Items ì €ì¥
    if (items && items.length > 0) {
      const orderItems = items.map((item: any) => ({
        order_id: orderData.id,
        menu_item_id: item.id,
        item_name: item.name || item.posName || 'Unknown Item', 
        price: item.price, 
        quantity: item.quantity,
        modifiers: item.selectedModifiers || [],
        notes: item.notes || null 
      }));

      const { error: itemsError } = await supabase
        .from('order_items')
        .insert(orderItems);

      if (itemsError) {
        console.error("âŒ Items Insert Error:", itemsError);
        throw itemsError;
      }
    }

    // âœ¨âœ¨ [í•µì‹¬ ìˆ˜ì •] ì—¬ê¸°ì— orderIdë¥¼ ë°˜ë“œì‹œ í¬í•¨ì‹œì¼œì•¼ í•©ë‹ˆë‹¤! âœ¨âœ¨
    return NextResponse.json({ 
      success: true, 
      orderNumber: orderData.order_number,
      orderId: orderData.id, // ğŸ‘ˆ ì´ í•œ ì¤„ì´ ì—†ì–´ì„œ ì—ëŸ¬ê°€ ë‚¬ë˜ ê²ƒì…ë‹ˆë‹¤!
      order: orderData       // (í˜¹ì‹œ ëª°ë¼ ì „ì²´ ë°ì´í„°ë„ ê°™ì´ ë³´ëƒ…ë‹ˆë‹¤)
    });

  } catch (error: any) {
    console.error('ğŸ”¥ Order Save API Error:', error);
    return NextResponse.json({ success: false, error: error.message }, { status: 500 });
  }
}

==================================================
FILE PATH: src\app\api\orders\list\route.ts
==================================================
import { createClient } from '@supabase/supabase-js';
import { NextResponse } from 'next/server';

const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
);

export async function GET(request: Request) {
  try {
    // 1. ì£¼ë¬¸ê³¼ ì£¼ë¬¸ ì•„ì´í…œë“¤ì„ ê°™ì´ ê°€ì ¸ì˜´ (ìµœì‹ ìˆœ 50ê°œ)
    const { data, error } = await supabase
      .from('orders')
      .select(`
        *,
        order_items (
          menu_item_id,
          item_name,
          price,
          quantity,
          modifiers,
          notes
        )
      `)
      .order('created_at', { ascending: false })
      .limit(50);

    if (error) throw error;

    return NextResponse.json({ success: true, orders: data });

  } catch (error: any) {
    console.error('Fetch Orders Error:', error);
    return NextResponse.json({ success: false, error: error.message }, { status: 500 });
  }
}

==================================================
FILE PATH: src\app\api\orders\update\route.ts
==================================================
import { createClient } from '@supabase/supabase-js';
import { NextResponse } from 'next/server';

const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
);

export async function POST(request: Request) {
  try {
    const body = await request.json();
    const { orderId, paymentMethod, tip, total, transactionId } = body;

    // ê¸°ì¡´ ì£¼ë¬¸ ìƒíƒœë¥¼ 'paid'ë¡œ ë³€ê²½í•˜ê³  ê²°ì œ ì •ë³´ ì—…ë°ì´íŠ¸
    const { data, error } = await supabase
      .from('orders')
      .update({
        status: 'paid',
        payment_method: paymentMethod,
        tip: tip,
        total_amount: total, // íŒ í¬í•¨ëœ ìµœì¢… ê¸ˆì•¡ ì—…ë°ì´íŠ¸
        // âœ¨ [ì¶”ê°€] ì—…ë°ì´íŠ¸ ì‹œì—ë„ íŠ¸ëœì­ì…˜ ID ì €ì¥
        transaction_id: transactionId || null,
        updated_at: new Date().toISOString()
      })
      .eq('id', orderId)
      .select()
      .single();

    if (error) throw error;

    return NextResponse.json({ success: true, order: data });

  } catch (error: any) {
    console.error('Update Order Error:', error);
    return NextResponse.json({ success: false, error: error.message }, { status: 500 });
  }
}

==================================================
FILE PATH: src\app\api\reports\closing\route.ts
==================================================
import { NextResponse } from 'next/server';
import { createClient } from '@supabase/supabase-js';

const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
);

// í”„ë¦°í„° ì„œë²„ IP í™•ì¸ (í™˜ê²½ì— ë§ê²Œ ìˆ˜ì • í•„ìš”)
const PRINTER_SERVER_URL = 'http://192.168.50.106:4000/print-closing';

export async function POST(request: Request) {
  try {
    // targetDate: 'YYYY-MM-DD' í˜•ì‹ì˜ ë¬¸ìì—´ (ì˜ˆ: '2026-01-24')
    const { employeeName, print, targetDate } = await request.json();

    // 1. ë‚ ì§œ ë²”ìœ„ ì„¤ì •
    // í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë‚ ì§œë¥¼ ë³´ë‚´ì£¼ë©´ ê·¸ ë‚ ì§œ ì‚¬ìš©, ì•„ë‹ˆë©´ ì˜¤ëŠ˜ ì‚¬ìš©
    const baseDate = targetDate ? new Date(targetDate) : new Date();
    
    // ì •í™•í•œ ë²”ìœ„ ê²€ìƒ‰ì„ ìœ„í•´ ì‹œ/ë¶„/ì´ˆ ì„¤ì • (í•´ë‹¹ ë‚ ì§œì˜ 00:00:00 ~ 23:59:59)
    // ì£¼ì˜: ì‹¤ì œ ë°°í¬ í™˜ê²½ì˜ Timezoneì— ë”°ë¼ new Date(string) ë™ì‘ì´ ë‹¤ë¥¼ ìˆ˜ ìˆìœ¼ë‚˜, 
    // ë¡œì»¬ í‚¤ì˜¤ìŠ¤í¬ í™˜ê²½ì„ì„ ê°ì•ˆí•˜ì—¬ ì‹œìŠ¤í…œ ë¡œì»¬ ì‹œê°„ì„ ë”°ë¥´ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.
    // (ë” ì •í™•í•˜ê²Œ í•˜ë ¤ë©´ 'YYYY-MM-DDT00:00:00' ë¬¸ìì—´ì„ ì§ì ‘ ë§Œë“¤ì–´ ì“°ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤)
    
    // ì•ˆì „í•œ ë‚ ì§œ íŒŒì‹± (YYYY-MM-DD ë¬¸ìì—´ì„ ë°›ì•„ì„œ ë¡œì»¬ ì‹œê°„ 0ì‹œ/23ì‹œë¡œ ì„¤ì •)
    const year = baseDate.getFullYear();
    const month = baseDate.getMonth();
    const day = baseDate.getDate();

    // UTC ë³´ì • ë¬¸ì œ ë°©ì§€ë¥¼ ìœ„í•´, ì…ë ¥ë°›ì€ ë‚ ì§œ ë¬¸ìì—´(targetDate)ì´ ìˆë‹¤ë©´ 
    // ê·¸ê²ƒì„ ê·¸ëŒ€ë¡œ ìª¼ê°œì„œ ë¡œì»¬ ì‹œê°„ ê°ì²´ë¥¼ ë§Œë“œëŠ” ê²ƒì´ ê°€ì¥ ì•ˆì „í•©ë‹ˆë‹¤.
    let searchStart, searchEnd;

    if (targetDate) {
        // targetDateê°€ "2026-01-24" ë¼ë©´
        const [y, m, d] = targetDate.split('-').map(Number);
        searchStart = new Date(y, m - 1, d, 0, 0, 0, 0);
        searchEnd = new Date(y, m - 1, d, 23, 59, 59, 999);
    } else {
        searchStart = new Date();
        searchStart.setHours(0, 0, 0, 0);
        searchEnd = new Date();
        searchEnd.setHours(23, 59, 59, 999);
    }

    // 2. í•´ë‹¹ ë‚ ì§œì˜ 'paid' ì£¼ë¬¸ ì¡°íšŒ
    const { data: orders, error } = await supabase
      .from('orders')
      .select('*')
      .gte('created_at', searchStart.toISOString())
      .lte('created_at', searchEnd.toISOString())
      .eq('status', 'paid');

    if (error) throw error;

    // 3. í•©ê³„ ê³„ì‚°
    let cashTotal = 0;
    let cardTotal = 0;
    let tipTotal = 0;
    let grandTotal = 0;
    let orderCount = orders.length;

    orders.forEach((order: any) => {
      const total = order.total_amount || 0;
      grandTotal += total;
      tipTotal += order.tip || 0;

      if (order.payment_method === 'CASH') {
        cashTotal += total;
      } else {
        cardTotal += total;
      }
    });

    const reportData = {
      // ë¦¬í¬íŠ¸ì— ì°í ë‚ ì§œ í…ìŠ¤íŠ¸
      date: targetDate ? targetDate : new Date().toLocaleDateString(),
      employeeName,
      cashTotal,
      cardTotal,
      tipTotal,
      grandTotal,
      orderCount
    };

    // 4. ì¸ì‡„ ìš”ì²­ ì‹œ í”„ë¦°í„° ì„œë²„ë¡œ ì „ì†¡
    if (print) {
      await fetch(PRINTER_SERVER_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(reportData)
      });
    }

    return NextResponse.json({ success: true, data: reportData });

  } catch (error: any) {
    console.error("Report Error:", error);
    return NextResponse.json({ success: false, error: error.message }, { status: 500 });
  }
}

==================================================
FILE PATH: src\app\api\stripe\cancel.ts
==================================================
import { NextApiRequest, NextApiResponse } from 'next';
import Stripe from 'stripe';

const stripe = new Stripe(process.env.STRIPE_SECRET_KEY!);

export default async function handler(req: NextApiRequest, res: NextApiResponse) {
  if (req.method !== 'POST') return res.status(405).end();

  // paymentIntentIdëŠ” ì—†ì„ ìˆ˜ë„ ìˆìŒ (ë‹¨ë§ê¸° ê°•ì œ ì´ˆê¸°í™” ì‹œ)
  const { paymentIntentId } = req.body;
  const readerId = process.env.STRIPE_READER_ID_POS;

  console.log(`ğŸ§¹ [ì´ˆê¸°í™” ìš”ì²­] Reader: ${readerId}, PI: ${paymentIntentId || 'ì—†ìŒ(ê°•ì œì´ˆê¸°í™”)'}`);

  try {
    // 1. [ì„œë¥˜ ì·¨ì†Œ] PaymentIntentê°€ ìˆìœ¼ë©´ ì·¨ì†Œ ì‹œë„
    if (paymentIntentId) {
        try {
            await stripe.paymentIntents.cancel(paymentIntentId);
            console.log("âœ… PaymentIntent ì·¨ì†Œ ì„±ê³µ");
        } catch (e: any) {
            console.log("âš ï¸ PaymentIntent ì·¨ì†Œ ê±´ë„ˆëœ€ (ì´ë¯¸ ì·¨ì†Œë¨/ì—†ìŒ):", e.message);
        }
    }

    // 2. [ê¸°ê³„ ë©ˆì¶¤] âœ¨ ì—¬ê¸°ê°€ í•µì‹¬! IDê°€ ìˆë“  ì—†ë“  ë‹¨ë§ê¸°ëŠ” ë¬´ì¡°ê±´ ë¦¬ì…‹ âœ¨
    if (readerId) {
        try {
            await stripe.terminal.readers.cancelAction(readerId);
            console.log(`âœ… ë‹¨ë§ê¸°(${readerId}) í™”ë©´ ì´ˆê¸°í™” ëª…ë ¹ ì „ì†¡!`);
        } catch (readerError: any) {
            // ë‹¨ë§ê¸°ê°€ ì´ë¯¸ ëŒ€ê¸° ìƒíƒœ(idle)ë¼ë©´ ì—ëŸ¬ê°€ ë‚  ìˆ˜ ìˆëŠ”ë°, ì´ê±´ ì„±ê³µìœ¼ë¡œ ì¹©ë‹ˆë‹¤.
            console.warn("â„¹ï¸ ë‹¨ë§ê¸° ìƒíƒœ ì•Œë¦¼:", readerError.message);
        }
    } else {
        throw new Error("í™˜ê²½ë³€ìˆ˜ STRIPE_READER_ID_POSê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
    }

    res.status(200).json({ success: true, message: "Terminal Reset Triggered" });

  } catch (error: any) {
    console.error("âŒ Reset Error:", error);
    res.status(500).json({ success: false, error: error.message });
  }
}

==================================================
FILE PATH: src\app\api\stripe\capture\route.ts
==================================================
import { NextResponse } from 'next/server';
import Stripe from 'stripe';

const stripe = new Stripe(process.env.STRIPE_SECRET_KEY!);

export async function POST(request: Request) {
  try {
    const { paymentIntentId } = await request.json();

    // ê²°ì œ ìƒíƒœ ì¡°íšŒ
    const paymentIntent = await stripe.paymentIntents.retrieve(paymentIntentId);

    // console.log(`ğŸ” Status Check: ${paymentIntent.status}`); // ë¡œê·¸ê°€ ë„ˆë¬´ ë§ìœ¼ë©´ ì£¼ì„ ì²˜ë¦¬

    // ìƒíƒœì— ë”°ë¥¸ ì‘ë‹µ
    if (paymentIntent.status === 'succeeded') {
      return NextResponse.json({ status: 'succeeded' });
    } else if (paymentIntent.status === 'requires_payment_method') {
      // ì•„ì§ ì¹´ë“œ ì…ë ¥ ëŒ€ê¸° ì¤‘ or ì¹´ë“œ ì½ëŠ” ì¤‘
      return NextResponse.json({ status: 'pending' });
    } else if (paymentIntent.status === 'canceled') {
      return NextResponse.json({ status: 'failed', error: 'Payment canceled' });
    } else {
      // ê·¸ ì™¸ ì²˜ë¦¬ ì¤‘ ìƒíƒœ
      return NextResponse.json({ status: 'pending' });
    }

  } catch (error: any) {
    console.error("Check Status Error:", error.message);
    return NextResponse.json({ success: false, error: error.message }, { status: 500 });
  }
}

==================================================
FILE PATH: src\app\api\stripe\process\route.ts
==================================================
import { NextResponse } from 'next/server';
import Stripe from 'stripe';

const stripe = new Stripe(process.env.STRIPE_SECRET_KEY!);

export async function POST(request: Request) {
  try {
    // âœ¨ í´ë¼ì´ì–¸íŠ¸ì—ì„œ 'source' ('pos' ë˜ëŠ” 'kiosk')ë¥¼ ë°›ìŒ
    const { amount, source } = await request.json();

    // âœ¨ sourceì— ë”°ë¼ ë¦¬ë”ê¸° ID ì„ íƒ
    let readerId = '';
    if (source === 'pos') {
        readerId = process.env.STRIPE_READER_ID_POS!;
    } else if (source === 'kiosk') {
        readerId = process.env.STRIPE_READER_ID_KIOSK!;
    }

    if (!readerId) {
      throw new Error(`Reader ID not configured for source: ${source}`);
    }

    console.log(`ğŸ’³ [${source.toUpperCase()}] Initiating Payment on Reader: ${readerId}`);

    // 1. ë¦¬ë”ê¸° ìƒíƒœ ì´ˆê¸°í™” (í˜¹ì‹œ ì¼œì ¸ìˆì„ì§€ ëª¨ë¥¼ ì´ì „ ê²°ì œ ì·¨ì†Œ)
    try {
      await stripe.terminal.readers.cancelAction(readerId);
    } catch (e) { /* ë¬´ì‹œ */ }

    // 2. PaymentIntent ìƒì„±
    const paymentIntent = await stripe.paymentIntents.create({
      amount: Math.round(amount * 100),
      currency: 'usd',
      payment_method_types: ['card_present'],
      capture_method: 'automatic',
    });

    // 3. ì„ íƒëœ ë‹¨ë§ê¸°ë¡œ ê²°ì œ ìš”ì²­ ì „ì†¡
    await stripe.terminal.readers.processPaymentIntent(readerId, {
      payment_intent: paymentIntent.id,
    });

    return NextResponse.json({ 
      success: true, 
      paymentIntentId: paymentIntent.id 
    });

  } catch (error: any) {
    console.error("âŒ Stripe Process Error:", error);
    return NextResponse.json({ success: false, error: error.message }, { status: 500 });
  }
}

==================================================
FILE PATH: src\app\api\stripe\refund\route.ts
==================================================
import { NextResponse } from 'next/server';
import Stripe from 'stripe';
import { createClient } from '@supabase/supabase-js';

const stripe = new Stripe(process.env.STRIPE_SECRET_KEY!, {
  apiVersion: '2025-11-17.clover', // ì‚¬ìš© ì¤‘ì¸ ë²„ì „ì— ë§ì¶¤
});

const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
);

export async function POST(request: Request) {
  try {
    const { orderId, paymentIntentId, amount } = await request.json();

    console.log(`ğŸ’¸ Refund Request: Order #${orderId}, Intent: ${paymentIntentId}`);

    // 1. Stripeì— í™˜ë¶ˆ ìš”ì²­ (ì¹´ë“œ ê²°ì œì¸ ê²½ìš°ë§Œ)
    if (paymentIntentId) {
      try {
        const refund = await stripe.refunds.create({
          payment_intent: paymentIntentId,
          // amount: amount * 100, // ì „ì²´ í™˜ë¶ˆì´ë©´ ê¸ˆì•¡ ìƒëµ ê°€ëŠ¥ (ìë™ìœ¼ë¡œ ì „ì•¡ í™˜ë¶ˆ)
        });
        console.log("âœ… Stripe Refund Success:", refund.id);
      } catch (stripeError: any) {
        console.error("âŒ Stripe Refund Failed:", stripeError);
        // ì´ë¯¸ í™˜ë¶ˆëœ ê²½ìš° ë“±ì€ ì—ëŸ¬ê°€ ë‚˜ë”ë¼ë„ DB ì—…ë°ì´íŠ¸ ì§„í–‰í• ì§€ ê²°ì • í•„ìš”
        // ì—¬ê¸°ì„œëŠ” ì—ëŸ¬ë¥¼ ë˜ì ¸ì„œ ì¤‘ë‹¨
        throw new Error(stripeError.message);
      }
    }

    // 2. DB ìƒíƒœ ì—…ë°ì´íŠ¸ ('refunded')
    const { error } = await supabase
      .from('orders')
      .update({ status: 'refunded' })
      .eq('id', orderId);

    if (error) throw error;

    return NextResponse.json({ success: true });

  } catch (error: any) {
    return NextResponse.json({ success: false, error: error.message }, { status: 500 });
  }
}

==================================================
FILE PATH: src\app\customer\page.tsx
==================================================
'use client';

import { useEffect, useState, useRef } from 'react';
import { CartItem, ModifierGroup, ModifierOption } from '@/lib/types';
import { CustomerViewMode } from '@/hooks/useCustomerDisplay';

const AD_CONTENTS = [
  { type: 'image', src: 'https://images.unsplash.com/photo-1550547660-d9450f859349?auto=format&fit=crop&w=1920&q=80' }, 
  { type: 'image', src: 'https://images.unsplash.com/photo-1594212699903-ec8a3eca50f5?auto=format&fit=crop&w=1920&q=80' }, 
  { type: 'image', src: 'https://images.unsplash.com/photo-1561758033-d8f19662cb23?auto=format&fit=crop&w=1920&q=80' }, 
];

export default function CustomerPage() {
  const [viewMode, setViewMode] = useState<CustomerViewMode>('IDLE');
  const [cart, setCart] = useState<CartItem[]>([]);
  const [total, setTotal] = useState(0);
  const [activeItemName, setActiveItemName] = useState('');
  const [availableGroups, setAvailableGroups] = useState<ModifierGroup[]>([]);
  
  // Pollingì„ ìœ„í•œ Ref
  const lastUpdateRef = useRef<number>(0);

  useEffect(() => {
    // âœ¨ [ìˆ˜ì •] 0.5ì´ˆë§ˆë‹¤ ì„œë²„ì—ì„œ ìƒíƒœ ê°€ì ¸ì˜¤ê¸° (Polling)
    const interval = setInterval(async () => {
        try {
            const res = await fetch('/api/display', { cache: 'no-store' });
            if (!res.ok) return;
            
            const data = await res.json();
            
            // ë°ì´í„°ê°€ ë³€í–ˆì„ ë•Œë§Œ ì—…ë°ì´íŠ¸ (ë Œë”ë§ ìµœì í™”)
            if (data.lastUpdated && data.lastUpdated !== lastUpdateRef.current) {
                lastUpdateRef.current = data.lastUpdated;
                
                setViewMode(data.mode);
                setCart(data.cart || []);
                setTotal(data.total || 0);
                setActiveItemName(data.activeItemName || '');
                setAvailableGroups(data.availableGroups || []);
            }
        } catch (e) {
            // ë¬´ì‹œ (ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ ë“±)
        }
    }, 500); // 0.5ì´ˆ ê°„ê²©

    return () => clearInterval(interval);
  }, []);

  const handleTipSelect = (percentage: number | 'NO') => {
    let tipAmount = percentage === 'NO' ? 0 : total * (percentage / 100);
    
    // 1. BroadcastChannel ì „ì†¡
    const ch = new BroadcastChannel('pos-customer-display');
    ch.postMessage({ type: 'TIP_SELECTED', payload: { amount: tipAmount } });
    setTimeout(() => ch.close(), 100);

    // 2. Storage Event ì „ì†¡ (ë°±ì—…ìš©)
    localStorage.setItem('POS_TIP_SELECTED', JSON.stringify({ 
        amount: tipAmount, 
        timestamp: Date.now() 
    }));
  };

  // --- ì•„ë˜ë¶€í„°ëŠ” UI ì½”ë“œ (ê¸°ì¡´ê³¼ ë™ì¼) ---

  // 1. ëŒ€ê¸° í™”ë©´ (ê´‘ê³ )
  if (viewMode === 'IDLE') return <IdleSlideshow />;

  // 2. ê²°ì œ ì„±ê³µ í™”ë©´
  if (viewMode === 'PAYMENT_SUCCESS') {
    return (
      <div className="h-screen bg-green-600 flex flex-col items-center justify-center text-white animate-in zoom-in duration-300">
        <h1 className="text-8xl font-black mb-4">THANK YOU!</h1>
        <p className="text-4xl">Your order is being prepared.</p>
      </div>
    );
  }

  // 3. ê²°ì œ ì§„í–‰ ì¤‘
  if (viewMode === 'PROCESSING') {
    return (
      <div className="h-screen bg-blue-600 flex flex-col items-center justify-center text-white animate-in fade-in duration-300">
        <div className="mb-10 animate-bounce">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-40 h-40">
              <path strokeLinecap="round" strokeLinejoin="round" d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5z" />
            </svg>
        </div>
        <h1 className="text-6xl font-black mb-6">Please Insert / Tap Card</h1>
        <p className="text-3xl text-blue-200">Processing your payment...</p>
        <div className="mt-8 text-4xl font-bold bg-white/20 px-8 py-4 rounded-2xl">
           Total: ${total.toFixed(2)} + Tip
        </div>
      </div>
    );
  }

  // 4. íŒ ì„ íƒ í™”ë©´
  if (viewMode === 'TIPPING') {
    return (
      <div className="h-screen bg-white flex flex-col items-center justify-center p-10">
        <h1 className="text-5xl font-black text-gray-800 mb-4">Would you like to add a Tip?</h1>
        <p className="text-2xl text-gray-500 mb-10">Your support goes directly to our team!</p>
        <div className="grid grid-cols-2 gap-6 w-full max-w-4xl">
           <TipButton label="10%" sub={`$${(total * 0.10).toFixed(2)}`} onClick={() => handleTipSelect(10)} />
           <TipButton label="15%" sub={`$${(total * 0.15).toFixed(2)}`} onClick={() => handleTipSelect(15)} />
           <TipButton label="20%" sub={`$${(total * 0.20).toFixed(2)}`} onClick={() => handleTipSelect(20)} />
           <TipButton label="No Tip" sub="Skip" onClick={() => handleTipSelect('NO')} color="gray" />
        </div>
      </div>
    );
  }

  // 5. ì£¼ë¬¸ ìœ í˜• ì„ íƒ
  if (viewMode === 'ORDER_TYPE_SELECT') {
    return (
      <div className="h-screen bg-gray-900 flex flex-col items-center justify-center text-white">
         <h2 className="text-4xl text-gray-400 font-bold mb-12 uppercase tracking-widest">How would you like your order?</h2>
         <div className="flex gap-12">
            <div className="w-[400px] h-[300px] bg-gray-800 rounded-3xl border-4 border-gray-700 flex flex-col items-center justify-center opacity-80">
                <span className="text-8xl mb-4">ğŸ½ï¸</span>
                <span className="text-5xl font-black">Dine In</span>
            </div>
            <div className="w-[400px] h-[300px] bg-gray-800 rounded-3xl border-4 border-gray-700 flex flex-col items-center justify-center opacity-80">
                <span className="text-8xl mb-4">ğŸ›ï¸</span>
                <span className="text-5xl font-black">To Go</span>
            </div>
         </div>
      </div>
    );
  }

  // 6. í…Œì´ë¸” ë²ˆí˜¸ ì…ë ¥
  if (viewMode === 'TABLE_NUMBER_SELECT') {
    return (
      <div className="h-screen bg-gray-900 flex flex-col items-center justify-center text-white">
         <div className="bg-gray-800 p-12 rounded-[3rem] shadow-2xl border border-gray-700 text-center w-[600px]">
             <p className="text-3xl text-gray-400 font-bold mb-6 uppercase tracking-widest">Table Service</p>
             <h1 className="text-6xl font-black mb-8">Table Number</h1>
             <div className="w-full h-32 bg-black rounded-2xl flex items-center justify-center border-2 border-gray-600">
                <span className="text-6xl text-gray-500 animate-pulse">Entering...</span>
             </div>
             <p className="mt-8 text-xl text-gray-500">Please wait while we set up your table.</p>
         </div>
      </div>
    );
  }

  // 7. ì˜µì…˜ ì„ íƒ
  if (viewMode === 'MODIFIER_SELECT') {
    return (
      <div className="h-screen bg-gray-900 flex text-white">
        <div className="flex-1 p-8 border-r border-gray-800 overflow-y-auto">
             <div className="mb-10 border-b border-gray-700 pb-6">
                 <p className="text-yellow-500 text-xl font-bold uppercase tracking-widest mb-2">Select Options For</p>
                 <h1 className="text-7xl font-black text-white leading-tight">{activeItemName}</h1>
             </div>
             <div className="space-y-10">
                {(!availableGroups || availableGroups.length === 0) ? (
                    <p className="text-2xl text-gray-500">Loading options...</p>
                ) : (
                    availableGroups.map((group, idx) => (
                        <div key={idx} className="bg-gray-800 rounded-3xl p-6 shadow-lg">
                            <h3 className="text-3xl font-bold text-blue-400 mb-6 border-l-4 border-blue-500 pl-4 uppercase">{group.name}</h3>
                            <div className="grid grid-cols-3 gap-4">
                                {group.options?.map((opt: ModifierOption, oIdx: number) => (
                                    <div key={oIdx} className="bg-gray-700/50 p-4 rounded-xl flex flex-col items-center justify-center text-center h-32 border border-gray-600">
                                        <span className="text-2xl font-bold text-gray-200">{opt.name}</span>
                                        {opt.price > 0 && <span className="mt-2 text-lg text-yellow-400 font-bold bg-black/30 px-3 py-1 rounded-full">+${opt.price.toFixed(2)}</span>}
                                    </div>
                                ))}
                            </div>
                        </div>
                    ))
                )}
             </div>
        </div>
        <div className="w-[400px] bg-black p-8 border-l border-gray-800 opacity-40">
             <h2 className="text-3xl font-bold mb-6 text-gray-500">Cart</h2>
             <div className="space-y-4">
                {cart.map((item, i) => (
                   <div key={i} className="text-gray-500 border-b border-gray-800 pb-2">
                      <div className="flex justify-between text-xl font-bold">
                         <span>{item.name}</span>
                         <span>${item.totalPrice.toFixed(2)}</span>
                      </div>
                   </div>
                ))}
             </div>
        </div>
      </div>
    );
  }

  // 8. ê¸°ë³¸ ì¥ë°”êµ¬ë‹ˆ (CART)
  return (
    <div className="h-screen bg-black text-white flex">
      <div className="flex-1 p-8 border-r border-gray-800 overflow-y-auto">
         <h2 className="text-4xl font-black mb-8 text-gray-500 tracking-wider">YOUR ORDER</h2>
         <div className="space-y-4">
            {cart.map((item, i) => (
               <div key={i} className="bg-gray-900/60 p-6 rounded-3xl border border-gray-800 flex justify-between items-start animate-in fade-in slide-in-from-left-4">
                  <div>
                    <span className="text-4xl font-bold text-white">{item.name}</span>
                    {item.selectedModifiers && item.selectedModifiers.length > 0 && (
                       <div className="mt-3 pl-4 border-l-4 border-yellow-500 space-y-1">
                          {item.selectedModifiers.map((m, idx) => (
                             <div key={idx} className="text-2xl text-yellow-400 font-medium">
                                + {m.name} {m.price > 0 && <span className="text-gray-500 text-lg">(${m.price.toFixed(2)})</span>}
                             </div>
                          ))}
                       </div>
                    )}
                    {item.notes && <div className="text-xl text-blue-400 mt-2 italic">Note: {item.notes}</div>}
                  </div>
                  <span className="text-4xl font-bold text-gray-200">${item.totalPrice.toFixed(2)}</span>
               </div>
            ))}
         </div>
         <div className="h-20"></div>
      </div>
      <div className="w-[400px] bg-gray-900 p-8 flex flex-col justify-center shadow-2xl z-10">
         <p className="text-center text-gray-400 text-2xl mb-4 uppercase tracking-widest font-bold">Total Amount</p>
         <div className="text-8xl font-black text-center text-green-500 tracking-tighter">
            ${total.toFixed(2)}
         </div>
         <p className="text-center text-gray-600 mt-4 text-lg">Tax included in final step</p>
      </div>
    </div>
  );
}

function IdleSlideshow() {
  const [index, setIndex] = useState(0);
  useEffect(() => {
    const timer = setInterval(() => setIndex((prev) => (prev + 1) % AD_CONTENTS.length), 5000); 
    return () => clearInterval(timer);
  }, []);
  const content = AD_CONTENTS[index];

  return (
    <div className="h-screen w-full bg-black flex items-center justify-center overflow-hidden relative">
      <div className="absolute inset-0 bg-black/40 z-10" />
      <div className="z-20 w-full h-full">
          {content.type === 'video' ? (
              <video src={content.src} className="w-full h-full object-cover" autoPlay muted loop />
          ) : (
              <div className="w-full h-full bg-cover bg-center flex items-center justify-center" style={{ backgroundImage: `url(${content.src})` }}>
              </div>
          )}
      </div>
    </div>
  );
}

function TipButton({ label, sub, onClick, highlight, color = 'blue' }: any) {
  const baseClass = "h-40 rounded-3xl flex flex-col items-center justify-center transition-all active:scale-95 shadow-xl border-4";
  const colors: any = {
    blue: highlight 
      ? "bg-blue-600 border-blue-400 text-white hover:bg-blue-500" 
      : "bg-white border-blue-100 text-blue-900 hover:bg-blue-50",
    gray: "bg-gray-100 border-gray-200 text-gray-600 hover:bg-gray-200"
  };
  return (
    <button onClick={onClick} className={`${baseClass} ${colors[color]}`}>
      <span className="text-5xl font-black">{label}</span>
      <span className="text-2xl font-bold mt-2 opacity-80">{sub}</span>
    </button>
  );
}

==================================================
FILE PATH: src\app\kiosk\page.tsx
==================================================
// src/app/page.tsx
// [ë³€ê²½] csvParser ëŒ€ì‹  dataFetcherë¥¼ import í•©ë‹ˆë‹¤.
import { getKioskData } from '@/lib/dataFetcher';
import KioskMain from '@/components/kiosk/KioskMain';

// Next.js í˜ì´ì§€ ìºì‹± ì„¤ì • (0ìœ¼ë¡œ ì„¤ì •í•˜ë©´ ë§¤ë²ˆ ìµœì‹  ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´)
// ìƒìš© ë°°í¬ ì‹œì—ëŠ” 60ì´ˆ ë“±ìœ¼ë¡œ ëŠ˜ë ¤ì„œ DB ë¶€í•˜ë¥¼ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
export const revalidate = 0;

export default async function Page() {
  const { categories, items, modifiersObj } = await getKioskData();

  return (
    <main className="h-screen w-screen overflow-hidden bg-gray-50">
      <KioskMain
        categories={categories}
        items={items}
        modifiersObj={modifiersObj}
      />
    </main>
  );
}

==================================================
FILE PATH: src\app\layout.tsx
==================================================
import type { Metadata, Viewport } from "next";
import { Nunito } from "next/font/google";
// [ìˆ˜ì •] íŒŒì¼ ìœ„ì¹˜ì— ë§ê²Œ ê²½ë¡œ ë³€ê²½ (./globals.css -> ../styles/globals.css)
import "../styles/globals.css";
import TestPrinter from "@/components/shared/TestPrinter";

const nunito = Nunito({
  subsets: ["latin"],
  weight: ["400", "600", "700", "800"],
  variable: "--font-nunito",
});

export const metadata: Metadata = {
  title: "Collegiate Grill Kiosk",
  description: "POS System",
  manifest: "/manifest.json", // ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ì—°ê²°
  appleWebApp: {
    capable: true,
    statusBarStyle: "black-translucent",
    title: "POS",
  },
};

// ë·°í¬íŠ¸ ì„¤ì • (í™•ëŒ€/ì¶•ì†Œ ë°©ì§€ -> ì•±ì²˜ëŸ¼ ëŠê»´ì§€ê²Œ í•¨)
export const viewport: Viewport = {
  width: "device-width",
  initialScale: 1,
  maximumScale: 1,
  userScalable: false,
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body className={`${nunito.className} antialiased`}>
        {children}
        {/* ğŸ‘ˆ 2. ì—¬ê¸°ì— ì¶”ê°€ (í™”ë©´ êµ¬ì„ì— ëœ¹ë‹ˆë‹¤) */}
      </body>
    </html>
  );
}

==================================================
FILE PATH: src\app\login\page.tsx
==================================================
// src/app/login/page.tsx
"use client";
import { useState } from 'react';
import { createBrowserClient } from '@supabase/ssr'; // í´ë¼ì´ì–¸íŠ¸ìš©
import { useRouter } from 'next/navigation';

export default function LoginPage() {
    const [email, setEmail] = useState('');
    const [password, setPassword] = useState('');
    const [loading, setLoading] = useState(false);
    const router = useRouter();

    // í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ìš© Supabase ìƒì„±
    const supabase = createBrowserClient(
        process.env.NEXT_PUBLIC_SUPABASE_URL!,
        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
    );

    const handleLogin = async (e: React.FormEvent) => {
        e.preventDefault();
        setLoading(true);

        const { error } = await supabase.auth.signInWithPassword({
            email,
            password,
        });

        if (error) {
            alert('Login failed: ' + error.message);
            setLoading(false);
        } else {
            router.push('/admin'); // ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ê´€ë¦¬ì í˜ì´ì§€ë¡œ ì´ë™
            router.refresh();
        }
    };

    return (
        <div className="min-h-screen flex items-center justify-center bg-gray-100">
            <div className="bg-white p-8 rounded-xl shadow-lg w-full max-w-md">
                <h1 className="text-2xl font-bold mb-6 text-center text-gray-800">Admin Login</h1>
                <form onSubmit={handleLogin} className="space-y-4">
                    <div>
                        <label className="block text-sm font-medium text-gray-700">Email</label>
                        <input
                            type="email"
                            required
                            className="w-full mt-1 p-3 border rounded-lg outline-none focus:ring-2 focus:ring-blue-500"
                            value={email}
                            onChange={e => setEmail(e.target.value)}
                        />
                    </div>
                    <div>
                        <label className="block text-sm font-medium text-gray-700">Password</label>
                        <input
                            type="password"
                            required
                            className="w-full mt-1 p-3 border rounded-lg outline-none focus:ring-2 focus:ring-blue-500"
                            value={password}
                            onChange={e => setPassword(e.target.value)}
                        />
                    </div>
                    <button
                        disabled={loading}
                        className="w-full bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 disabled:opacity-50"
                    >
                        {loading ? 'Logging in...' : 'Sign In'}
                    </button>
                </form>
            </div>
        </div>
    );
}

==================================================
FILE PATH: src\app\page.tsx
==================================================
import Link from 'next/link';

export default function LandingPage() {
  return (
    <div className="min-h-screen bg-black flex flex-col items-center justify-center p-10 gap-8">
      
      {/* íƒ€ì´í‹€ */}
      <div className="text-center mb-10">
        <h1 className="text-5xl font-black text-white mb-4 tracking-tight">
          COLLEGIATE GRILL
        </h1>
        <p className="text-gray-400 text-xl">System Launcher</p>
      </div>

      {/* ì¹´ë“œ ê·¸ë¦¬ë“œ */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-8 w-full max-w-6xl">
        
        {/* 1. Kiosk Mode */}
        <Link 
          href="/kiosk" 
          className="group relative h-80 bg-gray-900 rounded-3xl border-2 border-gray-800 hover:border-blue-500 hover:bg-gray-800 transition-all flex flex-col items-center justify-center p-8 shadow-2xl"
        >
          <div className="bg-blue-900/30 p-6 rounded-full mb-6 group-hover:scale-110 transition-transform">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" className="w-16 h-16 text-blue-400">
              <path strokeLinecap="round" strokeLinejoin="round" d="M10.5 1.5H8.25A2.25 2.25 0 006 3.75v16.5a2.25 2.25 0 002.25 2.25h7.5A2.25 2.25 0 0018 20.25V3.75a2.25 2.25 0 00-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3" />
            </svg>
          </div>
          <h2 className="text-3xl font-black text-white mb-2">KIOSK MODE</h2>
          <p className="text-gray-500 font-medium text-lg">Customer Self-Ordering</p>
        </Link>

        {/* 2. POS Mode */}
        <Link 
          href="/pos" 
          className="group relative h-80 bg-gray-900 rounded-3xl border-2 border-gray-800 hover:border-purple-500 hover:bg-gray-800 transition-all flex flex-col items-center justify-center p-8 shadow-2xl"
        >
          <div className="bg-purple-900/30 p-6 rounded-full mb-6 group-hover:scale-110 transition-transform">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" className="w-16 h-16 text-purple-400">
              <path strokeLinecap="round" strokeLinejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 00-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 00-16.536-1.84M7.5 14.25L5.106 5.272M6 20.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm12.75 0a.75.75 0 11-1.5 0 .75.75 0 011.5 0z" />
            </svg>
          </div>
          <h2 className="text-3xl font-black text-white mb-2">POS MODE</h2>
          <p className="text-gray-500 font-medium text-lg">Staff Order Entry</p>
        </Link>

        {/* 3. Admin Mode */}
        <Link 
          href="/admin" 
          className="group relative h-80 bg-gray-900 rounded-3xl border-2 border-gray-800 hover:border-green-500 hover:bg-gray-800 transition-all flex flex-col items-center justify-center p-8 shadow-2xl"
        >
          <div className="bg-green-900/30 p-6 rounded-full mb-6 group-hover:scale-110 transition-transform">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" className="w-16 h-16 text-green-400">
              <path strokeLinecap="round" strokeLinejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 11-3 0m3 0a1.5 1.5 0 10-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-9.75 0h9.75" />
            </svg>
          </div>
          <h2 className="text-3xl font-black text-white mb-2">ADMIN</h2>
          <p className="text-gray-500 font-medium text-lg">Menu & Sales</p>
        </Link>

      </div>
      
      <p className="text-gray-600 mt-10 text-sm">v1.0.0 - Collegiate Grill System</p>
    </div>
  );
}

==================================================
FILE PATH: src\app\pos\page.tsx
==================================================
'use client';

import { usePosLogic } from '@/hooks/usePosLogic';
import PosMenuGrid from '@/components/pos/PosMenuGrid';
import PosCart from '@/components/pos/PosCart';
import PosHeader from '@/components/pos/PosHeader';
import EmployeeLogin from '@/components/pos/EmployeeLogin';

// Modals
import CashPaymentModal from '@/components/pos/CashPaymentModal';
import CardPaymentModal from '@/components/pos/CardPaymentModal';
import OrderTypeModal from '@/components/shared/OrderTypeModal';
import TableNumberModal from '@/components/shared/TableNumberModal';
import TipModal from '@/components/shared/TipModal';
import ModifierModal from '@/components/shared/ModifierModal';
import DayWarningModal from '@/components/shared/DayWarningModal';
import SpecialRequestModal from '@/components/pos/SpecialRequestModal';
import CustomerNameModal from '@/components/pos/CustomerNameModal';
import OrderListModal from '@/components/pos/OrderListModal';

export default function PosPage() {
  const {
    currentEmployee, setCurrentEmployee, cart, categories, menuItems, modifiersObj,
    selectedCategory, setSelectedCategory, isLoading, 
    isOrderListOpen, setIsOrderListOpen, txn,
    isOrderTypeOpen, isTableNumOpen, isTipOpen, isCashModalOpen,
    isPhoneOrderModalOpen, setIsPhoneOrderModalOpen,
    
    selectedItemForMod, closeModifierModal, 
    
    editingNoteItem, setEditingNoteItem,
    showDayWarning, setShowDayWarning, warningTargetDay,
    
    // [í•µì‹¬] ì—¬ê¸°ì„œ ì—ëŸ¬ê°€ ë‚œë‹¤ë©´ usePosLogic.ts íŒŒì¼ì—ì„œ ì´ ë³€ìˆ˜ë“¤ì„ returnì— ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.
    isCardProcessing, cardStatusMessage, handleCancelPayment,
    
    addToCart, removeFromCart, handleSaveNote, handleItemClick, getSubtotal,
    handlePhoneOrderClick, handlePhoneOrderConfirm,
    handleRecallOrder, handleRefundOrder,
    handlePaymentStart, handleOrderTypeSelect, handleTableNumConfirm, handleTipSelect,
    handleCashPaymentConfirm, resetFlow, handleLogout
  } = usePosLogic();

  // 1. ë¡œë”© ë° ë¡œê·¸ì¸ ì²´í¬
  if (isLoading) return <div className="flex h-screen items-center justify-center font-bold">Loading...</div>;
  if (!currentEmployee) return <EmployeeLogin onLoginSuccess={setCurrentEmployee} />;

  // 2. ì¹´í…Œê³ ë¦¬ í•„í„°ë§ (null/undefined ì•ˆì „ ì¥ì¹˜ ì¶”ê°€)
  const filteredItems = selectedCategory === 'All' 
    ? menuItems 
    : menuItems.filter(item => item.category === categories.find(c => c.id === selectedCategory)?.name);

  // 3. ê²°ì œ ì´ì•¡ ê³„ì‚° (txn ê°ì²´ê°€ ì—†ì„ ë•Œ ì—ëŸ¬ ë°©ì§€)
  const finalTotalAmount = getSubtotal() + (txn?.tipAmount || 0);

  return (
    <div className="flex h-screen bg-black overflow-hidden relative">
      
      {/* 1. Header */}
      <PosHeader 
        employee={currentEmployee} 
        onOpenOrders={() => setIsOrderListOpen(true)} 
        onLogout={handleLogout} 
      />

      {/* 2. Left: Cart */}
      <div className="w-1/3 h-full pt-12">
        <PosCart 
           cart={cart} 
           subtotal={getSubtotal()} 
           onRemoveItem={removeFromCart} 
           onPaymentStart={handlePaymentStart} 
           onEditNote={setEditingNoteItem} 
           onPhoneOrder={handlePhoneOrderClick}
        />
      </div>

      {/* 3. Right: Menu Grid */}
      <div className="flex-1 h-full pt-12">
        <PosMenuGrid 
           categories={categories} 
           selectedCategory={selectedCategory} 
           onSelectCategory={setSelectedCategory} 
           filteredItems={filteredItems} 
           onItemClick={handleItemClick} 
        />
      </div>

      {/* 4. Modals */}
      {showDayWarning && (
        <DayWarningModal 
          targetDay={warningTargetDay} 
          onClose={() => setShowDayWarning(false)} 
        />
      )}
      
      {selectedItemForMod && (
        <ModifierModal 
          item={selectedItemForMod} 
          modifiersObj={modifiersObj} 
          onClose={closeModifierModal} 
          onConfirm={(item, options) => {
             addToCart(item, options);
             closeModifierModal(); 
          }}
        />
      )}
      
      {editingNoteItem && (
        <SpecialRequestModal 
          initialNote={editingNoteItem.notes || ""} 
          onClose={() => setEditingNoteItem(null)} 
          onConfirm={handleSaveNote} 
        />
      )}
      
      {isOrderTypeOpen && <OrderTypeModal onSelect={handleOrderTypeSelect} onCancel={resetFlow} />}
      
      {isTableNumOpen && <TableNumberModal onConfirm={handleTableNumConfirm} onCancel={resetFlow} />}
      
      {isTipOpen && (
        <TipModal 
          subtotal={getSubtotal()} 
          onSelectTip={(amount) => {
             // âœ¨ [ì•ˆì „ ì¥ì¹˜] í˜¹ì‹œ handleTipSelectê°€ ì—†ê±°ë‚˜ íƒ€ì…ì´ ì•ˆ ë§ì•„ë„ ì—ëŸ¬ê°€ ì•ˆ ë‚˜ë„ë¡ ì²˜ë¦¬
             if (handleTipSelect) {
                handleTipSelect(amount);
             } else {
                console.warn("handleTipSelect function is missing in usePosLogic");
             }
          }} 
          onCancel={resetFlow}
        />
      )}
      
      {isPhoneOrderModalOpen && (
        <CustomerNameModal 
          onClose={() => setIsPhoneOrderModalOpen(false)} 
          onConfirm={handlePhoneOrderConfirm} 
        />
      )}
      
      {isOrderListOpen && (
        <OrderListModal 
          onClose={() => setIsOrderListOpen(false)} 
          onRecallOrder={handleRecallOrder} 
          onRefundOrder={handleRefundOrder} 
        />
      )}

      <CashPaymentModal 
        isOpen={isCashModalOpen} 
        onClose={resetFlow} 
        totalAmount={finalTotalAmount} 
        onConfirm={handleCashPaymentConfirm} 
      />

      {/* ì¹´ë“œ ëª¨ë‹¬ ì•ˆì „ ì²˜ë¦¬ */}
      <CardPaymentModal
        isOpen={!!isCardProcessing} 
        statusMessage={cardStatusMessage || ""} 
        onCancel={handleCancelPayment}
      />

    </div>
  );
}

==================================================
FILE PATH: src\components\kiosk\ItemCard.tsx
==================================================
"use client";
import { useState } from 'react';
import { MenuItem } from '@/lib/types';

interface ItemCardProps {
  item: MenuItem;
  onClick: () => void;
}

export default function ItemCard({ item, onClick }: ItemCardProps) {
  const [imageError, setImageError] = useState(false);

  return (
    <div 
      onClick={onClick}
      className="group bg-white rounded-[2rem] shadow-md overflow-hidden cursor-pointer hover:shadow-xl hover:-translate-y-1 transition-all duration-300 border border-gray-200 flex flex-col h-full"
    >
      {/* 1. ì´ë¯¸ì§€ ì˜ì—­ (1:1 ë¹„ìœ¨) */}
      <div className="aspect-square bg-gray-100 relative overflow-hidden shrink-0">
        {item.image && !imageError ? (
          <img 
            src={item.image} 
            alt={item.name} 
            className="object-cover w-full h-full group-hover:scale-105 transition-transform duration-500" 
            onError={() => setImageError(true)}
          />
        ) : (
          <div className="w-full h-full flex flex-col items-center justify-center text-gray-300 bg-gray-50">
            <span className="text-6xl mb-4 grayscale opacity-30">ğŸ”</span>
          </div>
        )}
        
        {!item.is_available && (
             <div className="absolute inset-0 bg-black/60 flex items-center justify-center z-10">
                 <span className="text-white font-black text-2xl border-4 border-white px-4 py-1 rounded-xl uppercase tracking-widest transform -rotate-12 shadow-lg">
                     Sold Out
                 </span>
             </div>
        )}
      </div>

      {/* 2. í…ìŠ¤íŠ¸ ì •ë³´ ì˜ì—­ */}
      <div className="p-4 flex flex-col flex-1 bg-white">
        {/* âœ¨ [ìˆ˜ì •] ì œëª© í¬ê¸° í™•ëŒ€: text-xl -> text-2xl */}
        <h3 className="font-extrabold text-2xl text-gray-900 mb-2 leading-tight tracking-tight line-clamp-2">
          {item.name}
        </h3>
        
        {/* âœ¨ [ìˆ˜ì •] ì„¤ëª… í¬ê¸° í™•ëŒ€: text-sm -> text-lg */}
        {item.description && (
          <p className="text-lg text-gray-500 font-medium leading-tight line-clamp-2">
            {item.description}
          </p>
        )}
      </div>

      {/* 3. ê°€ê²© ì˜ì—­ */}
      <div className="px-5 py-3 bg-gray-50 border-t border-gray-100 flex justify-between items-center group-hover:bg-red-50 transition-colors">
        <span className="text-sm font-bold text-gray-400 uppercase tracking-wider group-hover:text-red-400">
            Select
        </span>
        {/* âœ¨ [ìˆ˜ì •] ê°€ê²© í¬ê¸° í™•ëŒ€: text-2xl -> text-3xl */}
        <span className="font-black text-3xl text-gray-800 group-hover:text-red-600 transition-colors">
          ${item.price.toFixed(2)}
        </span>
      </div>
    </div>
  );
}

==================================================
FILE PATH: src\components\kiosk\KioskCartDrawer.tsx
==================================================
'use client';

import { motion, AnimatePresence } from 'framer-motion';
import { CartItem } from '@/lib/types';
// âœ¨ [ì¤‘ìš”] Reactì—ì„œ RefObjectë¥¼ import í•´ì•¼ í•©ë‹ˆë‹¤.
import { RefObject } from 'react';

// ExtendedCartItem íƒ€ì… ì •ì˜ (ë˜ëŠ” types.tsì—ì„œ ê°€ì ¸ì˜¤ê¸°)
interface ExtendedCartItem extends CartItem {
    uniqueCartId: string;
    groupId?: string;
}

interface KioskCartDrawerProps {
  isOpen: boolean;
  onClose: () => void;
  cart: ExtendedCartItem[];
  onRemove: (id: string) => void;
  // âœ¨ [í•´ê²°] ì—¬ê¸°ì„œ cartEndRef íƒ€ì…ì„ ì •í™•íˆ ì •ì˜í•´ì•¼ ì—ëŸ¬ê°€ ì‚¬ë¼ì§‘ë‹ˆë‹¤.
  cartEndRef: RefObject<HTMLDivElement | null>; 
  totals: { subtotal: number; tax: number; cardFee: number; grandTotal: number };
  onPayNow: () => void;
  onClear: () => void;
}

export default function KioskCartDrawer({ 
  isOpen, onClose, cart, onRemove, cartEndRef, totals, onPayNow, onClear 
}: KioskCartDrawerProps) {
  
  return (
    <AnimatePresence>
      {isOpen && (
        <>
          {/* 1. ë°°ê²½ (Backdrop) */}
          <motion.div
            initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }}
            onClick={onClose}
            className="fixed inset-0 bg-black/60 z-50 backdrop-blur-sm"
          />
          
          {/* 2. ìŠ¬ë¼ì´ë“œ íŒ¨ë„ (Drawer) */}
          <motion.div
            initial={{ y: "100%" }} animate={{ y: 0 }} exit={{ y: "100%" }}
            transition={{ type: "spring", stiffness: 300, damping: 30 }}
            className="fixed bottom-0 left-0 w-full h-[85%] md:h-[75%] bg-white z-[60] shadow-2xl flex flex-col rounded-t-[2.5rem]"
            onClick={(e) => e.stopPropagation()} 
          >
            {/* í—¤ë” */}
            <div className="p-6 md:p-8 bg-gray-900 text-white shadow-md flex justify-between items-center shrink-0 rounded-t-[2.5rem]">
              <div>
                <h2 className="text-3xl md:text-4xl font-extrabold tracking-tight">Your Order</h2>
                <p className="text-gray-400 text-lg md:text-xl mt-1 font-medium">{cart.length} items</p>
              </div>
              <button 
                onClick={onClose} 
                className="bg-gray-800 p-4 rounded-full hover:bg-gray-700 transition-colors shadow-lg active:scale-95"
              >
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={3} stroke="currentColor" className="w-8 h-8 md:w-10 md:h-10 text-white">
                  <path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>

            {/* ì¥ë°”êµ¬ë‹ˆ ë¦¬ìŠ¤íŠ¸ */}
            <div className="flex-1 overflow-y-auto p-4 md:p-6 space-y-4 bg-gray-50">
              {cart.length === 0 ? (
                <div className="h-full flex flex-col items-center justify-center text-gray-400 space-y-4">
                   <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-24 h-24 opacity-20">
                      <path strokeLinecap="round" strokeLinejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 00-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 00-16.536-1.84M7.5 14.25L5.106 5.272M6 20.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm12.75 0a.75.75 0 11-1.5 0 .75.75 0 011.5 0z" />
                   </svg>
                  <p className="text-2xl font-bold">Cart is empty.</p>
                  <button onClick={onClose} className="text-blue-500 font-bold text-lg mt-2">Go back to Menu</button>
                </div>
              ) : (
                <>
                  <AnimatePresence initial={false} mode='popLayout'>
                    {cart.map((cartItem) => (
                      <motion.div 
                        key={cartItem.uniqueCartId} layout 
                        initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, x: -100 }} 
                        className="bg-white p-5 rounded-[1.5rem] shadow-sm border border-gray-200 flex flex-row gap-4 relative z-0"
                      >
                          <div className="flex-1 flex flex-col justify-center">
                            <h4 className="font-black text-2xl md:text-3xl text-gray-900 leading-tight mb-1">{cartItem.name}</h4>
                            
                            {cartItem.selectedModifiers.length > 0 && (
                              <div className="my-2 text-lg md:text-xl text-gray-600 font-medium bg-gray-100/80 p-3 rounded-xl inline-block">
                                {cartItem.selectedModifiers.map((opt, i) => (
                                  <div key={i} className="flex items-center gap-1">
                                    <span className="w-1.5 h-1.5 bg-gray-400 rounded-full inline-block mr-1"></span>
                                    <span>{opt.name}</span>
                                    {opt.price > 0 && <span className="text-gray-900 font-bold ml-1">(+${opt.price.toFixed(2)})</span>}
                                  </div>
                                ))}
                              </div>
                            )}

                            <div className="mt-2 font-black text-gray-900 text-3xl tracking-tight">
                              ${cartItem.totalPrice.toFixed(2)}
                            </div>
                          </div>

                          <div className="flex flex-col justify-center border-l pl-5 border-gray-100">
                            <button 
                              onClick={() => onRemove(cartItem.uniqueCartId)} 
                              className="w-16 h-16 flex items-center justify-center bg-red-50 text-red-500 rounded-2xl hover:bg-red-600 hover:text-white transition-all shadow-sm active:scale-95"
                            >
                              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2.5} stroke="currentColor" className="w-8 h-8">
                                <path strokeLinecap="round" strokeLinejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                              </svg>
                            </button>
                          </div>
                      </motion.div>
                    ))}
                  </AnimatePresence>
                  
                  {/* âœ¨ [í•´ê²°] ìŠ¤í¬ë¡¤ í•˜ë‹¨ ì•µì»¤ (ref ì—°ê²°) */}
                  <div ref={cartEndRef} />
                  
                  <div className="text-right pt-4 pb-4">
                    <button 
                      onClick={onClear} 
                      className="text-xl text-red-500 hover:text-red-700 font-bold px-4 py-2 hover:bg-red-50 rounded-xl transition-colors"
                    >
                      Empty Cart
                    </button>
                  </div>
                </>
              )}
            </div>

            {/* í•˜ë‹¨ ê²°ì œ ì •ë³´ ë° ë²„íŠ¼ */}
            {cart.length > 0 && (
              <div className="p-6 md:p-8 border-t bg-white shadow-[0_-10px_40px_-15px_rgba(0,0,0,0.1)] shrink-0 pb-10">
                <div className="space-y-3 mb-8 text-gray-500 font-bold text-xl md:text-2xl">
                  <div className="flex justify-between">
                    <span>Subtotal</span>
                    <span className="text-gray-800">${totals.subtotal.toFixed(2)}</span>
                  </div>
                  <div className="flex justify-between">
                    <span>Tax (7%)</span>
                    <span className="text-gray-800">${totals.tax.toFixed(2)}</span>
                  </div>
                  <div className="flex justify-between text-blue-600">
                    <span>Card Fee (3%)</span>
                    <span>${totals.cardFee.toFixed(2)}</span>
                  </div>
                </div>
                
                <div className="flex justify-between items-center mb-8 pt-6 border-t border-gray-100">
                  <span className="text-4xl font-black text-gray-900">Total</span>
                  <span className="text-6xl font-black text-red-600 tracking-tighter">${totals.grandTotal.toFixed(2)}</span>
                </div>
                
                <button 
                  className="w-full h-28 bg-green-600 text-white text-5xl font-black rounded-3xl hover:bg-green-700 shadow-xl shadow-green-900/20 active:scale-95 transition-all flex items-center justify-center gap-4"
                  onClick={onPayNow}
                >
                  <span>CHECKOUT</span>
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={3} stroke="currentColor" className="w-12 h-12">
                    <path strokeLinecap="round" strokeLinejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
                  </svg>
                </button>
              </div>
            )}
          </motion.div>
        </>
      )}
    </AnimatePresence>
  );
}

==================================================
FILE PATH: src\components\kiosk\KioskHeader.tsx
==================================================
// src/components/kiosk/KioskHeader.tsx
import { Category } from '@/lib/types';

interface KioskHeaderProps {
  categories: Category[];
  activeTab: string;
  onTabChange: (name: string) => void;
}

export default function KioskHeader({ categories, activeTab, onTabChange }: KioskHeaderProps) {
  return (
    <div className="bg-white border-b border-gray-200 shrink-0 z-30">
      <div className="pt-8 px-6 pb-2 text-center relative">
        <h1 className="text-4xl font-black text-gray-900 tracking-tight leading-tight">
          The Collegiate Grill
        </h1>
        <p className="text-gray-400 font-bold tracking-widest text-sm uppercase mt-1">Since 1947</p>
        
        {/* ê¸°ì¡´ì— ìˆë˜ Start Over ë²„íŠ¼ ì‚­ì œë¨ */}
      </div>

      <div className="flex overflow-x-auto px-4 py-4 gap-3 scrollbar-hide items-center">
        {categories.map((cat, index) => {
          const displayName = cat.name === "Plates & Salads" ? "Salads" : cat.name;
          return (
            <button
              key={cat.id || index}
              onClick={() => onTabChange(cat.name)}
              className={`flex-shrink-0 px-6 h-18 rounded-full text-2xl font-extrabold transition-all shadow-sm border-[3px] whitespace-nowrap
                ${activeTab === cat.name 
                  ? 'bg-red-600 text-white border-red-600 shadow-md' 
                  : 'bg-white text-gray-600 border-gray-200 hover:bg-gray-50'}`}
            >
              {displayName}
            </button>
          );
        })}
      </div>
    </div>
  );
}

==================================================
FILE PATH: src\components\kiosk\KioskMain.tsx
==================================================
"use client";

import { Category, MenuItem, ModifierGroup } from '@/lib/types';
// âœ¨ [ì²´í¬] ì´ íŒŒì¼ì´ src/hooks/useKioskLogic.ts ìœ„ì¹˜ì— ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
import { useKioskLogic } from '@/hooks/useKioskLogic';

// UI Components (ê°™ì€ kiosk í´ë” ë‚´ì— ìˆìœ¼ë¯€ë¡œ ./ ì‚¬ìš©)
import KioskHeader from './KioskHeader';
import KioskCartDrawer from './KioskCartDrawer';
import ItemCard from './ItemCard';

// âœ¨ [ìˆ˜ì •] Modals (shared í´ë”ë¡œ ê²½ë¡œ ë³€ê²½)
import ModifierModal from '@/components/shared/ModifierModal';
import OrderTypeModal from '@/components/shared/OrderTypeModal';
import TableNumberModal from '@/components/shared/TableNumberModal';
import TipModal from '@/components/shared/TipModal';
import DayWarningModal from '@/components/shared/DayWarningModal';

interface Props {
  categories: Category[];
  items: MenuItem[];
  modifiersObj: { [key: string]: ModifierGroup };
}

export default function KioskMain({ categories, items, modifiersObj }: Props) {
  // Hookì—ì„œ ëª¨ë“  ë¡œì§ê³¼ ìƒíƒœë¥¼ ê°€ì ¸ì˜´
  const {
    activeTab, setActiveTab,
    cart, cartEndRef,
    isCartOpen, setIsCartOpen,
    selectedItem, setSelectedItem,
    showOrderTypeModal, setShowOrderTypeModal,
    showTableModal, setShowTableModal,
    showTipModal, setShowTipModal,
    showDayWarning, setShowDayWarning,
    warningTargetDay, isProcessing, isSuccess,
    addToCart, removeFromCart, handleItemClick,
    setSelectedOrderType, setCurrentTableNumber,
    processRealPayment, resetToHome, calculateTotals
  } = useKioskLogic(categories, items);

  const filteredItems = items.filter(item => item.category === activeTab);
  const totals = calculateTotals();

  return (
    <div className="flex flex-col h-full w-full bg-gray-100 relative overflow-hidden">
      
      {/* 1. Header (ë¡œê³  & ì¹´í…Œê³ ë¦¬) */}
      <KioskHeader 
        categories={categories} 
        activeTab={activeTab} 
        onTabChange={setActiveTab} 
      />

      {/* 2. Menu Grid */}
      <div className="flex-1 overflow-y-auto p-4 bg-gray-100">
        <div className="grid grid-cols-3 gap-4 pb-32"> 
          {filteredItems.length > 0 ? (
            filteredItems.map((item, index) => (
              <ItemCard 
                key={`${item.id}-${index}`} 
                item={item} 
                onClick={() => handleItemClick(item)} 
              />
            ))
          ) : (
            <div className="col-span-full flex flex-col items-center justify-center pt-20 text-gray-500">
                <p className="text-2xl font-bold">No items available.</p>
            </div>
          )}
        </div>
      </div>

      {/* 3. Floating Cart Button */}
      <button 
          onClick={() => setIsCartOpen(true)}
          className="absolute top-8 right-6 z-50 bg-white border-4 border-gray-100 p-4 rounded-[2.5rem] shadow-2xl active:scale-95 transition-all flex flex-col items-center justify-center gap-2 w-32 h-32"
      >
          <div className="relative">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2.5} stroke="currentColor" className="w-14 h-14 text-gray-900">
              <path strokeLinecap="round" strokeLinejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 00-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 00-16.536-1.84M7.5 14.25L5.106 5.272M6 20.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm12.75 0a.75.75 0 11-1.5 0 .75.75 0 011.5 0z" />
          </svg>
          {cart.length > 0 && (
              <span className="absolute -top-3 -right-3 bg-red-600 text-white text-xl font-black w-10 h-10 flex items-center justify-center rounded-full border-4 border-white shadow-md">
              {cart.length}
              </span>
          )}
          </div>
          {cart.length > 0 && (
              <span className="font-black text-gray-900 text-xl tracking-tight">${totals.grandTotal.toFixed(0)}</span>
          )}
      </button>

      {/* 4. Drawer UI */}
      <KioskCartDrawer 
        isOpen={isCartOpen}
        onClose={() => setIsCartOpen(false)}
        cart={cart}
        onRemove={removeFromCart}
        cartEndRef={cartEndRef}
        totals={totals}
        onPayNow={() => { setIsCartOpen(false); setShowOrderTypeModal(true); }}
        onClear={() => resetToHome()}
      />

      {/* 5. Modals (Logic Flow) */}
      {selectedItem && (
        <ModifierModal 
          item={selectedItem} 
          modifiersObj={modifiersObj} 
          onClose={() => setSelectedItem(null)} 
          onConfirm={addToCart} 
        />
      )}
      
      {showOrderTypeModal && (
        <OrderTypeModal 
          onSelect={(type) => {
            setSelectedOrderType(type);
            setShowOrderTypeModal(false);
            setShowTableModal(true); // ë¬´ì¡°ê±´ í…Œì´ë¸” ëª¨ë‹¬ë¡œ
          }} 
          onCancel={() => setShowOrderTypeModal(false)} 
        />
      )}
      
      {showTableModal && (
        <TableNumberModal 
          onConfirm={(num) => {
            setCurrentTableNumber(num);
            setShowTableModal(false);
            setShowTipModal(true);
          }} 
          onCancel={() => { setShowTableModal(false); setShowOrderTypeModal(true); }} 
        />
      )}
      
      {showTipModal && (
        <TipModal 
          subtotal={totals.subtotal} 
          onSelectTip={(tip) => {
            setShowTipModal(false);
            processRealPayment(tip);
          }} 
          onCancel={() => { setShowTipModal(false); setShowTableModal(true); }} 
        />
      )}
      
      {showDayWarning && <DayWarningModal targetDay={warningTargetDay} onClose={() => setShowDayWarning(false)} />}
      
      {/* 6. Status Overlays */}
      {isProcessing && (
         <div className="fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-md">
            <div className="bg-white p-10 rounded-[2.5rem] shadow-2xl flex flex-col items-center w-[90%] text-center">
              <div className="mb-6 animate-spin"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-20 h-20 text-blue-600"><path strokeLinecap="round" strokeLinejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" /></svg></div>
              <h2 className="text-3xl font-black text-gray-900 mb-4">Processing...</h2>
              <p className="text-xl text-gray-600">Please check the Card Reader.</p>
           </div>
         </div>
      )}
      {isSuccess && (
         <div className="fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-md">
            <div className="bg-white p-8 rounded-[2.5rem] shadow-2xl flex flex-col items-center w-[90%] text-center animate-bounce-in">
              <div className="mb-4 bg-green-100 rounded-full p-6"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2.5} stroke="currentColor" className="w-16 h-16 text-green-600"><path strokeLinecap="round" strokeLinejoin="round" d="M4.5 12.75l6 6 9-13.5" /></svg></div>
              <h2 className="text-4xl font-black text-gray-900 mb-2">Thank You!</h2>
              <p className="text-xl text-gray-500 mb-6">Payment Complete.</p>
              <div className="bg-blue-50 border-2 border-blue-200 p-6 rounded-3xl w-full shadow-md">
                <p className="text-lg text-gray-800 font-bold leading-tight mb-2">ğŸ¥¤ If you ordered a Drink,</p>
                <p className="text-xl text-blue-800 font-black leading-tight">Please <span className="text-red-600 underline">SHOW RECEIPT</span> for a cup.</p>
              </div>
            </div>
         </div>
      )}
    </div>
  );
}

==================================================
FILE PATH: src\components\pos\CardPaymentModal.tsx
==================================================
'use client';

import { motion, AnimatePresence } from 'framer-motion';

interface CardPaymentModalProps {
  isOpen: boolean;
  statusMessage: string;
  onCancel: () => void; // ì·¨ì†Œ ë²„íŠ¼ ëˆ„ë¥´ë©´ ì‹¤í–‰ë  í•¨ìˆ˜
}

export default function CardPaymentModal({
  isOpen,
  statusMessage,
  onCancel,
}: CardPaymentModalProps) {
  
  if (!isOpen) return null;

  return (
    <AnimatePresence>
      <div className="fixed inset-0 z-[60] flex items-center justify-center bg-black/80 backdrop-blur-sm">
        <motion.div 
          initial={{ opacity: 0, scale: 0.9 }}
          animate={{ opacity: 1, scale: 1 }}
          exit={{ opacity: 0, scale: 0.9 }}
          className="bg-white w-[500px] p-8 rounded-3xl shadow-2xl flex flex-col items-center text-center"
        >
          {/* 1. ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ (ë¹™ê¸€ë¹™ê¸€) */}
          <div className="mb-6 relative">
            <div className="w-20 h-20 border-4 border-gray-200 rounded-full"></div>
            <div className="w-20 h-20 border-4 border-blue-600 rounded-full animate-spin absolute top-0 left-0 border-t-transparent"></div>
          </div>

          {/* 2. ìƒíƒœ ë©”ì‹œì§€ (ì˜ˆ: Please Insert Card...) */}
          <h2 className="text-2xl font-bold text-slate-800 mb-2">Card Payment</h2>
          <p className="text-lg text-gray-600 font-medium mb-8 whitespace-pre-wrap">
            {statusMessage}
          </p>

          {/* 3. âœ¨ [ì·¨ì†Œ ë²„íŠ¼] ì´ê²Œ í•„ìš”í–ˆë˜ ê²ë‹ˆë‹¤! */}
          <button 
            onClick={onCancel}
            className="w-full py-4 bg-red-50 hover:bg-red-100 text-red-600 border border-red-200 rounded-xl font-bold text-lg transition-colors flex items-center justify-center gap-2"
          >
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" className="w-6 h-6">
              <path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
            Cancel Transaction
          </button>
          
          <p className="mt-4 text-xs text-gray-400">
            Pressing cancel will reset the terminal.
          </p>

        </motion.div>
      </div>
    </AnimatePresence>
  );
}

==================================================
FILE PATH: src\components\pos\CashDrawerBtn.tsx
==================================================


==================================================
FILE PATH: src\components\pos\CashPaymentModal.tsx
==================================================
'use client';

import { useState, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';

interface CashPaymentModalProps {
  isOpen: boolean;
  onClose: () => void;
  totalAmount: number;
  onConfirm: (receivedAmount: number, change: number) => void;
}

export default function CashPaymentModal({
  isOpen,
  onClose,
  totalAmount,
  onConfirm,
}: CashPaymentModalProps) {
  // âœ¨ [ê°œì„ ] ì •ìˆ˜í˜• ì„¼íŠ¸ ë‹¨ìœ„ë¡œ ê´€ë¦¬ (ì˜ˆ: 1250 -> $12.50)
  const [inputCents, setInputCents] = useState(0);

  useEffect(() => {
    if (isOpen) setInputCents(0);
  }, [isOpen]);

  // ê°’ ê³„ì‚°
  const receivedAmount = inputCents / 100;
  const change = receivedAmount - totalAmount;
  const isSufficient = receivedAmount >= totalAmount;

  // âœ¨ [ìˆ«ì ì…ë ¥ ë¡œì§ ê°œì„ ] 1 -> 2 -> 5 ì…ë ¥ ì‹œ $1.25ê°€ ë¨ (POS í‘œì¤€ ë°©ì‹)
  const handleNumClick = (num: number) => {
    if (inputCents > 1000000) return; // ë„ˆë¬´ í° ê¸ˆì•¡ ë°©ì§€
    setInputCents((prev) => prev * 10 + num);
  };

  const handleBackspace = () => setInputCents((prev) => Math.floor(prev / 10));
  const handleClear = () => setInputCents(0);
  
  // ì •í™•í•œ ê¸ˆì•¡ (Exact)
  const handleExact = () => {
    setInputCents(Math.round(totalAmount * 100));
  };

  // âœ¨ [ìŠ¤ë§ˆíŠ¸ ì¶”ì²œ] ì§€í ë‹¨ìœ„ ì¶”ì²œ ë²„íŠ¼ ìƒì„±
  const getSmartTenders = () => {
    // ğŸ”´ ê¸°ì¡´ (ì—ëŸ¬): const suggestions = [];
    // ğŸŸ¢ ìˆ˜ì •: ìˆ«ì ë°°ì—´ì„ì„ ëª…ì‹œ (: number[])
    const suggestions: number[] = []; 
    
    const current = totalAmount;

    // 1. Next Dollar (ì˜ˆ: 12.50 -> 13.00)
    if (current % 1 !== 0) {
        suggestions.push(Math.ceil(current));
    }
    // 2. $5, $10, $20, $50, $100 ë‹¨ìœ„
    [5, 10, 20, 50, 100].forEach(bill => {
        if (bill > current) {
            // ì´ë¯¸ Next Dollarì— í¬í•¨ëœ ê²½ìš° ì¤‘ë³µ ë°©ì§€
            if (!suggestions.includes(bill)) suggestions.push(bill);
        }
    });

    // ìµœëŒ€ 3~4ê°œë§Œ í‘œì‹œ
    return suggestions.slice(0, 3);
  };

  if (!isOpen) return null;

  return (
    <AnimatePresence>
      <div className="fixed inset-0 z-[60] flex items-center justify-center bg-black/70 backdrop-blur-sm">
        <motion.div 
          initial={{ opacity: 0, scale: 0.95 }}
          animate={{ opacity: 1, scale: 1 }}
          exit={{ opacity: 0, scale: 0.95 }}
          className="bg-white w-[900px] h-[600px] rounded-3xl shadow-2xl overflow-hidden flex"
        >
          
          {/* --- [Left] Amount Display Section --- */}
          <div className="w-[45%] bg-slate-50 p-8 flex flex-col justify-between border-r border-gray-200">
            <div>
                <h2 className="text-3xl font-extrabold text-slate-800 mb-8">Cash Payment</h2>
                
                <div className="mb-8 p-4 bg-white rounded-2xl border border-gray-200 shadow-sm">
                    <h3 className="text-gray-500 text-sm font-bold uppercase tracking-wider mb-1">Total Due</h3>
                    <div className="text-5xl font-black text-slate-900">
                        ${totalAmount.toFixed(2)}
                    </div>
                </div>

                <div className="mb-8">
                    <h3 className="text-gray-500 text-sm font-bold uppercase tracking-wider mb-1">Tendered</h3>
                    <div className={`text-6xl font-black transition-colors border-b-4 pb-2 ${
                        receivedAmount > 0 ? 'text-blue-600 border-blue-600' : 'text-gray-300 border-gray-300'
                    }`}>
                        ${receivedAmount.toFixed(2)}
                    </div>
                </div>

                <div>
                    <h3 className="text-gray-500 text-sm font-bold uppercase tracking-wider mb-1">Change Due</h3>
                    <div className={`text-5xl font-black ${isSufficient ? 'text-green-600' : 'text-red-400'}`}>
                        ${isSufficient ? change.toFixed(2) : '0.00'}
                    </div>
                    {!isSufficient && receivedAmount > 0 && (
                        <p className="text-red-500 font-bold mt-2 animate-pulse">Insufficient Funds</p>
                    )}
                </div>
            </div>
            
            <button onClick={onClose} className="flex items-center gap-2 text-gray-500 hover:text-gray-800 font-bold transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" className="w-6 h-6">
                  <path strokeLinecap="round" strokeLinejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
                </svg>
                Back to Order
            </button>
          </div>

          {/* --- [Right] Keypad Section --- */}
          <div className="w-[55%] p-6 bg-white flex flex-col">
            
            {/* ìŠ¤ë§ˆíŠ¸ ì¶”ì²œ ë²„íŠ¼ ì˜ì—­ */}
            <div className="grid grid-cols-4 gap-3 mb-4 h-16">
                <button 
                    onClick={handleExact}
                    className="bg-blue-50 text-blue-700 font-bold rounded-xl border-2 border-blue-100 hover:bg-blue-100 active:scale-95 transition-all text-sm"
                >
                    Exact<br/>${totalAmount.toFixed(2)}
                </button>
                {getSmartTenders().map(amount => (
                    <button
                        key={amount}
                        onClick={() => setInputCents(amount * 100)}
                        className="bg-gray-50 text-gray-700 font-bold rounded-xl border-2 border-gray-100 hover:bg-gray-100 hover:border-gray-300 active:scale-95 transition-all text-lg"
                    >
                        ${amount}
                    </button>
                ))}
            </div>

            {/* ìˆ«ì í‚¤íŒ¨ë“œ */}
            <div className="flex-1 grid grid-cols-3 gap-3 mb-4">
              {[1, 2, 3, 4, 5, 6, 7, 8, 9].map((num) => (
                <button
                  key={num}
                  onClick={() => handleNumClick(num)}
                  className="rounded-2xl bg-white border border-gray-200 text-4xl font-bold text-slate-700 shadow-[0_4px_0_0_rgba(0,0,0,0.05)] hover:bg-gray-50 active:shadow-none active:translate-y-[2px] transition-all"
                >
                  {num}
                </button>
              ))}
              
              <button 
                onClick={handleClear} 
                className="rounded-2xl bg-red-50 border border-red-100 text-xl font-bold text-red-500 hover:bg-red-100 active:scale-95 transition-all"
              >
                Clear
              </button>
              
              <button 
                onClick={() => handleNumClick(0)} 
                className="rounded-2xl bg-white border border-gray-200 text-4xl font-bold text-slate-700 shadow-[0_4px_0_0_rgba(0,0,0,0.05)] hover:bg-gray-50 active:shadow-none active:translate-y-[2px] transition-all"
              >
                0
              </button>
              
              <button 
                onClick={handleBackspace} 
                className="rounded-2xl bg-gray-100 border border-gray-200 text-slate-600 hover:bg-gray-200 active:scale-95 transition-all flex items-center justify-center"
              >
                 <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" className="w-8 h-8">
                  <path strokeLinecap="round" strokeLinejoin="round" d="M12 9.75L14.25 12m0 0l2.25 2.25M14.25 12l2.25-2.25M14.25 12L12 14.25m-2.58 4.92l-6.375-6.375a1.125 1.125 0 010-1.59L9.42 4.83c.211-.211.498-.33.796-.33H19.5a2.25 2.25 0 012.25 2.25v10.5a2.25 2.25 0 01-2.25 2.25h-9.284c-.298 0-.585-.119-.796-.33z" />
                </svg>
              </button>
            </div>

            {/* ê²°ì œ ë²„íŠ¼ */}
            <button 
              onClick={() => isSufficient && onConfirm(receivedAmount, change)}
              disabled={!isSufficient}
              className={`w-full py-5 rounded-2xl text-2xl font-black shadow-lg transition-all active:scale-[0.98] flex items-center justify-center gap-3
                ${isSufficient 
                  ? 'bg-green-600 text-white hover:bg-green-700 shadow-green-200' 
                  : 'bg-gray-200 text-gray-400 cursor-not-allowed'}`}
            >
              <span>PAY CASH</span>
              {isSufficient && <span className="text-3xl">â”</span>}
            </button>

          </div>
        </motion.div>
      </div>
    </AnimatePresence>
  );
}

==================================================
FILE PATH: src\components\pos\ClosingReportModal.tsx
==================================================
'use client';

import { useState, useEffect } from 'react';

// ë°ì´í„° íƒ€ì… ì •ì˜
interface ClosingData {
  date: string;
  employeeName: string;
  cashTotal: number;
  cardTotal: number;
  tipTotal: number;
  grandTotal: number;
  orderCount: number;
}

interface Props {
  employeeName: string;
  onClose: () => void;
}

export default function ClosingReportModal({ employeeName, onClose }: Props) {
  // ì˜¤ëŠ˜ ë‚ ì§œë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì • (YYYY-MM-DD í˜•ì‹)
  const [targetDate, setTargetDate] = useState(() => {
    const now = new Date();
    // ë¡œì»¬ ì‹œê°„ëŒ€ ê¸°ì¤€ YYYY-MM-DD ì¶”ì¶œ
    const offset = now.getTimezoneOffset() * 60000;
    return new Date(now.getTime() - offset).toISOString().split('T')[0];
  });

  const [data, setData] = useState<ClosingData | null>(null);
  const [loading, setLoading] = useState(true);
  const [printing, setPrinting] = useState(false);
  const [errorMsg, setErrorMsg] = useState('');

  // 1. ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ë‚ ì§œê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ ì‹¤í–‰)
  useEffect(() => {
    let isMounted = true;
    
    const fetchData = async () => {
      setLoading(true); // ë‚ ì§œ ë³€ê²½ ì‹œ ë¡œë”© í‘œì‹œ
      setErrorMsg('');  // ì—ëŸ¬ ì´ˆê¸°í™”

      try {
        const res = await fetch('/api/reports/closing', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            employeeName, 
            print: false, 
            targetDate // âœ¨ ì„ íƒëœ ë‚ ì§œ ì „ì†¡
          })
        });
        const json = await res.json();
        
        if (isMounted) {
          if (json.success) {
            setData(json.data);
          } else {
            setErrorMsg("Failed to load report data.");
            setData(null);
          }
          setLoading(false);
        }
      } catch (e) {
        if (isMounted) {
          setErrorMsg("Network error occurred.");
          setLoading(false);
        }
      }
    };

    fetchData();
    return () => { isMounted = false; };
  }, [employeeName, targetDate]); // âœ¨ targetDateê°€ ë°”ë€Œë©´ ì¬ì‹¤í–‰

  // 2. ì¸ì‡„ í•¸ë“¤ëŸ¬
  const handlePrint = async () => {
    if (!window.confirm(`Print Report for [ ${targetDate} ]?`)) return;
    
    setPrinting(true);
    try {
      await fetch('/api/reports/closing', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
            employeeName, 
            print: true,
            targetDate // âœ¨ ì¸ì‡„í•  ë•Œë„ ë‚ ì§œ ì „ì†¡
        })
      });
      alert("ğŸ–¨ï¸ Sent to Printer!");
      onClose();
    } catch (e) {
      alert("Print failed");
    } finally {
      setPrinting(false);
    }
  };

  // 3. í™”ë©´ ë Œë”ë§ ì»¨í…ì¸  ê²°ì •
  let content;

  if (loading) {
    content = (
      <div className="flex justify-center py-20">
        <div className="animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600"></div>
      </div>
    );
  } else if (errorMsg) {
    content = (
      <div className="flex flex-col items-center justify-center py-20 text-red-500">
        <p className="text-2xl font-bold mb-2">Error</p>
        <p>{errorMsg}</p>
      </div>
    );
  } else if (data) {
    content = (
      <div className="space-y-6">
        {/* í•µì‹¬: í˜„ê¸ˆ ë§¤ì¶œ */}
        <div className="bg-green-50 border-4 border-green-200 rounded-3xl p-8 text-center shadow-inner">
          <p className="text-green-700 font-bold uppercase text-lg mb-2">Total Cash (In Drawer)</p>
          <p className="text-6xl font-black text-green-800 tracking-tighter">
            ${data.cashTotal.toFixed(2)}
          </p>
          <p className="text-green-600 text-sm mt-2 font-medium">For Date: {targetDate}</p>
        </div>

        {/* ìƒì„¸ ë‚´ì—­ */}
        <div className="space-y-4 text-xl px-2">
          <div className="flex justify-between border-b border-gray-100 pb-3">
            <span className="text-gray-500 font-medium">Total Orders</span>
            <span className="font-bold text-gray-800">{data.orderCount}</span>
          </div>
          <div className="flex justify-between border-b border-gray-100 pb-3">
            <span className="text-gray-500 font-medium">Card Sales</span>
            <span className="font-bold text-gray-800">${data.cardTotal.toFixed(2)}</span>
          </div>
          <div className="flex justify-between border-b border-gray-100 pb-3 text-blue-600 bg-blue-50 px-3 py-2 rounded-lg">
            <span className="font-bold">Total Tips (Payout)</span>
            <span className="font-black">+ ${data.tipTotal.toFixed(2)}</span>
          </div>
          <div className="flex justify-between pt-4 text-3xl">
            <span className="font-black text-gray-900">Grand Total</span>
            <span className="font-black text-gray-900">${data.grandTotal.toFixed(2)}</span>
          </div>
        </div>
      </div>
    );
  } else {
    content = <div className="text-center py-20 text-gray-500">No data found.</div>;
  }

  return (
    <div className="fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-md p-4 animate-in fade-in duration-200">
      <div className="bg-white w-full max-w-lg rounded-[2rem] shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
        
        {/* í—¤ë” + ë‚ ì§œ ì„ íƒê¸° */}
        <div className="bg-gray-900 text-white p-6 text-center shrink-0">
          <h2 className="text-3xl font-black uppercase tracking-wide mb-4">Closing Report</h2>
          
          {/* âœ¨ ë‚ ì§œ ì„ íƒ Input */}
          <div className="flex justify-center">
            <input 
              type="date" 
              value={targetDate}
              onChange={(e) => setTargetDate(e.target.value)}
              className="bg-gray-800 text-white text-xl font-bold px-6 py-2 rounded-xl border border-gray-600 focus:outline-none focus:border-blue-500 text-center"
            />
          </div>
        </div>

        {/* ì»¨í…ì¸  */}
        <div className="p-6 overflow-y-auto flex-1 bg-white">
          {content}
        </div>

        {/* í•˜ë‹¨ ë²„íŠ¼ */}
        <div className="p-6 bg-gray-50 border-t border-gray-200 grid grid-cols-2 gap-4 shrink-0">
          <button 
            onClick={onClose}
            className="py-4 rounded-2xl font-bold text-gray-600 bg-white border-2 border-gray-200 hover:bg-gray-100 text-xl transition-colors"
          >
            Close
          </button>
          
          <button 
            onClick={handlePrint}
            disabled={loading || printing || !data}
            className="py-4 rounded-2xl font-black text-white bg-blue-600 hover:bg-blue-500 shadow-xl active:scale-95 transition-all text-xl flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            {printing ? (
               <div className="flex items-center">
                 <span className="animate-spin h-5 w-5 border-2 border-white border-t-transparent rounded-full mr-2"></span>
                 Printing...
               </div>
            ) : (
               <div className="flex items-center">
                 <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2.5} stroke="currentColor" className="w-6 h-6 mr-2">
                   <path strokeLinecap="round" strokeLinejoin="round" d="M6.72 13.829c-.24.03-.48.062-.72.096m.72-.096a42.415 42.415 0 0110.56 0m-10.56 0L6.34 18m10.94-4.171c.24.03.48.062.72.096m-.72-.096L17.66 18m0 0l.229 2.523a1.125 1.125 0 01-1.12 1.227H7.231c-.662 0-1.18-.568-1.12-1.227L6.34 18m11.318 0h1.091A2.25 2.25 0 0021 15.75V9.456c0-1.081-.768-2.015-1.837-2.175a48.055 48.055 0 00-1.913-.247M6.34 18H5.25A2.25 2.25 0 013 15.75V9.456c0-1.081.768-2.015 1.837-2.175a48.041 48.041 0 011.913-.247m10.5 0a48.536 48.536 0 00-10.5 0m10.5 0V3.375c0-.621-.504-1.125-1.125-1.125h-8.25c-.621 0-1.125.504-1.125 1.125v3.659M18 10.5h.008v.008H18V10.5zm-3 0h.008v.008H15V10.5z" />
                 </svg>
                 PRINT
               </div>
            )}
          </button>
        </div>

      </div>
    </div>
  );
}

==================================================
FILE PATH: src\components\pos\CustomerNameModal.tsx
==================================================
'use client';

import { useState, useRef } from 'react';
// âœ¨ ê°€ìƒ í‚¤ë³´ë“œ ì„í¬íŠ¸
import Keyboard from 'react-simple-keyboard';
import 'react-simple-keyboard/build/css/index.css';

interface Props {
  onClose: () => void;
  onConfirm: (name: string) => void;
}

export default function CustomerNameModal({ onClose, onConfirm }: Props) {
  const [name, setName] = useState('');
  const [layoutName, setLayoutName] = useState("default");
  const keyboard = useRef(null);

  const handleSubmit = (e?: React.FormEvent) => {
    e?.preventDefault();
    if (!name.trim()) return alert("Please enter a name.");
    onConfirm(name.trim());
  };

  // í‚¤ë³´ë“œ ì…ë ¥ í•¸ë“¤ëŸ¬
  const onChange = (input: string) => {
    setName(input);
  };

  const onKeyPress = (button: string) => {
    if (button === "{shift}" || button === "{lock}") {
      setLayoutName(layoutName === "default" ? "shift" : "default");
    }
    if (button === "{enter}") {
        handleSubmit();
    }
  };

  return (
    <div className="fixed inset-0 bg-black/80 z-[9999] flex items-center justify-center p-4 backdrop-blur-sm">
      {/* âœ¨ ë„ˆë¹„ë¥¼ ì¢€ ë” ë„“ê²Œ ìˆ˜ì • (max-w-3xl) */}
      <div className="bg-gray-900 rounded-2xl w-full max-w-3xl border border-gray-700 shadow-2xl overflow-hidden flex flex-col max-h-[95vh]">
        
        {/* í—¤ë” */}
        <div className="bg-gray-800 p-6 border-b border-gray-700 shrink-0">
          <h2 className="text-3xl font-black text-white">ğŸ“ Phone Order</h2>
          <p className="text-gray-400 mt-1">Enter Customer Name for To Go</p>
        </div>

        {/* ì…ë ¥ í¼ & í‚¤ë³´ë“œ */}
        <div className="p-8 flex-1 overflow-y-auto">
          <input
            autoFocus
            type="text"
            value={name}
            onChange={(e) => {
                setName(e.target.value);
                // @ts-ignore
                keyboard.current?.setInput(e.target.value);
            }}
            placeholder="e.g. John Doe"
            className="w-full bg-gray-950 text-white text-3xl font-bold p-5 rounded-xl border-2 border-gray-600 focus:border-blue-500 focus:outline-none placeholder-gray-600 mb-6"
          />

          {/* âœ¨ ê°€ìƒ í‚¤ë³´ë“œ */}
          <div className="text-gray-900 mb-6">
             <Keyboard
                keyboardRef={r => (keyboard.current = r)}
                layoutName={layoutName}
                onChange={onChange}
                onKeyPress={onKeyPress}
                input={name}
                theme={"hg-theme-default hg-layout-default myTheme"}
                layout={{
                    default: [
                      "1 2 3 4 5 6 7 8 9 0 - = {bksp}",
                      "q w e r t y u i o p [ ] \\",
                      "a s d f g h j k l ; ' {enter}",
                      "{shift} z x c v b n m , . / {shift}",
                      "{space}"
                    ],
                    shift: [
                      "! @ # $ % ^ & * ( ) _ + {bksp}",
                      "Q W E R T Y U I O P { } |",
                      "A S D F G H J K L : \" {enter}",
                      "{shift} Z X C V B N M < > ? {shift}",
                      "{space}"
                    ]
                  }}
                  display={{
                    "{bksp}": "âŒ«",
                    "{enter}": "CONFIRM",
                    "{shift}": "â‡§",
                    "{space}": "SPACE",
                  }}
                  buttonTheme={[
                    {
                        class: "hg-purple",
                        buttons: "{enter}"
                    }
                  ]}
              />
          </div>

          <div className="grid grid-cols-2 gap-4">
            <button
              type="button"
              onClick={onClose}
              className="bg-gray-700 hover:bg-gray-600 text-gray-200 text-xl font-bold py-5 rounded-xl transition-colors"
            >
              Cancel
            </button>
            <button
              onClick={() => handleSubmit()}
              className="bg-purple-600 hover:bg-purple-500 text-white text-xl font-bold py-5 rounded-xl shadow-lg shadow-purple-900/30 transition-colors"
            >
              Confirm
            </button>
          </div>
        </div>
      </div>

      {/* í‚¤ë³´ë“œ ìŠ¤íƒ€ì¼ (Dark Modeìš©) */}
      <style jsx global>{`
        .hg-theme-default {
            background-color: #374151; /* gray-700 */
            padding: 10px;
            border-radius: 10px;
            color: black;
        }
        .hg-button {
            height: 60px !important;
            font-weight: bold !important;
            font-size: 1.2rem !important;
            background-color: #e5e7eb !important; /* gray-200 */
            color: #1f2937 !important; /* gray-800 */
        }
        /* íŠ¹ìˆ˜ ë²„íŠ¼ ìƒ‰ìƒ */
        .hg-purple { 
            background: #9333ea !important; /* purple-600 */ 
            color: white !important; 
        }
      `}</style>
    </div>
  );
}

==================================================
FILE PATH: src\components\pos\EmployeeLogin.tsx
==================================================
"use client";
import { useState, useEffect } from 'react';
import { createBrowserClient } from '@supabase/ssr';

interface Props {
  onLoginSuccess: (employee: { id: number; name: string; role: string }) => void;
}

export default function EmployeeLogin({ onLoginSuccess }: Props) {
  const [pin, setPin] = useState("");
  const [error, setError] = useState("");
  const [loading, setLoading] = useState(false);

  const supabase = createBrowserClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  );

  const handleNumClick = (num: string) => {
    if (pin.length < 6) setPin(prev => prev + num);
    setError("");
  };

  const handleClear = () => setPin("");
  const handleBackspace = () => setPin(prev => prev.slice(0, -1));

  const handleLogin = async () => {
    if (!pin) return;
    setLoading(true);
    
    // DBì—ì„œ PIN í™•ì¸
    const { data, error } = await supabase
      .from('employees')
      .select('*')
      .eq('pin_code', pin)
      .eq('is_active', true)
      .single();

    setLoading(false);

    if (data) {
      // ë¡œê·¸ì¸ ì„±ê³µ
      onLoginSuccess({ id: data.id, name: data.name, role: data.role });
    } else {
      setError("Invalid PIN Code");
      setPin("");
    }
  };

  return (
    <div className="fixed inset-0 bg-gray-900 flex items-center justify-center z-[9999]">
      <div className="bg-white p-8 rounded-3xl shadow-2xl w-[400px] text-center">
        <h2 className="text-3xl font-black text-gray-800 mb-2">POS LOGIN</h2>
        <p className="text-gray-400 mb-8">Enter your Employee PIN</p>

        {/* PIN Display */}
        <div className="bg-gray-100 p-4 rounded-xl mb-6 flex justify-center items-center h-16 border-2 border-transparent focus-within:border-blue-500">
          <span className="text-4xl font-mono tracking-[1em] text-gray-800">
            {'â€¢'.repeat(pin.length)}
          </span>
        </div>

        {error && <p className="text-red-500 font-bold mb-4 animate-pulse">{error}</p>}

        {/* Keypad */}
        <div className="grid grid-cols-3 gap-4 mb-6">
          {[1, 2, 3, 4, 5, 6, 7, 8, 9].map(num => (
            <button key={num} onClick={() => handleNumClick(num.toString())} className="h-20 bg-gray-50 rounded-2xl text-2xl font-bold text-gray-700 hover:bg-blue-50 hover:text-blue-600 active:scale-95 transition-all shadow-sm border border-gray-200">
              {num}
            </button>
          ))}
          <button onClick={handleClear} className="h-20 bg-red-50 text-red-500 font-bold rounded-2xl hover:bg-red-100">C</button>
          <button onClick={() => handleNumClick("0")} className="h-20 bg-gray-50 text-gray-700 font-bold text-2xl rounded-2xl hover:bg-blue-50">0</button>
          <button onClick={handleBackspace} className="h-20 bg-gray-50 text-gray-700 font-bold rounded-2xl hover:bg-gray-200">â†</button>
        </div>

        <button 
          onClick={handleLogin} 
          disabled={loading || pin.length === 0}
          className="w-full h-16 bg-blue-600 text-white text-xl font-black rounded-2xl hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-all shadow-lg"
        >
          {loading ? "Checking..." : "ENTER"}
        </button>
      </div>
    </div>
  );
}

==================================================
FILE PATH: src\components\pos\OrderListModal.tsx
==================================================
'use client';

import { useState, useEffect } from 'react';

interface Props {
  onClose: () => void;
  onRecallOrder: (order: any) => void;
  // âœ¨ [ì¶”ê°€] í™˜ë¶ˆ í•¸ë“¤ëŸ¬ ë°›ê¸°
  onRefundOrder: (order: any) => void;
}

export default function OrderListModal({ onClose, onRecallOrder, onRefundOrder }: Props) {
  const [orders, setOrders] = useState<any[]>([]);
  const [activeTab, setActiveTab] = useState<'open' | 'paid' | 'refunded'>('open'); // âœ¨ refunded íƒ­ ì¶”ê°€
  const [isLoading, setIsLoading] = useState(true);

  const fetchOrders = () => {
    setIsLoading(true);
    fetch('/api/orders/list')
      .then(res => res.json())
      .then(data => {
        if (data.success) setOrders(data.orders);
      })
      .catch(err => console.error(err))
      .finally(() => setIsLoading(false));
  };

  useEffect(() => {
    fetchOrders();
  }, []);

  const filteredOrders = orders.filter(o => o.status === activeTab);

  return (
    <div className="fixed inset-0 bg-black/80 z-[9999] flex items-center justify-center p-6 backdrop-blur-sm">
      <div className="bg-gray-900 w-full max-w-5xl h-[85vh] rounded-3xl border border-gray-700 flex flex-col shadow-2xl overflow-hidden">
        
        {/* í—¤ë” */}
        <div className="p-6 bg-gray-800 border-b border-gray-700 flex justify-between items-center shrink-0">
          <h2 className="text-3xl font-black text-white">ğŸ“‹ Order History</h2>
          <button onClick={onClose} className="bg-gray-700 hover:bg-gray-600 text-white p-3 rounded-full">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2.5} stroke="currentColor" className="w-8 h-8">
               <path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>

        {/* íƒ­ ë²„íŠ¼ */}
        <div className="flex border-b border-gray-700 shrink-0">
          <button onClick={() => setActiveTab('open')} className={`flex-1 py-5 text-xl font-bold transition-colors ${activeTab === 'open' ? 'bg-blue-600 text-white' : 'bg-gray-900 text-gray-500'}`}>
            â³ OPEN ({orders.filter(o => o.status === 'open').length})
          </button>
          <button onClick={() => setActiveTab('paid')} className={`flex-1 py-5 text-xl font-bold transition-colors ${activeTab === 'paid' ? 'bg-green-600 text-white' : 'bg-gray-900 text-gray-500'}`}>
            âœ… PAID
          </button>
          {/* âœ¨ í™˜ë¶ˆëœ ë‚´ì—­ íƒ­ */}
          <button onClick={() => setActiveTab('refunded')} className={`flex-1 py-5 text-xl font-bold transition-colors ${activeTab === 'refunded' ? 'bg-red-600 text-white' : 'bg-gray-900 text-gray-500'}`}>
            â†©ï¸ REFUNDED
          </button>
        </div>

        {/* ë¦¬ìŠ¤íŠ¸ ì˜ì—­ */}
        <div className="flex-1 overflow-y-auto p-6 bg-black/50">
          {isLoading ? (
            <div className="text-white text-center mt-20 text-2xl">Loading orders...</div>
          ) : filteredOrders.length === 0 ? (
            <div className="text-gray-500 text-center mt-20 text-2xl font-bold">No {activeTab} orders found.</div>
          ) : (
            <div className="grid grid-cols-1 gap-4">
              {filteredOrders.map((order) => (
                <div 
                  key={order.id} 
                  className={`p-5 rounded-2xl border-2 flex justify-between items-center transition-all
                    ${activeTab === 'open' 
                      ? 'bg-gray-800 border-blue-900 hover:border-blue-500 cursor-pointer' 
                      : 'bg-gray-900 border-gray-800 opacity-80'}`}
                  onClick={() => {
                    if (activeTab === 'open') {
                        if(confirm(`Recall Open Order #${order.order_number}?`)) onRecallOrder(order);
                    }
                  }}
                >
                  <div>
                    <div className="flex items-center gap-3 mb-2">
                      <span className="bg-gray-700 text-white px-3 py-1 rounded text-sm font-bold">#{order.order_number}</span>
                      <span className="text-yellow-400 font-bold text-xl">{order.table_number}</span>
                      <span className="text-gray-400 text-sm">{new Date(order.created_at).toLocaleString()}</span>
                    </div>
                    <div className="text-gray-300 text-sm">
                      {order.order_items?.map((item: any) => item.item_name).join(', ')}
                    </div>
                  </div>

                  <div className="text-right flex flex-col items-end gap-2">
                    <div className="text-2xl font-black text-white">${order.total_amount.toFixed(2)}</div>
                    
                    {activeTab === 'open' && <span className="text-blue-400 font-bold text-sm bg-blue-900/30 px-2 py-1 rounded">Click to Pay</span>}
                    
                    {activeTab === 'paid' && (
                       <div className="flex gap-2 items-center">
                          <span className="text-green-500 font-bold text-sm mr-2">{order.payment_method}</span>
                          {/* âœ¨ [í•µì‹¬] í™˜ë¶ˆ ë²„íŠ¼ */}
                          <button 
                            onClick={(e) => {
                                e.stopPropagation();
                                onRefundOrder(order);
                            }}
                            className="bg-red-900 text-red-300 text-xs px-3 py-1 rounded border border-red-700 hover:bg-red-600 hover:text-white font-bold transition-colors"
                          >
                             REFUND
                          </button>
                       </div>
                    )}

                    {activeTab === 'refunded' && <span className="text-red-500 font-bold text-sm border border-red-500 px-2 rounded">REFUNDED</span>}
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>
      </div>
    </div>
  );
}

==================================================
FILE PATH: src\components\pos\PosCart.tsx
==================================================
import { CartItem } from '@/lib/types';

interface Props {
  cart: CartItem[];
  subtotal: number;
  onRemoveItem: (id: string) => void;
  onPaymentStart: (method: 'CASH' | 'CARD') => void;
  onEditNote: (item: CartItem) => void;
  onPhoneOrder: () => void;
}

export default function PosCart({ cart, subtotal, onRemoveItem, onPaymentStart, onEditNote, onPhoneOrder }: Props) {
  
  return (
    <div className="h-full flex flex-col bg-gray-900 border-r border-gray-800 text-white">
      
      {/* 1. ì¹´íŠ¸ í—¤ë” (ë²„íŠ¼ ì œê±°ë¨) */}
      <div className="flex-none p-4 border-b border-gray-800 bg-gray-800 shadow-md flex justify-between items-center">
        <h2 className="text-xl font-bold flex items-center gap-2 text-white">
          ğŸ›’ Orders
          <span className="bg-blue-600 text-white text-xs px-2 py-1 rounded-full">{cart.length}</span>
        </h2>
        {/* ìƒë‹¨ ë²„íŠ¼ ì œê±°ë¨ */}
      </div>

      {/* 2. ì£¼ë¬¸ ì•„ì´í…œ ë¦¬ìŠ¤íŠ¸ */}
      <div className="flex-1 overflow-y-auto p-2 space-y-3">
        {cart.length === 0 ? (
          <div className="h-full flex flex-col items-center justify-center text-gray-500 opacity-50">
            <p className="text-xl font-medium">Cart is empty</p>
          </div>
        ) : (
          cart.map((item) => (
            <div key={item.uniqueCartId} className="bg-gray-800 rounded-xl p-4 relative hover:bg-gray-750 border border-gray-700 shadow-sm transition-colors">
              
              <div className="flex justify-between items-start mb-2">
                 <div className="pr-2">
                    <span className="text-2xl font-black text-white block leading-tight">{item.name}</span>
                    {item.name.startsWith('(Set)') && (
                       <span className="inline-block mt-1 text-xs text-green-400 border border-green-600 px-1.5 py-0.5 rounded font-bold">SET ITEM</span>
                    )}
                 </div>
                 <span className="font-mono font-bold text-2xl text-white shrink-0">${item.totalPrice.toFixed(2)}</span>
              </div>

              {item.selectedModifiers && item.selectedModifiers.length > 0 && (
                  <div className="mt-2 mb-3 pl-3 border-l-4 border-yellow-500 bg-black/40 py-2 rounded-r pr-3">
                      {item.selectedModifiers.map((mod, idx) => (
                          <div key={idx} className="flex justify-between items-center py-0.5">
                              <span className="text-yellow-400 font-bold text-lg">- {mod.name}</span>
                              {mod.price > 0 && (
                                <span className="text-gray-300 text-base bg-gray-700 px-2 py-0.5 rounded ml-2">
                                  +${mod.price.toFixed(2)}
                                </span>
                              )}
                          </div>
                      ))}
                  </div>
              )}

              {item.notes && (
                 <div className="text-blue-300 text-base italic pl-3 border-l-4 border-blue-500 mb-3 bg-blue-900/20 py-1.5 rounded-r font-medium">
                    ğŸ“ {item.notes}
                 </div>
              )}

              <div className="flex gap-3 mt-2 pt-3 border-t border-gray-700">
                 <button onClick={() => onEditNote(item)} className="flex-1 bg-gray-700 hover:bg-gray-600 text-sm py-3 rounded-lg text-gray-200 font-bold transition-colors">
                    {item.notes ? 'Edit Note' : 'Add Note'}
                 </button>
                 <button onClick={() => onRemoveItem(item.uniqueCartId)} className="flex-1 bg-red-900/40 hover:bg-red-800 text-red-200 text-sm py-3 rounded-lg font-bold transition-colors">
                    Remove
                 </button>
              </div>
            </div>
          ))
        )}
      </div>

      {/* 3. í•˜ë‹¨ ê²°ì œ ë²„íŠ¼ ì˜ì—­ (ì—¬ê¸°ì— Phone Order ì¶”ê°€) */}
      <div className="flex-none p-4 bg-gray-800 border-t border-gray-700 z-10 shadow-[0_-4px_10px_rgba(0,0,0,0.3)]">
        <div className="flex justify-between items-end mb-4">
           <span className="text-gray-400 text-base uppercase font-bold tracking-wider">Total Due</span>
           <span className="text-5xl font-black text-green-400 tracking-tight">${subtotal.toFixed(2)}</span>
        </div>
        
        <div className="flex flex-col gap-3">
           {/* âœ¨âœ¨ Phone Order ë²„íŠ¼ (Card/Cash ìœ„ì— ë°°ì¹˜) */}
           <button 
              onClick={onPhoneOrder}
              disabled={cart.length === 0}
              className="w-full bg-purple-600 hover:bg-purple-500 text-white rounded-xl font-bold text-xl py-4 flex items-center justify-center gap-2 disabled:opacity-30 disabled:cursor-not-allowed shadow-lg active:scale-95 transition-all"
           >
              <span>ğŸ“</span> Phone Order
           </button>

           <div className="grid grid-cols-2 gap-4 h-20">
              <button 
                 onClick={() => onPaymentStart('CASH')}
                 disabled={cart.length === 0}
                 className="bg-green-600 hover:bg-green-500 text-white rounded-2xl font-black text-2xl flex items-center justify-center gap-2 disabled:opacity-30 disabled:cursor-not-allowed shadow-lg active:scale-95 transition-all"
              >
                 <span>ğŸ’µ</span> CASH
              </button>
              <button 
                 onClick={() => onPaymentStart('CARD')}
                 disabled={cart.length === 0}
                 className="bg-blue-600 hover:bg-blue-500 text-white rounded-2xl font-black text-2xl flex items-center justify-center gap-2 disabled:opacity-30 disabled:cursor-not-allowed shadow-lg active:scale-95 transition-all"
              >
                 <span>ğŸ’³</span> CARD
              </button>
           </div>
        </div>
      </div>
    </div>
  );
}

==================================================
FILE PATH: src\components\pos\PosHeader.tsx
==================================================
'use client';

import React, { useState } from 'react';
import ClosingReportModal from './ClosingReportModal';

interface Employee {
  id: number;
  name: string;
  role: string;
}

interface PosHeaderProps {
  employee: Employee;
  onOpenOrders: () => void;
  onLogout: () => void;
}

export default function PosHeader({ employee, onOpenOrders, onLogout }: PosHeaderProps) {
  const [showClosingModal, setShowClosingModal] = useState(false);

  return (
    <>
      {/* ìƒë‹¨ ìš°ì¸¡ ë²„íŠ¼ ê·¸ë£¹: top-2ë¡œ ì‚´ì§ ì˜¬ë¦¬ê³ , gap-6ì€ ìœ ì§€ */}
      <div className="absolute top-1 right-6 z-50 flex items-center gap-6">
          
          {/* 1. ORDERS ë²„íŠ¼ */}
          <button 
             onClick={onOpenOrders}
             className="px-6 py-2 rounded-xl text-lg font-black shadow-lg transition-all border bg-blue-600 text-white border-blue-500 hover:bg-blue-500 hover:scale-105 flex items-center gap-2"
          >
             <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2.5} stroke="currentColor" className="w-6 h-6">
               <path strokeLinecap="round" strokeLinejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z" />
             </svg>
             ORDERS
          </button>

          {/* 2. ì§ì› ë°°ì§€ */}
          <div className="bg-gray-800/90 backdrop-blur-sm px-6 py-2 rounded-xl shadow-lg border border-gray-600 flex items-center gap-2">
              <span className="text-gray-400 font-medium text-base">Staff:</span>
              <span className="text-lg font-black text-white">{employee.name}</span>
          </div>

          {/* 3. CLOSING ë²„íŠ¼ */}
          <button 
            onClick={() => setShowClosingModal(true)} 
            className="px-6 py-2 rounded-xl text-lg font-black bg-gray-700 text-white border-2 border-gray-600 hover:bg-gray-600 hover:border-gray-500 shadow-lg hover:scale-105 transition-all"
          >
             CLOSING
          </button>

          {/* 4. LOGOUT ë²„íŠ¼ */}
          <button 
            onClick={onLogout} 
            className="px-6 py-2 rounded-xl text-lg font-black bg-red-600 text-white border-2 border-red-500 hover:bg-red-500 hover:scale-105 shadow-lg transition-all"
          >
            LOGOUT
          </button>
      </div>

      {/* ëª¨ë‹¬ ë Œë”ë§ */}
      {showClosingModal && (
        <ClosingReportModal 
          employeeName={employee.name} 
          onClose={() => setShowClosingModal(false)} 
        />
      )}
    </>
  );
}

==================================================
FILE PATH: src\components\pos\PosMenuGrid.tsx
==================================================
'use client';

import { MenuItem, Category } from '@/lib/types';

interface PosMenuGridProps {
  categories: Category[];
  selectedCategory: string;
  onSelectCategory: (id: string) => void;
  filteredItems: MenuItem[];
  onItemClick: (item: MenuItem) => void;
}

export default function PosMenuGrid({
  categories,
  selectedCategory,
  onSelectCategory,
  filteredItems,
  onItemClick
}: PosMenuGridProps) {

  const safeItems = filteredItems || [];

  return (
    // âœ¨ [ë‹¤í¬ëª¨ë“œ] ì „ì²´ ë°°ê²½ bg-black
    <section className="flex-1 flex flex-row bg-black h-full overflow-hidden">
      
      {/* 1. ì¹´í…Œê³ ë¦¬ (ì„¸ë¡œ íƒ­) - ì™¼ìª½ Sidebar */}
      {/* âœ¨ [ë‹¤í¬ëª¨ë“œ] ë°°ê²½ bg-gray-900, í…Œë‘ë¦¬ border-gray-800 */}
      <div className="w-72 bg-gray-900 border-r border-gray-800 flex flex-col gap-3 p-3 overflow-y-auto shrink-0 shadow-2xl z-10">
        
        {/* ì¹´í…Œê³ ë¦¬ ë¦¬ìŠ¤íŠ¸ */}
        {categories.map((cat) => {
          const isSelected = selectedCategory === cat.id;
          return (
            <button
              key={cat.id}
              onClick={() => onSelectCategory(cat.id)}
              // âœ¨ [ë””ìì¸ ë³€ê²½] 
              // ì„ íƒë¨: íŒŒë€ìƒ‰ (bg-blue-600)
              // ì„ íƒì•ˆë¨: ì–´ë‘ìš´ íšŒìƒ‰ (bg-gray-800) + ê¸€ì”¨ íšŒìƒ‰
              className={`shrink-0 w-full min-h-[6rem] px-4 rounded-2xl text-2xl font-bold transition-all shadow-md border-2 whitespace-normal leading-tight flex items-center justify-center text-center
                ${isSelected 
                  ? 'bg-blue-600 text-white border-blue-500 shadow-blue-900/50 scale-105 z-10 ring-2 ring-blue-400' 
                  : 'bg-gray-800 text-gray-400 border-gray-700 hover:bg-gray-700 hover:text-white hover:border-gray-500'
                }`}
            >
              {cat.name}
            </button>
          );
        })}

        <div className="border-t border-gray-700 my-2"></div>

        {/* âœ¨ [ìœ„ì¹˜ ë³€ê²½] ALL ë²„íŠ¼ì„ ë§¨ ì•„ë˜ë¡œ ì´ë™ */}
        <button
          onClick={() => onSelectCategory('All')}
          className={`shrink-0 w-full min-h-[5rem] rounded-2xl text-3xl font-black transition-all shadow-md border-2
            ${selectedCategory === 'All' 
              ? 'bg-blue-600 text-white border-blue-500 scale-105 shadow-blue-900/50 z-20' 
              : 'bg-gray-800 text-gray-500 border-gray-700 hover:bg-gray-700 hover:text-white'
            }`}
        >
          ALL
        </button>
        
        {/* í•˜ë‹¨ ì—¬ë°± í™•ë³´ (ìŠ¤í¬ë¡¤ ì‹œ ê°€ë ¤ì§ ë°©ì§€) */}
        <div className="h-10"></div>
      </div>

      {/* 2. ë©”ë‰´ ì•„ì´í…œ ê·¸ë¦¬ë“œ */}
      {/* âœ¨ [ë‹¤í¬ëª¨ë“œ] ë°°ê²½ bg-black */}
      <div className="flex-1 overflow-y-auto p-5 bg-black">
        {safeItems.length === 0 ? (
           <div className="h-full flex items-center justify-center text-gray-600">
             <p className="text-3xl font-bold">No items in this category.</p>
           </div>
        ) : (
          <div className="grid grid-cols-3 gap-5 pb-20">
            {safeItems.map((item) => (
              <button 
                key={item.id}
                onClick={() => item.is_available && onItemClick(item)}
                // âœ¨ [ë‹¤í¬ëª¨ë“œ] ì¹´ë“œ ë°°ê²½ bg-gray-900, í…Œë‘ë¦¬ border-gray-800
                className={`relative h-64 flex flex-col justify-between p-6 rounded-3xl shadow-lg transition-all border-2 text-left group
                  ${item.is_available 
                    ? 'bg-gray-900 border-gray-800 hover:border-blue-500 hover:bg-gray-800 hover:shadow-blue-900/20 active:scale-95' 
                    : 'bg-gray-900/50 border-gray-800 opacity-40 cursor-not-allowed grayscale'}`}
              >
                {/* ìƒë‹¨: ì´ë¦„ ë° ì„¤ëª… */}
                <div className="w-full">
                  {/* âœ¨ [ë‹¤í¬ëª¨ë“œ] ì´ë¦„ í°ìƒ‰ text-white */}
                 <h3 className="font-black text-3xl text-white leading-none mb-3 line-clamp-2 group-hover:text-blue-400">
               {/* âœ¨ POS ì „ìš© ì´ë¦„(posName)ì´ ìˆìœ¼ë©´ ê·¸ê±¸ ì“°ê³ , ì—†ìœ¼ë©´ ì›ë˜ ì´ë¦„(name) ì‚¬ìš© */}
                 {item.posName || item.name}
                  </h3>
                  
                  {/* âœ¨ [ë‹¤í¬ëª¨ë“œ] ì„¤ëª… íšŒìƒ‰ text-gray-400 */}
                  {item.description && (
                    <p className="text-xl text-gray-400 font-medium leading-snug line-clamp-2">
                      {item.description}
                    </p>
                  )}
                </div>

                {/* í•˜ë‹¨: ê°€ê²© */}
                <div className="w-full flex justify-end items-end mt-2">
                  {!item.is_available ? (
                    <span className="text-red-500 font-black text-2xl rotate-[-5deg] border-2 border-red-500 px-2 rounded-lg">SOLD OUT</span>
                  ) : (
                    // âœ¨ [ë‹¤í¬ëª¨ë“œ] ê°€ê²© íŒŒë€ìƒ‰ ê°•ì¡°
                    <span className="font-black text-3xl text-gray-400 bg-gray-800 px-3 py-1 rounded-xl border border-gray-700">
                      ${item.price.toFixed(2)}
                    </span>
                  )}
                </div>
              </button>
            ))}
          </div>
        )}
      </div>
    </section>
  );
}

==================================================
FILE PATH: src\components\pos\SpecialRequestModal.tsx
==================================================
"use client";
import { useState, useRef } from 'react';
// âœ¨ ê°€ìƒ í‚¤ë³´ë“œ ì„í¬íŠ¸
import Keyboard from 'react-simple-keyboard';
import 'react-simple-keyboard/build/css/index.css';

interface Props {
  initialNote: string;
  onClose: () => void;
  onConfirm: (note: string) => void;
}

export default function SpecialRequestModal({ initialNote, onClose, onConfirm }: Props) {
  const [note, setNote] = useState(initialNote || "");
  const [layoutName, setLayoutName] = useState("default"); // Shift í‚¤ ìƒíƒœ ê´€ë¦¬
  const keyboard = useRef(null);

  const onChange = (input: string) => {
    setNote(input);
  };

  const onKeyPress = (button: string) => {
    // Shift í‚¤ ì²˜ë¦¬
    if (button === "{shift}" || button === "{lock}") {
      setLayoutName(layoutName === "default" ? "shift" : "default");
    }
    // Enter í‚¤ ì²˜ë¦¬ (ì €ì¥)
    if (button === "{enter}") {
        onConfirm(note);
    }
  };

  return (
    <div className="fixed inset-0 bg-black/70 z-[9999] flex items-center justify-center backdrop-blur-sm">
      {/* âœ¨ í‚¤ë³´ë“œë¥¼ ìœ„í•´ ë„ˆë¹„ë¥¼ 800pxë¡œ ëŠ˜ë¦¼ */}
      <div className="bg-white w-[800px] rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
        
        {/* í—¤ë” */}
        <div className="bg-gray-800 text-white p-4 flex justify-between items-center shrink-0">
          <h2 className="text-2xl font-bold">Special Instruction</h2>
          <button 
            onClick={onClose} 
            className="text-gray-400 hover:text-white text-4xl leading-none"
          >
            &times;
          </button>
        </div>

        {/* ë‚´ìš© */}
        <div className="p-6 flex-1 overflow-y-auto flex flex-col gap-4">
          <label className="block text-gray-500 font-bold text-lg">
            Enter request for Kitchen:
          </label>
          
          <textarea
            className="w-full h-32 p-4 text-2xl border-2 border-gray-300 rounded-2xl focus:border-blue-600 focus:ring-4 focus:ring-blue-100 outline-none resize-none font-bold text-gray-800 placeholder-gray-300 leading-relaxed"
            placeholder="Type here..."
            value={note}
            onChange={(e) => {
                setNote(e.target.value);
                // ë¬¼ë¦¬ í‚¤ë³´ë“œ ì…ë ¥ ì‹œ ê°€ìƒ í‚¤ë³´ë“œ ë™ê¸°í™”
                // @ts-ignore
                keyboard.current?.setInput(e.target.value);
            }}
            autoFocus 
          />

          {/* âœ¨ ê°€ìƒ í‚¤ë³´ë“œ ì˜ì—­ */}
          <div className="mt-2 text-black">
              <Keyboard
                keyboardRef={r => (keyboard.current = r)}
                layoutName={layoutName}
                onChange={onChange}
                onKeyPress={onKeyPress}
                input={note} // í˜„ì¬ ì…ë ¥ê°’ ë™ê¸°í™”
                theme={"hg-theme-default hg-layout-default myTheme"}
                layout={{
                    default: [
                      "1 2 3 4 5 6 7 8 9 0 - = {bksp}",
                      "q w e r t y u i o p [ ] \\",
                      "a s d f g h j k l ; ' {enter}",
                      "{shift} z x c v b n m , . / {shift}",
                      "{space}"
                    ],
                    shift: [
                      "! @ # $ % ^ & * ( ) _ + {bksp}",
                      "Q W E R T Y U I O P { } |",
                      "A S D F G H J K L : \" {enter}",
                      "{shift} Z X C V B N M < > ? {shift}",
                      "{space}"
                    ]
                  }}
                  display={{
                    "{bksp}": "âŒ«",
                    "{enter}": "SAVE",
                    "{shift}": "â‡§",
                    "{space}": "SPACE",
                  }}
                  buttonTheme={[
                    {
                      class: "hg-red",
                      buttons: "{bksp}"
                    },
                    {
                        class: "hg-blue",
                        buttons: "{enter}"
                    }
                  ]}
              />
          </div>
        </div>

        {/* í•˜ë‹¨ ë²„íŠ¼ */}
        <div className="p-4 border-t border-gray-100 bg-gray-50 flex gap-4 shrink-0">
          <button 
            onClick={onClose} 
            className="flex-1 py-4 bg-white border-2 border-gray-300 rounded-xl text-xl font-bold text-gray-600 hover:bg-gray-100 active:scale-95 transition-all"
          >
            Cancel
          </button>
          <button 
            onClick={() => onConfirm(note)} 
            className="flex-1 py-4 bg-blue-600 text-white rounded-xl text-xl font-bold hover:bg-blue-700 shadow-md active:scale-95 transition-all"
          >
            Save Note
          </button>
        </div>
      </div>
      
      {/* í‚¤ë³´ë“œ ìŠ¤íƒ€ì¼ ì»¤ìŠ¤í…€ (í•„ìš”ì‹œ) */}
      <style jsx global>{`
        .hg-theme-default {
            background-color: #f3f4f6;
            padding: 10px;
            border-radius: 10px;
        }
        .hg-button {
            height: 60px !important; /* ë²„íŠ¼ ë†’ì´ í‚¤ì›€ */
            font-weight: bold !important;
            font-size: 1.2rem !important;
        }
        .hg-blue { background: #2563eb !important; color: white !important; }
        .hg-red { background: #ef4444 !important; color: white !important; }
      `}</style>
    </div>
  );
}

==================================================
FILE PATH: src\components\shared\DayWarningModal.tsx
==================================================
// src/components/DayWarningModal.tsx
import { motion } from 'framer-motion';

interface Props {
  targetDay: string;
  onClose: () => void;
}

export default function DayWarningModal({ targetDay, onClose }: Props) {
  return (
    <div className="fixed inset-0 z-[150] flex items-center justify-center bg-black/60 backdrop-blur-sm">
      <motion.div 
        initial={{ opacity: 0, scale: 0.9, y: 20 }}
        animate={{ opacity: 1, scale: 1, y: 0 }}
        exit={{ opacity: 0, scale: 0.9, y: 20 }}
        // âœ¨ ë¶€ë“œëŸ¬ìš´ íŒŒë€ìƒ‰ í…Œë§ˆ ì ìš©
        className="bg-white w-[500px] p-8 rounded-3xl shadow-2xl flex flex-col items-center text-center relative border border-blue-100"
      >
        {/* ì•„ì´ì½˜ (íŒŒë€ìƒ‰ ì •ë³´ ì•„ì´ì½˜) */}
        <div className="w-24 h-24 bg-blue-50 rounded-full flex items-center justify-center mb-6">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.8} stroke="currentColor" className="w-12 h-12 text-blue-500">
            <path strokeLinecap="round" strokeLinejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" />
          </svg>
        </div>

        <h2 className="text-3xl font-black text-gray-800 mb-3">
          Available on {targetDay}
        </h2>
        
        <p className="text-gray-600 text-xl leading-relaxed mb-8">
          This special menu is served only on<br/>
          <span className="text-blue-600 font-bold text-2xl">{targetDay}</span>.
          <br/><span className="text-sm text-gray-400 mt-2 block">Please check back then! ğŸ˜Š</span>
        </p>

        <button
          onClick={onClose}
          className="w-full h-16 bg-blue-600 text-white text-xl font-bold rounded-2xl hover:bg-blue-700 shadow-lg active:scale-95 transition-all"
        >
          Got it
        </button>
      </motion.div>
    </div>
  );
}

==================================================
FILE PATH: src\components\shared\ModifierModal.tsx
==================================================
"use client";
import { useState } from 'react';
import { MenuItem, ModifierGroup, ModifierOption } from '@/lib/types';

interface Props {
  item: MenuItem;
  modifiersObj: { [key: string]: ModifierGroup };
  onClose: () => void;
  onConfirm: (item: MenuItem, selectedOptions: ModifierOption[]) => void;
}

export default function ModifierModal({ item, modifiersObj, onClose, onConfirm }: Props) {
  const [selectedOptions, setSelectedOptions] = useState<ModifierOption[]>([]);

  const toggleOption = (option: ModifierOption, groupName: string) => {
    const lowerItemName = item.name.toLowerCase();
    const lowerGroupName = groupName.toLowerCase();
    
    // ë°€í¬ì‰ì´í¬ ê´€ë ¨ ë¡œì§ ìœ ì§€
    const isMilkshake = lowerItemName.includes('milkshake');
    const isSingleSelectGroup = isMilkshake && (lowerGroupName.includes('size') || lowerGroupName.includes('flavor'));

    if (isSingleSelectGroup) {
      setSelectedOptions(prev => {
        // âœ¨ [ì•ˆì „ì¥ì¹˜ 1] ì˜µì…˜ì´ ë°°ì—´ì¸ì§€ í™•ì¸
        const group = modifiersObj[groupName];
        const safeOptions = group && Array.isArray(group.options) ? group.options : [];
        
        const currentGroupOptionNames = safeOptions.map(o => o.name);
        const others = prev.filter(o => !currentGroupOptionNames.includes(o.name));
        return [...others, option];
      });
    } else {
      setSelectedOptions(prev => {
        const exists = prev.find(o => o.name === option.name);
        return exists ? prev.filter(o => o.name !== option.name) : [...prev, option];
      });
    }
  };

  const handleAddToCart = () => {
    const itemName = item.name.toLowerCase();

    // ë°€í¬ì‰ì´í¬ í•„ìˆ˜ ì„ íƒ ê²€ì‚¬ ë¡œì§ ìœ ì§€
    if (itemName.includes('milkshake')) {
      let hasSize = false;
      let hasFlavor = false;

      item.modifierGroups.forEach(groupName => {
        const group = modifiersObj[groupName];
        // âœ¨ [ì•ˆì „ì¥ì¹˜ 2] ê·¸ë£¹ê³¼ ì˜µì…˜ ìœ íš¨ì„± ê²€ì‚¬
        if (!group || !Array.isArray(group.options)) return;

        const lowerGroupName = groupName.toLowerCase();
        const isSelectedInGroup = group.options.some(opt => 
          selectedOptions.some(selected => selected.name === opt.name)
        );

        if (lowerGroupName.includes('size') && isSelectedInGroup) hasSize = true;
        if (lowerGroupName.includes('flavor') && isSelectedInGroup) hasFlavor = true;
      });

      if (!hasSize) return alert("âš ï¸ Please select a Size.");
      if (!hasFlavor) return alert("âš ï¸ Please select a Flavor.");
    }

    onConfirm(item, selectedOptions);
  };

  const currentTotal = item.price + selectedOptions.reduce((sum, opt) => sum + opt.price, 0);

  // âœ¨ [ì•ˆì „ì¥ì¹˜ 3] modifierGroupsê°€ ì—†ìœ¼ë©´ ë¹ˆ ë°°ì—´ ì²˜ë¦¬
  const safeModifierGroups = Array.isArray(item.modifierGroups) ? item.modifierGroups : [];

  return (
    <div 
      className="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 backdrop-blur-sm"
      onClick={onClose}
    >
      {/* ëª¨ë‹¬ í¬ê¸° */}
      <div 
        onClick={(e) => e.stopPropagation()}
        className="bg-gray-900 rounded-3xl w-[90%] h-auto max-h-[95vh] flex flex-col shadow-2xl overflow-hidden border border-gray-700"
      >

        {/* í—¤ë” */}
        <div className="p-6 border-b border-gray-700 bg-gray-800 flex justify-between items-center shrink-0">
          <div className="flex-1 pr-4">
            <h2 className="text-3xl font-black text-white leading-tight">{item.name}</h2>
            <p className="text-gray-400 text-lg mt-1 font-medium">Select options</p>
          </div>
          
          <div className="flex items-center gap-5">
            <span className="text-3xl text-blue-400 font-black">${currentTotal.toFixed(2)}</span>
            
            <button 
              onClick={onClose}
              className="bg-gray-700 p-3 rounded-full hover:bg-gray-600 transition-colors shadow-sm text-gray-300 hover:text-white"
            >
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2.5} stroke="currentColor" className="w-8 h-8">
                <path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
        </div>

        {/* ì˜µì…˜ ìŠ¤í¬ë¡¤ ì˜ì—­ */}
        <div className="flex-1 overflow-y-auto p-6 space-y-8 bg-gray-900">
          {safeModifierGroups.length === 0 && (
            <p className="text-center text-gray-500 py-10 text-2xl">No options available.</p>
          )}

          {safeModifierGroups.map((groupName, idx) => {
            const group = modifiersObj[groupName];
            
            // âœ¨âœ¨ [í•µì‹¬ ìˆ˜ì •] ê·¸ë£¹ì´ ì—†ê±°ë‚˜, optionsê°€ ë°°ì—´ì´ ì•„ë‹ˆë©´ ë Œë”ë§í•˜ì§€ ì•ŠìŒ (ì—ëŸ¬ ë°©ì§€)
            if (!group || !Array.isArray(group.options) || group.options.length === 0) {
                return null;
            }

            // sort í•  ë•Œë„ ì›ë³¸ ë°°ì—´ì„ ë³µì‚¬([...])í•´ì„œ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
            const sortedOptions = [...group.options].sort((a: any, b: any) => {
              return (Number(a.sort_order) || 0) - (Number(b.sort_order) || 0);
            });

            return (
              <div key={`${groupName}-${idx}`}>
                {/* ê·¸ë£¹ ì œëª© */}
                <h3 className="text-2xl font-bold mb-5 text-gray-200 border-l-4 border-blue-500 pl-4 uppercase tracking-wide">
                  {groupName}
                </h3>
                
                {/* Grid Layout */}
                <div className="grid grid-cols-4 xl:grid-cols-5 gap-4">
                  {sortedOptions.map((option, optIdx) => {
                    const isSelected = selectedOptions.some(o => o.name === option.name);
                    return (
                      <div
                        key={`${option.name}-${optIdx}`}
                        onClick={() => toggleOption(option, groupName)}
                        className={`flex flex-col items-center justify-center text-center p-3 border rounded-2xl cursor-pointer transition-all active:scale-95 h-44 relative overflow-hidden
                          ${isSelected
                            ? 'bg-blue-900/40 border-blue-500 ring-2 ring-blue-500 shadow-lg shadow-blue-900/20'
                            : 'bg-gray-800 border-gray-700 hover:bg-gray-750 hover:border-gray-500'
                          }`}
                      >
                        {/* ì²´í¬ë°•ìŠ¤ UI */}
                        <div className={`w-8 h-8 rounded-full border-2 flex items-center justify-center mb-3 shrink-0 transition-colors
                          ${isSelected ? 'bg-blue-500 border-blue-500' : 'bg-transparent border-gray-500'}`}
                        >
                          {isSelected && <div className="w-3.5 h-3.5 bg-white rounded-full" />}
                        </div>
                        
                        <div className="flex flex-col items-center w-full px-1">
                          <span className={`text-2xl font-black leading-tight break-words w-full ${isSelected ? 'text-white' : 'text-gray-300'}`}>
                            {option.name}
                          </span>
                          
                          {option.price > 0 && (
                            <span className="text-xl text-blue-400 font-bold mt-2 bg-gray-900/50 px-2 py-0.5 rounded-md">
                              +${option.price.toFixed(2)}
                            </span>
                          )}
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            );
          })}
        </div>

        {/* í•˜ë‹¨ ë²„íŠ¼ */}
        <div className="p-6 border-t border-gray-700 bg-gray-800 flex gap-5 shrink-0 shadow-[0_-4px_10px_rgba(0,0,0,0.3)]">
          <button
            onClick={onClose}
            className="flex-1 bg-gray-700 text-gray-300 text-2xl font-bold rounded-2xl h-24 hover:bg-gray-600 transition-colors border border-gray-600"
          >
            Cancel
          </button>
          <button
            onClick={handleAddToCart}
            className="flex-[2] bg-blue-600 text-white text-3xl font-black rounded-2xl h-24 hover:bg-blue-500 shadow-lg shadow-blue-900/50 transition-colors flex items-center justify-center gap-3"
          >
            Add to Order <span className="text-blue-200 text-2xl font-semibold opacity-80">| ${currentTotal.toFixed(2)}</span>
          </button>
        </div>

      </div>
    </div>
  );
}

==================================================
FILE PATH: src\components\shared\OrderTypeModal.tsx
==================================================
'use client';

import { motion } from 'framer-motion';

interface Props {
  onSelect: (type: 'dine_in' | 'to_go') => void;
  onCancel: () => void;
}

export default function OrderTypeModal({ onSelect, onCancel }: Props) {
  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm">
      <motion.div 
        initial={{ opacity: 0, scale: 0.9 }}
        animate={{ opacity: 1, scale: 1 }}
        exit={{ opacity: 0, scale: 0.9 }}
        className="bg-white rounded-3xl shadow-2xl p-8 w-[600px] text-center"
      >
        <h2 className="text-4xl font-extrabold text-gray-800 mb-2">
          Where would you like to eat?
        </h2>
        <p className="text-xl text-gray-500 mb-8">Please select an option below</p>

        <div className="grid grid-cols-2 gap-6 mb-8">
          {/* Dine In Button */}
          <button
            onClick={() => onSelect('dine_in')}
            className="h-48 flex flex-col items-center justify-center rounded-2xl border-4 border-blue-100 bg-blue-50 text-blue-700 hover:bg-blue-600 hover:text-white hover:border-blue-600 hover:shadow-xl transition-all duration-200 group"
          >
            <span className="text-7xl mb-4 group-hover:scale-110 transition-transform">ğŸ½ï¸</span>
            <span className="text-4xl font-bold">Dine In</span>
          </button>

          {/* To Go Button */}
          <button
            onClick={() => onSelect('to_go')}
            className="h-48 flex flex-col items-center justify-center rounded-2xl border-4 border-orange-100 bg-orange-50 text-orange-700 hover:bg-orange-600 hover:text-white hover:border-orange-600 hover:shadow-xl transition-all duration-200 group"
          >
            <span className="text-7xl mb-4 group-hover:scale-110 transition-transform">ğŸ›ï¸</span>
            <span className="text-4xl font-bold">To Go</span>
          </button>
        </div>

        <button
          onClick={onCancel}
          className="text-gray-400 hover:text-gray-600 font-semibold text-xl underline decoration-2 underline-offset-4"
        >
          Cancel
        </button>
      </motion.div>
    </div>
  );
}

==================================================
FILE PATH: src\components\shared\TableNumberModal.tsx
==================================================
import { useState } from 'react';
import { motion } from 'framer-motion';

interface Props {
  onConfirm: (tableNum: string) => void;
  onCancel: () => void;
}

export default function TableNumberModal({ onConfirm, onCancel }: Props) {
  const [tableNum, setTableNum] = useState('');

  const handleNumClick = (num: string) => {
    if (tableNum.length < 3) {
      setTableNum(prev => prev + num);
    }
  };

  const handleDelete = () => {
    setTableNum(prev => prev.slice(0, -1));
  };

  return (
    <div className="fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4">
      <motion.div 
        initial={{ opacity: 0, scale: 0.95 }}
        animate={{ opacity: 1, scale: 1 }}
        // âœ¨ [ìˆ˜ì •] 
        // 1. ë„ˆë¹„ ëŒ€í­ í™•ëŒ€: max-w-lg -> max-w-2xl (ê°€ë¡œë¡œ ë„“ê²Œ)
        // 2. íŒ¨ë”© í™•ëŒ€: p-8 -> p-10 (ì—¬ìœ ë¡­ê²Œ)
        // 3. ë‘¥ê¸€ê¸°: rounded-[3rem] (ë” ë¶€ë“œëŸ½ê²Œ)
        className="bg-gray-900 w-full max-w-2xl p-10 rounded-[3rem] shadow-2xl flex flex-col items-center border border-gray-700 relative"
      >
        {/* í—¤ë” */}
        <h2 className="text-5xl font-black text-white mb-6 tracking-wide">Table Service</h2>
        
        {/* ì•ˆë‚´ ë¬¸êµ¬ ë°•ìŠ¤ */}
        <div className="bg-gray-800/50 border-2 border-gray-700 rounded-3xl p-6 mb-10 w-full text-center">
            <p className="text-gray-200 font-bold text-3xl leading-tight">
               Please grab a <span className="text-red-500">Number Stand</span>
            </p>
            <p className="text-gray-400 text-xl mt-3 font-medium">
               on the table and enter the number below.
            </p>
        </div>

        {/* ì…ë ¥ í™”ë©´ í‘œì‹œì°½ */}
        <div className="w-full h-28 bg-gray-800 rounded-3xl flex items-center justify-center mb-10 border-4 border-gray-700 shadow-inner">
          <span className={`text-7xl font-black tracking-[0.5em] ${tableNum ? 'text-white' : 'text-gray-600'}`}>
            {tableNum || "-"}
          </span>
        </div>

        {/* âœ¨ [ìˆ˜ì •] í‚¤íŒ¨ë“œ ì˜ì—­: gap-4 -> gap-6 (ë²„íŠ¼ ì‚¬ì´ ê°„ê²© ë„“í˜) */}
        <div className="grid grid-cols-3 gap-6 w-full mb-10">
          {[1, 2, 3, 4, 5, 6, 7, 8, 9].map((num) => (
            <button
              key={num}
              onClick={() => handleNumClick(num.toString())}
              // ë²„íŠ¼ ìŠ¤íƒ€ì¼: h-24 ìœ ì§€, í…ìŠ¤íŠ¸ í¬ê¸° ìœ ì§€
              className="h-24 rounded-3xl bg-gray-800 border-2 border-gray-700 text-5xl font-bold text-white hover:bg-gray-700 hover:border-gray-500 active:bg-gray-600 transition-all shadow-lg active:scale-95"
            >
              {num}
            </button>
          ))}
          
          <div /> {/* ë¹ˆ ê³µê°„ */}
          
          <button
            onClick={() => handleNumClick('0')}
            className="h-24 rounded-3xl bg-gray-800 border-2 border-gray-700 text-5xl font-bold text-white hover:bg-gray-700 hover:border-gray-500 active:bg-gray-600 transition-all shadow-lg active:scale-95"
          >
            0
          </button>

          <button
            onClick={handleDelete}
            className="h-24 rounded-3xl bg-red-900/30 border-2 border-red-900/50 text-red-400 flex items-center justify-center hover:bg-red-900/50 hover:border-red-500 hover:text-red-300 active:bg-red-900/70 transition-all shadow-lg active:scale-95"
          >
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2.5} stroke="currentColor" className="w-12 h-12">
              <path strokeLinecap="round" strokeLinejoin="round" d="M12 9.75L14.25 12m0 0l2.25 2.25M14.25 12l2.25-2.25M14.25 12L12 14.25m-2.58 4.92l-6.375-6.375a1.125 1.125 0 010-1.59L9.42 4.83c.211-.211.498-.33.796-.33H19.5a2.25 2.25 0 012.25 2.25v10.5a2.25 2.25 0 01-2.25 2.25h-9.284c-.298 0-.585-.119-.796-.33z" />
            </svg>
          </button>
        </div>

        {/* í•˜ë‹¨ ì•¡ì…˜ ë²„íŠ¼ */}
        <div className="flex gap-6 w-full">
          <button
            onClick={onCancel}
            className="flex-1 h-24 bg-gray-700 text-gray-300 text-3xl font-bold rounded-3xl border-2 border-gray-600 hover:bg-gray-600 hover:text-white hover:border-gray-500 transition-all active:scale-95 shadow-xl"
          >
            Cancel
          </button>
          <button
            onClick={() => tableNum && onConfirm(tableNum)}
            disabled={!tableNum}
            className="flex-[2] h-24 bg-red-600 text-white text-3xl font-black rounded-3xl border-2 border-red-500 hover:bg-red-500 shadow-xl shadow-red-900/40 disabled:opacity-50 disabled:cursor-not-allowed transition-all active:scale-95"
          >
            Confirm
          </button>
        </div>
      </motion.div>
    </div>
  );
}

==================================================
FILE PATH: src\components\shared\TestPrinter.tsx
==================================================
'use client';

import { useState } from 'react';

export default function TestPrinter() {
  const [status, setStatus] = useState('Idle');

  const handleTestPrint = async () => {
    setStatus('Sending...');
    
    // ì£¼ë°© í”„ë¦°í„° í…ŒìŠ¤íŠ¸ìš© ê°€ì§œ ë°ì´í„°
    const testPayload = {
      tableNumber: "TEST-01",
      orderId: "TEST-9999",
      items: [
        { 
          name: "Test Burger", 
          pos_name: "TST-BGR", // ì•½ì í…ŒìŠ¤íŠ¸
          quantity: 1, 
          selectedModifiers: [{ name: "No Onion" }] // ë¹¨ê°„ìƒ‰ ì¶œë ¥ í…ŒìŠ¤íŠ¸
        },
        { 
          name: "French Fries", 
          pos_name: "FF", 
          quantity: 2, 
          selectedModifiers: [] 
        }
      ]
    };

    try {
      // ë¡œì»¬ í”„ë¦°í„° ì„œë²„ë¡œ ì§ì ‘ ì „ì†¡
      const res = await fetch('http://localhost:4000/print', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(testPayload)
      });

      if (res.ok) {
        setStatus('âœ… OK');
        alert("ğŸ–¨ï¸ í”„ë¦°í„°ì—ì„œ ì¢…ì´ê°€ ë‚˜ì˜¤ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”!");
      } else {
        setStatus('âŒ Fail');
        alert("ì„œë²„ì—ëŠ” ì—°ê²°ëì§€ë§Œ í”„ë¦°í„° ì—ëŸ¬ê°€ ë‚¬ìŠµë‹ˆë‹¤.");
      }
    } catch (error) {
      console.error(error);
      setStatus('âŒ Error');
      alert("ë¡œì»¬ ì„œë²„(localhost:4000)ê°€ ì¼œì ¸ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.");
    }
    
    setTimeout(() => setStatus('Idle'), 2000);
  };

  return (
    <div className="fixed bottom-10 left-10 z-50">
      <button 
        onClick={handleTestPrint}
        className="bg-red-600 text-white px-6 py-3 rounded-full shadow-2xl font-bold hover:bg-red-700 text-lg border-4 border-white"
      >
        ğŸ–¨ï¸ Test Print ({status})
      </button>
    </div>
  );
}

==================================================
FILE PATH: src\components\shared\TipModal.tsx
==================================================
'use client';

import { useState } from 'react';

interface TipModalProps {
  subtotal: number;
  onSelectTip: (amount: number) => void;
  onCancel: () => void; 
}

export default function TipModal({ subtotal, onSelectTip, onCancel }: TipModalProps) {
  const [customTip, setCustomTip] = useState('');
  const [isCustomMode, setIsCustomMode] = useState(false);

  // âœ¨ [ìˆ˜ì •] íŒ ë¹„ìœ¨ ë³€ê²½: 10%, 15%, 20%
  const percentages = [10, 15, 20];

  const handleCustomTipSubmit = () => {
    const val = parseFloat(customTip);
    if (!isNaN(val) && val >= 0) {
      onSelectTip(val);
    }
  };

  return (
    <div className="fixed inset-0 z-[80] flex items-center justify-center bg-black/80 backdrop-blur-md">
      <div className="bg-white w-[90%] max-w-2xl rounded-[2.5rem] shadow-2xl overflow-hidden animate-bounce-in">
        
        {/* Header */}
        <div className="bg-gray-900 p-8 text-center">
          <h2 className="text-4xl font-black text-white mb-2">Add a Tip?</h2>
          <p className="text-gray-400 text-xl">Your support means a lot to our team!</p>
        </div>

        {/* Body */}
        <div className="p-8">
          <div className="flex flex-col gap-4">
            {/* Percentage Buttons */}
            <div className="grid grid-cols-3 gap-4">
              {percentages.map((pct) => {
                const tipVal = subtotal * (pct / 100);
                return (
                  <button
                    key={pct}
                    onClick={() => onSelectTip(tipVal)}
                    className="bg-blue-50 border-2 border-blue-100 hover:bg-blue-600 hover:text-white hover:border-blue-600 active:scale-95 transition-all py-8 rounded-3xl flex flex-col items-center justify-center gap-2 group"
                  >
                    <span className="text-3xl font-black group-hover:text-white text-blue-900">{pct}%</span>
                    <span className="text-xl font-bold text-gray-500 group-hover:text-blue-100">${tipVal.toFixed(2)}</span>
                  </button>
                );
              })}
            </div>

            {/* No Tip & Custom Tip Area */}
            <div className="grid grid-cols-2 gap-4 mt-2">
              <button
                onClick={() => onSelectTip(0)}
                className="bg-gray-100 hover:bg-gray-200 text-gray-600 font-bold py-6 rounded-3xl text-2xl transition-colors"
              >
                No Tip
              </button>
              
              {/* Custom Tip Input or Button */}
              {!isCustomMode ? (
                <button
                  onClick={() => setIsCustomMode(true)}
                  className="bg-gray-100 hover:bg-gray-200 text-gray-800 font-bold py-6 rounded-3xl text-2xl transition-colors"
                >
                  Custom Amount
                </button>
              ) : (
                <div className="flex gap-2">
                  <input
                    type="number"
                    value={customTip}
                    onChange={(e) => setCustomTip(e.target.value)}
                    placeholder="$0.00"
                    className="w-full bg-gray-50 border-2 border-gray-300 rounded-3xl px-6 text-2xl font-bold focus:outline-none focus:border-blue-500"
                    autoFocus
                  />
                  <button
                    onClick={handleCustomTipSubmit}
                    className="bg-blue-600 text-white font-bold px-6 rounded-3xl text-xl"
                  >
                    OK
                  </button>
                </div>
              )}
            </div>
          </div>

          {/* Go Back Button */}
          <div className="mt-8 pt-6 border-t border-gray-100">
            <button
              onClick={onCancel}
              className="w-full text-red-500 font-bold text-xl py-4 hover:bg-red-50 rounded-2xl transition-colors"
            >
              Go Back
            </button>
          </div>

        </div>
      </div>
    </div>
  );
}

==================================================
FILE PATH: src\hooks\useCart.ts
==================================================
import { useState } from 'react';
import { MenuItem, CartItem, ModifierOption } from '@/lib/types';

export function useCart(menuItems: MenuItem[]) {
  const [cart, setCart] = useState<CartItem[]>([]);
  const [editingNoteItem, setEditingNoteItem] = useState<CartItem | null>(null);

  const getSubtotal = () => cart.reduce((sum, item) => sum + (item.totalPrice * item.quantity), 0);

  // âœ¨ [ìˆ˜ì •] modifiers ì¸ìë¥¼ anyë¡œ ë°›ë˜, ë¡œì§ì„ ë‹¨ìˆœí™”í•˜ì—¬ ì—ëŸ¬ ì œê±°
  const addToCart = (item: MenuItem, modifiers: any = []) => {
      
      // 1. ë“¤ì–´ì˜¨ ë°ì´í„°ê°€ ë°°ì—´ì¸ì§€ í™•ì¸ (ModifierModalì—ì„œ ë°°ì—´ë¡œ ë³´ëƒ„)
      let safeModifiers: ModifierOption[] = [];

      if (Array.isArray(modifiers)) {
          safeModifiers = modifiers;
      } else {
          // ë°°ì—´ì´ ì•„ë‹ˆë©´ ë¹ˆ ë°°ì—´ ì²˜ë¦¬ (ë¹¨ê°„ ì¤„ ì—ëŸ¬ê°€ ë‚˜ë˜ ë³µì¡í•œ ê°ì²´ ë³€í™˜ ë¡œì§ ì‚­ì œ)
          console.warn("[addToCart] Modifiers is not an array:", modifiers);
          safeModifiers = [];
      }

      console.log(`[addToCart] Final Modifiers for ${item.name}:`, safeModifiers);

      // ì˜µì…˜ ê°€ê²© í•©ê³„
      const optionsPrice = safeModifiers.reduce((acc, opt) => acc + opt.price, 0);
      
      const isSpecialCategory = item.category === 'Special';
      const currentGroupId = isSpecialCategory ? `group-${Date.now()}-${Math.random()}` : undefined;

      const mainCartItem: CartItem = { 
        ...item, 
        selectedModifiers: safeModifiers, // âœ¨ ìˆ˜ì •ëœ ë°°ì—´ ì €ì¥
        uniqueCartId: Date.now().toString() + Math.random().toString(), 
        quantity: 1, 
        totalPrice: item.price + optionsPrice,
        // @ts-ignore
        groupId: currentGroupId 
      };

      let newItems = [mainCartItem];

      // Special ë©”ë‰´ ìë™ ë²ˆë“¤ë§ (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
      if (isSpecialCategory) {
        const lowerName = item.name.toLowerCase();
        const lowerDesc = (item.description || '').toLowerCase();
        
        if (lowerDesc.includes('fries') || lowerDesc.includes('ff') || lowerName.includes('friday special')) {
           const friesItem = menuItems.find(i => {
               const n = i.name.toLowerCase();
               return n === '1/2 ff' || n === 'french fries' || n.includes('1/2 french');
           });
           if (friesItem) newItems.push({ ...friesItem, selectedModifiers: [], totalPrice: 0, quantity: 1, uniqueCartId: Date.now() + '1', name: `(Set) ${friesItem.name}`, groupId: currentGroupId } as any);
        }
        if (lowerDesc.includes('drink') || lowerDesc.includes('w/d') || lowerName.includes('friday special')) {
           const drinkItem = menuItems.find(i => i.name.toLowerCase() === 'soft drink');
           if (drinkItem) newItems.push({ ...drinkItem, selectedModifiers: [], totalPrice: 0, quantity: 1, uniqueCartId: Date.now() + '2', name: `(Set) ${drinkItem.name}`, groupId: currentGroupId } as any);
        }
      }
      setCart((prev) => [...prev, ...newItems]);
  };

  const removeFromCart = (uniqueId: string) => {
    setCart(prev => {
        const targetItem = prev.find(item => item.uniqueCartId === uniqueId);
        if (targetItem && targetItem.groupId) return prev.filter(item => item.groupId !== targetItem.groupId);
        return prev.filter(item => item.uniqueCartId !== uniqueId);
    });
  };

  const handleSaveNote = (note: string) => {
    if (!editingNoteItem) return;
    setCart(prev => prev.map(item => item.uniqueCartId === editingNoteItem.uniqueCartId ? { ...item, notes: note } : item));
    setEditingNoteItem(null);
  };

  return { cart, setCart, addToCart, removeFromCart, getSubtotal, editingNoteItem, setEditingNoteItem, handleSaveNote };
}

==================================================
FILE PATH: src\hooks\useCustomerDisplay.ts
==================================================
import { useCallback } from 'react';
import { CartItem, ModifierGroup } from '@/lib/types';

export type CustomerViewMode = 
  | 'IDLE' 
  | 'CART' 
  | 'MODIFIER_SELECT' 
  | 'TIPPING' 
  | 'PROCESSING' 
  | 'PAYMENT_SUCCESS'
  | 'ORDER_TYPE_SELECT'
  | 'TABLE_NUMBER_SELECT';

export function useCustomerDisplay() {
  
  const sendState = useCallback(async (
    mode: CustomerViewMode, 
    cart: CartItem[], 
    total: number, 
    activeItemName?: string,
    availableGroups?: ModifierGroup[]
  ) => {
    try {
        // âœ¨ [ìˆ˜ì •] ì„œë²„ APIë¡œ ìƒíƒœ ì „ì†¡ (Fire and Forget)
        await fetch('/api/display', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ mode, cart, total, activeItemName, availableGroups }),
            cache: 'no-store'
        });
    } catch (e) {
        console.error("Display Sync Error:", e);
    }
  }, []);

  // íŒ ì„ íƒ ë¦¬ìŠ¤ë„ˆ (Polling ë°©ì‹ì€ íŒì„ ì—­ìœ¼ë¡œ ë°›ê¸° ì–´ë ¤ìš°ë¯€ë¡œ, íŒì€ ê¸°ì¡´ ì±„ë„ ìœ ì§€ ì‹œë„)
  // ë‹¨, ê°™ì€ ë¸Œë¼ìš°ì €ê°€ ì•„ë‹ˆë©´ ì•ˆë˜ë¯€ë¡œ, íŒ ì„ íƒì€ ì¼ë‹¨ 'ë¡œì»¬ ìŠ¤í† ë¦¬ì§€' ì´ë²¤íŠ¸ë¥¼ í™œìš©í•´ ë°±ì—…í•©ë‹ˆë‹¤.
  const onTipSelected = useCallback((callback: (amount: number) => void) => {
      // 1. BroadcastChannel ì‹œë„ (ê°™ì€ í”„ë¡œí•„ì¼ ê²½ìš° ëŒ€ë¹„)
      const ch = new BroadcastChannel('pos-customer-display');
      const handler = (event: MessageEvent) => {
          if (event.data.type === 'TIP_SELECTED') callback(event.data.payload.amount);
      };
      ch.addEventListener('message', handler);

      // 2. Storage Event ì‹œë„ (ë‹¤ë¥¸ í”„ë¡œí•„ ê°„ í†µì‹  ë°±ì—…)
      const storageHandler = (e: StorageEvent) => {
          if (e.key === 'POS_TIP_SELECTED' && e.newValue) {
              const val = JSON.parse(e.newValue);
              if (val.timestamp > Date.now() - 2000) { // 2ì´ˆ ë‚´ ì´ë²¤íŠ¸ë§Œ
                  callback(val.amount);
              }
          }
      };
      window.addEventListener('storage', storageHandler);

      return () => {
          ch.removeEventListener('message', handler);
          ch.close();
          window.removeEventListener('storage', storageHandler);
      };
  }, []);

  return { sendState, onTipSelected };
}

==================================================
FILE PATH: src\hooks\useKiosk.ts
==================================================
import { useState, useEffect, useRef } from 'react';
import { createBrowserClient } from '@supabase/ssr';
// âœ¨ [ìˆ˜ì •] ExtendedCartItemì„ ì—¬ê¸°ì„œë„ importì— ì¶”ê°€
import { MenuItem, CartItem, ModifierOption, ExtendedCartItem } from '@/lib/types';

export function useKiosk(categories: any[], items: MenuItem[]) {
  // ìƒíƒœ ê´€ë¦¬
  const [activeTab, setActiveTab] = useState<string>('');
  const [cart, setCart] = useState<ExtendedCartItem[]>([]);
  const [selectedItem, setSelectedItem] = useState<MenuItem | null>(null);
  const [isCartOpen, setIsCartOpen] = useState(false);
  
  // ëª¨ë‹¬ ìƒíƒœ
  const [showTableModal, setShowTableModal] = useState(false);
  const [showOrderTypeModal, setShowOrderTypeModal] = useState(false);
  const [showTipModal, setShowTipModal] = useState(false);
  const [showDayWarning, setShowDayWarning] = useState(false);
  const [warningTargetDay, setWarningTargetDay] = useState('');
  
  // ê²°ì œ ì§„í–‰ ìƒíƒœ
  const [isProcessing, setIsProcessing] = useState(false);
  const [isSuccess, setIsSuccess] = useState(false);
  
  // ê²°ì œ ë°ì´í„°
  const [currentTableNumber, setCurrentTableNumber] = useState<string>('');
  const [selectedOrderType, setSelectedOrderType] = useState<'dine_in' | 'to_go' | null>(null);
  const [selectedTipAmount, setSelectedTipAmount] = useState<number>(0);

  // âœ¨ [ì¶”ê°€] ê´€ë¦¬ì ì„¤ì • ê°’ (í…Œì´ë¸” ë²ˆí˜¸ í•„ìˆ˜ ì—¬ë¶€)
  const [requireTableNum, setRequireTableNum] = useState(true);

  const cartEndRef = useRef<HTMLDivElement>(null);

  const supabase = createBrowserClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  );

  // 1. ì´ˆê¸°í™” ë° ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
  useEffect(() => {
    if (categories.length > 0) setActiveTab(categories[0].name);
    
    // âœ¨ DBì—ì„œ ì„¤ì •ê°’ ê°€ì ¸ì˜¤ê¸°
    const fetchSettings = async () => {
      const { data } = await supabase.from('store_settings').select('is_table_number_required').limit(1).single();
      if (data) setRequireTableNum(data.is_table_number_required);
    };
    fetchSettings();
  }, [categories]);

  // 2. ì¹´íŠ¸ ìŠ¤í¬ë¡¤
  useEffect(() => {
    if (isCartOpen) cartEndRef.current?.scrollIntoView({ behavior: "smooth" });
  }, [cart, isCartOpen]);

  // 3. ì•„ì´ë“¤ íƒ€ì´ë¨¸ (ìë™ ì´ˆê¸°í™”)
  const resetToHome = () => {
    setCart([]); setCurrentTableNumber(''); setSelectedOrderType(null);
    setIsSuccess(false); setIsProcessing(false); setShowTipModal(false);
    setShowTableModal(false); setShowOrderTypeModal(false); setShowDayWarning(false);
    setIsCartOpen(false);
    if (categories.length > 0) setActiveTab(categories[0].name);
    window.scrollTo({ top: 0, behavior: 'smooth' });
  };

  useEffect(() => {
    let timer: NodeJS.Timeout;
    const resetIdleTimer = () => {
      clearTimeout(timer);
      timer = setTimeout(() => { if (!isProcessing) resetToHome(); }, 180000);
    };
    window.addEventListener('click', resetIdleTimer);
    window.addEventListener('touchstart', resetIdleTimer);
    window.addEventListener('scroll', resetIdleTimer);
    resetIdleTimer();
    return () => {
      clearTimeout(timer);
      window.removeEventListener('click', resetIdleTimer);
      window.removeEventListener('touchstart', resetIdleTimer);
      window.removeEventListener('scroll', resetIdleTimer);
    };
  }, [isProcessing, categories]);

  // ê³„ì‚° ë¡œì§
  const calculateTotals = () => {
    const subtotal = cart.reduce((sum, item) => sum + item.totalPrice, 0);
    const tax = subtotal * 0.07;
    const totalWithTax = subtotal + tax;
    const cardFee = totalWithTax * 0.03;
    const grandTotal = totalWithTax + cardFee;
    return { subtotal, tax, cardFee, grandTotal };
  };

  // ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€
  const handleAddToCart = (item: MenuItem, selectedOptions: ModifierOption[]) => {
    const totalPrice = item.price + selectedOptions.reduce((sum, opt) => sum + opt.price, 0);
    const isSpecialSet = item.category === 'Special';
    const currentGroupId = isSpecialSet ? `group-${Date.now()}-${Math.random()}` : undefined;

    const mainCartItem: ExtendedCartItem = {
      ...item, selectedModifiers: selectedOptions, totalPrice, quantity: 1,
      uniqueCartId: Date.now().toString() + Math.random().toString(), groupId: currentGroupId,
    };

    let newCartItems = [mainCartItem];
    if (isSpecialSet) {
       // ... (ê¸°ì¡´ ì„¸íŠ¸ ë¡œì§ ìœ ì§€) ...
       const desc = item.description?.toLowerCase() || '';
       if (desc.includes('fries') || desc.includes('ff')) {
         const friesItem = items.find(i => i.name === '1/2 FF' || i.name === 'French Fries' || i.posName === '1/2 FF');
         if (friesItem) newCartItems.push({ ...friesItem, selectedModifiers: [], totalPrice: 0, quantity: 1, uniqueCartId: Date.now().toString() + Math.random().toString(), name: `(Set) ${friesItem.name}`, groupId: currentGroupId });
       }
       if (desc.includes('drink')) {
         const drinkItem = items.find(i => i.name === 'Soft Drink' || i.posName === 'Soft Drink');
         if (drinkItem) newCartItems.push({ ...drinkItem, selectedModifiers: [], totalPrice: 0, quantity: 1, uniqueCartId: Date.now().toString() + Math.random().toString(), name: `(Set) ${drinkItem.name}`, groupId: currentGroupId });
       }
    }
    setCart(prev => [...prev, ...newCartItems]);
    setSelectedItem(null);
    setIsCartOpen(true);
  };

  const removeFromCart = (uniqueId: string) => {
    setCart(prev => {
      const targetItem = prev.find(item => item.uniqueCartId === uniqueId);
      if (targetItem && targetItem.groupId) return prev.filter(item => item.groupId !== targetItem.groupId);
      return prev.filter(item => item.uniqueCartId !== uniqueId);
    });
  };

  // âœ¨ [Logic] Pay Now ë²„íŠ¼ í´ë¦­ ì‹œ ë¶„ê¸° ì²˜ë¦¬
  const handlePayNowClick = () => {
    if (requireTableNum) {
      setShowTableModal(true);
    } else {
      // í…Œì´ë¸” ë²ˆí˜¸ ì…ë ¥ì´ í•„ìš” ì—†ìœ¼ë©´ '00'ìœ¼ë¡œ ì„¤ì •í•˜ê³  ë°”ë¡œ ë‹¤ìŒ ë‹¨ê³„(Order Type)ë¡œ ì´ë™
      handleTableNumberConfirm("00");
    }
  };

  const handleTableNumberConfirm = (tableNum: string) => {
    setCurrentTableNumber(tableNum);
    setShowTableModal(false);
    setIsCartOpen(false); // ì¹´íŠ¸ ë‹«ê¸°
    setShowOrderTypeModal(true);
  };

  // ì‹¤ì œ ê²°ì œ ì²˜ë¦¬
  const processRealPayment = async (finalTipAmount: number) => {
    if (cart.length === 0) return;
    setIsProcessing(true);
    const orderType = selectedOrderType || 'dine_in';
    const tableNum = currentTableNumber || '00';
    try {
      const { subtotal, tax, cardFee, grandTotal } = calculateTotals();
      const finalAmountWithTip = grandTotal + finalTipAmount;

      const stripeRes = await fetch('/api/stripe/process', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ amount: finalAmountWithTip }) });
      if (!stripeRes.ok) throw new Error("Card Payment Failed or Declined.");

      const { data: orderData, error: orderError } = await supabase.from('orders').insert({ total_amount: finalAmountWithTip, status: 'paid', table_number: orderType === 'to_go' ? 'To Go' : tableNum, order_type: orderType }).select().single();
      if (orderError) throw orderError;

      const orderItemsData = cart.map(item => ({ order_id: orderData.id, item_name: item.name, quantity: item.quantity, price: item.totalPrice, options: item.selectedModifiers }));
      await supabase.from('order_items').insert(orderItemsData);

      try { await fetch('/api/clover/order', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ items: cart, totalAmount: finalAmountWithTip, tableNumber: tableNum, orderType: orderType, tipAmount: finalTipAmount }) }); } catch (cloverError) { console.error("Clover Error:", cloverError); }
      try { await fetch('http://127.0.0.1:4000/print', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ orderId: "Order #" + tableNum, tableNumber: tableNum.toString(), orderType: orderType, items: cart, subtotal: subtotal, tax: tax, cardFee: cardFee, tipAmount: finalTipAmount, totalAmount: finalAmountWithTip, date: new Date().toLocaleString('en-US') }) }); } catch (printError) { console.error("Printer Error:", printError); }

      setIsProcessing(false); setIsSuccess(true);
      setTimeout(() => resetToHome(), 15000);
    } catch (error: any) {
      setIsProcessing(false); alert("âŒ Error: " + error.message);
    }
  };

  return {
    activeTab, setActiveTab, cart, setCart, selectedItem, setSelectedItem, isCartOpen, setIsCartOpen,
    showTableModal, setShowTableModal, showOrderTypeModal, setShowOrderTypeModal, showTipModal, setShowTipModal,
    showDayWarning, setShowDayWarning, warningTargetDay, setWarningTargetDay, isProcessing, isSuccess,
    cartEndRef, calculateTotals, handleAddToCart, removeFromCart, 
    handlePayNowClick, // âœ¨ ìƒˆë¡œ ë§Œë“  í•¸ë“¤ëŸ¬
    handleTableNumberConfirm, 
    setSelectedOrderType, setSelectedTipAmount, processRealPayment, resetToHome
  };
}

==================================================
FILE PATH: src\hooks\useKioskLogic.tsx
==================================================
import { useState, useEffect, useRef } from 'react';
import { createBrowserClient } from '@supabase/ssr';
import { MenuItem, CartItem, ModifierOption, Category, ModifierGroup } from '@/lib/types';

// í”„ë¦°í„° ì„œë²„ ì£¼ì†Œ
const PRINTER_SERVER_URL = 'http://192.168.50.106:4000/print';

interface ExtendedCartItem extends CartItem {
  groupId?: string;
}

export function useKioskLogic(categories: Category[], items: MenuItem[]) {
  // --- State ---
  const [activeTab, setActiveTab] = useState<string>('');
  const [cart, setCart] = useState<ExtendedCartItem[]>([]);
  const [isCartOpen, setIsCartOpen] = useState(false);
  const cartEndRef = useRef<HTMLDivElement>(null);

  // Modals
  const [showOrderTypeModal, setShowOrderTypeModal] = useState(false);
  const [showTableModal, setShowTableModal] = useState(false);
  const [showTipModal, setShowTipModal] = useState(false);
  const [showDayWarning, setShowDayWarning] = useState(false);
  
  // Selection & Payment
  const [selectedItem, setSelectedItem] = useState<MenuItem | null>(null);
  const [warningTargetDay, setWarningTargetDay] = useState('');
  const [selectedOrderType, setSelectedOrderType] = useState<'dine_in' | 'to_go' | null>(null);
  const [currentTableNumber, setCurrentTableNumber] = useState<string>('');
  
  // Status
  const [isProcessing, setIsProcessing] = useState(false);
  const [isSuccess, setIsSuccess] = useState(false);

  const supabase = createBrowserClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  );

  // --- Effects ---
  useEffect(() => {
    if (categories.length > 0) setActiveTab(categories[0].name);
  }, [categories]);

  useEffect(() => {
    if (isCartOpen) cartEndRef.current?.scrollIntoView({ behavior: "smooth" });
  }, [cart, isCartOpen]);

  // ìë™ ì´ˆê¸°í™” (3ë¶„)
  useEffect(() => {
    let timer: NodeJS.Timeout;
    const resetIdleTimer = () => {
      clearTimeout(timer);
      if (!isProcessing && cart.length > 0) { 
        timer = setTimeout(() => resetToHome(), 180000); 
      }
    };
    window.addEventListener('click', resetIdleTimer);
    window.addEventListener('touchstart', resetIdleTimer);
    resetIdleTimer();
    return () => {
      clearTimeout(timer);
      window.removeEventListener('click', resetIdleTimer);
      window.removeEventListener('touchstart', resetIdleTimer);
    };
  }, [isProcessing, cart.length]);

  // --- Actions ---
  const resetToHome = () => {
    setCart([]);
    setCurrentTableNumber('');
    setSelectedOrderType(null);
    setIsSuccess(false);
    setIsProcessing(false);
    setShowTipModal(false);
    setShowTableModal(false);
    setShowOrderTypeModal(false);
    setShowDayWarning(false);
    setIsCartOpen(false);
    if (categories.length > 0) setActiveTab(categories[0].name);
    window.scrollTo({ top: 0, behavior: 'smooth' });
  };

  const calculateTotals = () => {
    const subtotal = cart.reduce((sum, item) => sum + item.totalPrice, 0);
    const tax = subtotal * 0.07;
    const totalWithTax = subtotal + tax;
    const cardFee = totalWithTax * 0.03;
    const grandTotal = totalWithTax + cardFee;
    return { subtotal, tax, cardFee, grandTotal };
  };

  const addToCart = (item: MenuItem, selectedOptions: ModifierOption[]) => {
    const totalPrice = item.price + selectedOptions.reduce((sum, opt) => sum + opt.price, 0);
    const isSpecialSet = item.category === 'Special';
    const currentGroupId = isSpecialSet ? `group-${Date.now()}-${Math.random()}` : undefined;

    const mainCartItem: ExtendedCartItem = {
      ...item,
      selectedModifiers: selectedOptions,
      totalPrice: totalPrice,
      quantity: 1,
      uniqueCartId: Date.now().toString() + Math.random().toString(),
      groupId: currentGroupId,
    };

    let newCartItems = [mainCartItem];

    if (isSpecialSet) {
      const desc = item.description?.toLowerCase() || '';
      if (desc.includes('fries') || desc.includes('ff')) {
        const friesItem = items.find(i => i.name === '1/2 FF' || i.name === 'French Fries' || i.posName === '1/2 FF');
        if (friesItem) newCartItems.push({ ...friesItem, selectedModifiers: [], totalPrice: 0, quantity: 1, uniqueCartId: Date.now().toString() + Math.random(), name: `(Set) ${friesItem.name}`, groupId: currentGroupId } as any);
      }
      if (desc.includes('drink')) {
        const drinkItem = items.find(i => i.name === 'Soft Drink' || i.posName === 'Soft Drink');
        if (drinkItem) newCartItems.push({ ...drinkItem, selectedModifiers: [], totalPrice: 0, quantity: 1, uniqueCartId: Date.now().toString() + Math.random(), name: `(Set) ${drinkItem.name}`, groupId: currentGroupId } as any);
      }
    }
    setCart(prev => [...prev, ...newCartItems]);
    setSelectedItem(null);
    setIsCartOpen(true);
  };

  const removeFromCart = (uniqueId: string) => {
    setCart(prev => {
      const targetItem = prev.find(item => item.uniqueCartId === uniqueId);
      if (targetItem && targetItem.groupId) return prev.filter(item => item.groupId !== targetItem.groupId);
      return prev.filter(item => item.uniqueCartId !== uniqueId);
    });
  };

  const handleItemClick = (item: MenuItem) => {
    const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
    const todayIndex = new Date().getDay();
    const targetDay = days.find(day => item.name.includes(day));

    if (targetDay && targetDay !== days[todayIndex]) {
      setWarningTargetDay(targetDay);
      setShowDayWarning(true);
      return;
    }
    if (!item.modifierGroups || item.modifierGroups.length === 0) {
      addToCart(item, []);
    } else {
      setSelectedItem(item);
    }
  };

  // --- âœ¨ [í•µì‹¬ ìˆ˜ì •] Payment Flow Logic ---
  const processRealPayment = async (finalTipAmount: number) => {
    if (cart.length === 0) return;
    setIsProcessing(true); // í™”ë©´ì— ë¡œë”©(ìŠ¤í”¼ë„ˆ) í‘œì‹œ ì‹œì‘
    
    const orderType = selectedOrderType || 'dine_in';
    const tableNumVal = currentTableNumber || '00'; 
    const finalTableStr = orderType === 'to_go' ? `To Go (${tableNumVal})` : tableNumVal;

    try {
      const { subtotal, tax, cardFee, grandTotal } = calculateTotals();
      const finalAmountWithTip = grandTotal + finalTipAmount;

      // 1. Stripe ê²°ì œ ì˜ë„ ìƒì„± (Payment Intent) - ë¦¬ë”ê¸°ì— ê¸ˆì•¡ í‘œì‹œë¨
      const stripeRes = await fetch('/api/stripe/process', { 
        method: 'POST', 
        headers: { 'Content-Type': 'application/json' }, 
        body: JSON.stringify({ amount: finalAmountWithTip, source: 'kiosk' }) 
      });
      const processData = await stripeRes.json();
      
      if (!processData.success) throw new Error(processData.error || "Payment Init Failed");
      const { paymentIntentId } = processData;

      // 2. âœ¨ [Polling Loop] ê²°ì œ ì™„ë£Œ ëŒ€ê¸° (ìµœëŒ€ 120ì´ˆ)
      // ë¦¬ë”ê¸°ì—ì„œ ì¹´ë“œë¥¼ ê½‚ê³  ìŠ¹ì¸ì´ ë‚  ë•Œê¹Œì§€ ì—¬ê¸°ì„œ ë©ˆì¶°ìˆì–´ì•¼ í•¨
      let isPaymentConfirmed = false;
      
      for (let i = 0; i < 120; i++) {
         // 1ì´ˆ ëŒ€ê¸°
         await new Promise(resolve => setTimeout(resolve, 1000));
         
         // ìƒíƒœ í™•ì¸ ìš”ì²­
         const checkRes = await fetch('/api/stripe/capture', {
             method: 'POST',
             headers: { 'Content-Type': 'application/json' },
             body: JSON.stringify({ paymentIntentId }),
         });
         const checkData = await checkRes.json();

         if (checkData.status === 'succeeded') {
             isPaymentConfirmed = true;
             break; // ë£¨í”„ íƒˆì¶œ -> ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰
         } else if (checkData.status === 'canceled' || checkData.status === 'failed') {
             throw new Error("Card Declined or Canceled.");
         }
         // 'requires_payment_method' ë“±ì˜ ìƒíƒœë©´ ê³„ì† ëŒ€ê¸°
      }

      if (!isPaymentConfirmed) {
          throw new Error("Payment Timeout. Please try again.");
      }

      // --- ğŸ‘‡ ì•„ë˜ ì½”ë“œëŠ” ê²°ì œê°€ 'succeeded' ëœ í›„ì—ë§Œ ì‹¤í–‰ë¨ ğŸ‘‡ ---

      // 3. DB ì €ì¥ (Order ìƒì„±)
      const { data: orderData, error: orderError } = await supabase.from('orders').insert({ 
        total_amount: finalAmountWithTip, 
        status: 'paid', 
        table_number: finalTableStr, 
        order_type: orderType, 
        // Stripe Payment Intent ID ì €ì¥ (ë‚˜ì¤‘ì— í™˜ë¶ˆì‹œ í•„ìš”)
        transaction_id: paymentIntentId
      }).select().single();
      
      if (orderError) throw orderError;

      const orderItemsData = cart.map(item => ({ 
        order_id: orderData.id, 
        item_name: item.name, 
        quantity: item.quantity, 
        price: item.totalPrice, 
        options: item.selectedModifiers 
      }));
      await supabase.from('order_items').insert(orderItemsData);

      // 4. í”„ë¦°í„° ì¶œë ¥ (ì£¼ë°© + ì˜ìˆ˜ì¦)
      try { 
        await fetch(PRINTER_SERVER_URL, { 
          method: 'POST', headers: { 'Content-Type': 'application/json' }, 
          body: JSON.stringify({ 
            orderId: "Order #" + tableNumVal, 
            tableNumber: finalTableStr, 
            orderType, 
            items: cart, 
            subtotal, tax, cardFee, tipAmount: finalTipAmount, totalAmount: finalAmountWithTip, 
            date: new Date().toLocaleString('en-US'),
            paymentMethod: "CARD",
            employeeName: "Kiosk",
            // printKitchenOnly: false // falseì—¬ì•¼ ì˜ìˆ˜ì¦ë„ ë‚˜ì˜µë‹ˆë‹¤ (ê¸°ë³¸ê°’ì´ falseë¼ ê°€ì •)
          }) 
        }); 
      } catch (e) { console.error("Printer Error", e); }

      // 5. ì„±ê³µ í™”ë©´ í‘œì‹œ ë° ì´ˆê¸°í™”
      setIsProcessing(false); // ë¡œë”© ë
      setIsSuccess(true);     // ì„±ê³µ í™”ë©´(Thank You) í‘œì‹œ
      setTimeout(() => resetToHome(), 10000); // 10ì´ˆ í›„ ì´ˆê¸°í™”

    } catch (error: any) {
      setIsProcessing(false);
      // ì—ëŸ¬ ë°œìƒ ì‹œ ì ì‹œ ê¸°ë‹¤ë ¸ë‹¤ê°€ ì•Œë¦¼ (UI ë Œë”ë§ ì¶©ëŒ ë°©ì§€)
      await new Promise(resolve => setTimeout(resolve, 100));
      alert("âŒ Payment Failed: " + error.message);
      
      // ì‹¤íŒ¨ ì‹œì—ë„ ì¹´íŠ¸ê°€ ë¹„ì›Œì§€ì§€ ì•Šê²Œ í•˜ë ¤ë©´ ì•„ë˜ ì¤„ ì‚­ì œ, 
      // í•˜ì§€ë§Œ ë³´ì•ˆìƒ/ë‹¤ìŒ ì†ë‹˜ì„ ìœ„í•´ ë¹„ìš°ëŠ” ê²Œ ì¢‹ë‹¤ë©´ ìœ ì§€.
      // ì—¬ê¸°ì„œëŠ” ì¼ë‹¨ ì‹¤íŒ¨ ì‹œ ê·¸ëŒ€ë¡œ ë‘ì–´ ë‹¤ì‹œ ì‹œë„í•˜ê²Œ í•  ìˆ˜ë„ ìˆì§€ë§Œ,
      // ì§ˆë¬¸ìë‹˜ ì˜ë„(ê²°ì œ ì‹œë„ í›„ì—” ë¹„ìš°ê¸°)ì— ë”°ë¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
      resetToHome(); 
    }
  };

  return {
    // Data
    activeTab, setActiveTab,
    cart, cartEndRef,
    isCartOpen, setIsCartOpen,
    selectedItem, setSelectedItem,
    
    // Modals Control
    showOrderTypeModal, setShowOrderTypeModal,
    showTableModal, setShowTableModal,
    showTipModal, setShowTipModal,
    showDayWarning, setShowDayWarning,
    
    // Payment Data
    warningTargetDay,
    isProcessing, isSuccess,
    
    // Functions
    addToCart, removeFromCart, handleItemClick,
    setSelectedOrderType,
    setCurrentTableNumber,
    processRealPayment,
    resetToHome,
    calculateTotals
  };
}

==================================================
FILE PATH: src\hooks\usePosLogic.ts
==================================================
import { useState, useEffect } from 'react';
import { getPosData } from '@/lib/dataFetcher';
import { useCustomerDisplay } from './useCustomerDisplay';
import { useCart } from './useCart';
import { useTransaction } from './useTransaction';
import { MenuItem, Category, ModifierGroup, Employee } from '@/lib/types';

const ADMIN_CONFIG = { enableToGoTableNum: true };

interface TransactionState {
  method: 'CASH' | 'CARD' | null;
  orderType: 'dine_in' | 'to_go' | null;
  tableNum: string | null;
  tipAmount: number;
}

export function usePosLogic() {
  const [currentEmployee, setCurrentEmployee] = useState<Employee | null>(null);
  const [categories, setCategories] = useState<Category[]>([]);
  const [menuItems, setMenuItems] = useState<MenuItem[]>([]);
  const [modifiersObj, setModifiersObj] = useState<{ [key: string]: ModifierGroup }>({});
  const [selectedCategory, setSelectedCategory] = useState<string>('All');
  const [isLoading, setIsLoading] = useState(true);

  const { cart, setCart, addToCart, removeFromCart, getSubtotal, editingNoteItem, setEditingNoteItem, handleSaveNote } = useCart(menuItems);
  
  // âœ¨ cancelPayment, refë“¤ ê°€ì ¸ì˜¤ê¸°
  const { 
      isCardProcessing, setIsCardProcessing, 
      cardStatusMessage, setCardStatusMessage, 
      processOrder, refundOrder, cancelPayment, 
      currentPaymentIntentIdRef, isCancelledRef 
  } = useTransaction();

  const { sendState, onTipSelected } = useCustomerDisplay();

  const [currentOrderId, setCurrentOrderId] = useState<string | null>(null);
  const [txn, setTxn] = useState<TransactionState>({ method: null, orderType: null, tableNum: null, tipAmount: 0 });
  
  const [isOrderListOpen, setIsOrderListOpen] = useState(false);
  const [isOrderTypeOpen, setIsOrderTypeOpen] = useState(false);
  const [isTableNumOpen, setIsTableNumOpen] = useState(false);
  const [isTipOpen, setIsTipOpen] = useState(false);
  const [isCashModalOpen, setIsCashModalOpen] = useState(false);
  const [isPhoneOrderModalOpen, setIsPhoneOrderModalOpen] = useState(false);
  
  const [selectedItemForMod, setSelectedItemForMod] = useState<MenuItem | null>(null);
  const [showDayWarning, setShowDayWarning] = useState(false);
  const [warningTargetDay, setWarningTargetDay] = useState('');

  // 1. ì´ˆê¸° ë°ì´í„° ë¡œë“œ
  useEffect(() => {
    const loadData = async () => {
      try {
        setIsLoading(true);
        const data = await getPosData(); 
        setCategories(data.categories);
        setMenuItems(data.items);
        setModifiersObj(data.modifiersObj);
        if (data.categories.length > 0) setSelectedCategory(data.categories[0].id);
      } catch (error) { console.error("Failed to load POS data:", error); } 
      finally { setIsLoading(false); }
    };
    loadData();
  }, []);

  // 2. ì†ë‹˜ í™”ë©´ ì—°ë™
  useEffect(() => {
     if (cart.length === 0) {
        sendState('IDLE', [], 0);
     } else {
        // ëª¨ë‹¬ë“¤ì´ ë‹¤ ë‹«í˜€ìˆê³  ì¹´ë“œ ì²˜ë¦¬ì¤‘ì´ ì•„ë‹ ë•Œë§Œ CART ì „ì†¡
        if (!isCardProcessing && !isOrderTypeOpen && !isTableNumOpen && !isTipOpen) {
             sendState('CART', cart, getSubtotal());
        }
     }
  }, [cart, isCardProcessing, isOrderTypeOpen, isTableNumOpen, isTipOpen]);

  // 3. íŒ ì„ íƒ ì´ë²¤íŠ¸
  useEffect(() => {
    const cleanup = onTipSelected((tipAmount) => {
       setTxn(prev => ({ ...prev, tipAmount }));
       setIsTipOpen(false);
       if (txn.method === 'CASH') {
          setIsCashModalOpen(true);
       } else {
          handleCardPayment(tipAmount);
       }
    });
    return cleanup;
  }, [txn.method]); 

  // 4. ì•„ì´í…œ í´ë¦­ ë° ì˜µì…˜
  const handleItemClick = (item: MenuItem) => {
    const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
    const todayIndex = new Date().getDay(); 
    const targetDay = days.find(day => item.name.includes(day));
    if (targetDay && targetDay !== days[todayIndex]) {
      setWarningTargetDay(targetDay);
      setShowDayWarning(true); 
      return; 
    }

    if (!item.modifierGroups || item.modifierGroups.length === 0) {
      addToCart(item, []);
    } else {
      setSelectedItemForMod(item);
      const groupsToShow = item.modifierGroups
        .map(groupName => modifiersObj[groupName])
        .filter(group => group !== undefined);
      sendState('MODIFIER_SELECT', cart, getSubtotal(), item.name, groupsToShow);
    }
  };

  const closeModifierModal = () => {
      setSelectedItemForMod(null);
      sendState('CART', cart, getSubtotal());
  }

  // 5. ê²°ì œ ì‹œì‘ ë¡œì§
  const handlePaymentStart = (method: 'CASH' | 'CARD') => {
    if (cart.length === 0) return alert('Cart is empty.');
    
    if (currentOrderId && txn.tableNum) {
        setTxn(prev => ({ ...prev, method }));
        if (method === 'CASH') {
            setTxn(prev => ({ ...prev, tipAmount: 0 }));
            setIsCashModalOpen(true);
        } else {
            sendState('TIPPING', cart, getSubtotal());
            setIsTipOpen(true);
        }
    } else {
        setTxn({ method, orderType: null, tableNum: null, tipAmount: 0 });
        setIsOrderTypeOpen(true);
        // âœ¨ [ë³µêµ¬ë¨] ì†ë‹˜ í™”ë©´ì— 'ì£¼ë¬¸ ìœ í˜• ì„ íƒ' ë„ìš°ê¸°
        sendState('ORDER_TYPE_SELECT', cart, getSubtotal());
    }
  };

  const handleOrderTypeSelect = (type: 'dine_in' | 'to_go') => {
    setTxn((prev) => ({ ...prev, orderType: type }));
    setIsOrderTypeOpen(false);
    
    if (type === 'dine_in' || ADMIN_CONFIG.enableToGoTableNum) {
        setIsTableNumOpen(true);
        // âœ¨ [ë³µêµ¬ë¨] ì†ë‹˜ í™”ë©´ì— 'í…Œì´ë¸” ë²ˆí˜¸ ì…ë ¥' ë„ìš°ê¸°
        sendState('TABLE_NUMBER_SELECT', cart, getSubtotal());
    } else {
        setTxn((prev) => ({ ...prev, tableNum: null }));
        if (txn.method === 'CASH') {
            setIsCashModalOpen(true);
        } else {
            sendState('TIPPING', cart, getSubtotal());
            setIsTipOpen(true);
        }
    }
  };

  const handleTableNumConfirm = (num: string) => {
    setTxn((prev) => ({ ...prev, tableNum: num }));
    setIsTableNumOpen(false);
    if (txn.method === 'CASH') {
        setIsCashModalOpen(true);
    } else {
        sendState('TIPPING', cart, getSubtotal());
        setIsTipOpen(true);
    }
  };

  // 6. ê²°ì œ ë° ì¸ì‡„ ì²˜ë¦¬
  const handleTipSelect = (amt: number) => {
    setTxn((prev) => ({ ...prev, tipAmount: amt }));
    setIsTipOpen(false);
    if (txn.method === 'CASH') setIsCashModalOpen(true);
    else handleCardPayment(amt);
  };

  const handleCashPaymentConfirm = async (received: number, change: number) => {
      setIsCashModalOpen(false);
      alert(`Please return change: $${change.toFixed(2)}`);
      await finalizeTransaction('CASH'); 
  };

  // âœ¨âœ¨ [ì¹´ë“œ ê²°ì œ ë¡œì§] íƒ€ì„ì•„ì›ƒ í•´ê²° + ì·¨ì†Œ ê¸°ëŠ¥ ì—°ë™ (ì‚¬ì¥ë‹˜ ì½”ë“œ ìœ ì§€)
  const handleCardPayment = async (tip: number) => {
      setIsCardProcessing(true);
      isCancelledRef.current = false; // ì·¨ì†Œ ê¹ƒë°œ ì´ˆê¸°í™”
      currentPaymentIntentIdRef.current = null; // ID ì´ˆê¸°í™”

      const subtotal = getSubtotal();
      const ccFee = subtotal * 0.03;
      const totalToPay = subtotal + ccFee + tip;

      setCardStatusMessage("Printing Kitchen Ticket...");
      const displayTableNum = txn.tableNum ? (txn.orderType === 'to_go' ? `To Go #${txn.tableNum}` : txn.tableNum) : (txn.orderType === 'to_go' ? 'To Go' : '00');
      
      // 1. ì£¼ë°© í”„ë¦°í„°
      const preSaveResult = await processOrder(
          cart, subtotal, tip, 'CARD', 
          txn.orderType || 'dine_in', displayTableNum, currentEmployee, 
          currentOrderId, null, 'processing', 'KITCHEN' 
      );

      if (!preSaveResult.success || !preSaveResult.orderId) {
          alert("Failed to initialize order: " + preSaveResult.error);
          setIsCardProcessing(false);
          return;
      }

      const activeOrderId = preSaveResult.orderId;
      setCurrentOrderId(activeOrderId);
      // âœ¨ [ë³µêµ¬ë¨] ì†ë‹˜ í™”ë©´ì— 'ì²˜ë¦¬ ì¤‘' í‘œì‹œ
      sendState('PROCESSING', cart, subtotal);

      try {
          // ğŸš¨ ì—°ê²° ì „ ì·¨ì†Œ ì²´í¬
          if (isCancelledRef.current) throw new Error("Cancelled by User");

          setCardStatusMessage(`Connecting to Terminal... ($${totalToPay.toFixed(2)})`);

          // 2. Stripe ë‹¨ë§ê¸° ì—°ê²°
          const processRes = await fetch('/api/stripe/process', {
             method: 'POST', headers: { 'Content-Type': 'application/json' }, 
             body: JSON.stringify({ amount: totalToPay, source: 'pos' }),
          });
          const { success, paymentIntentId, error } = await processRes.json();
          
          if (!success) throw new Error(error || "Connection Failed");

          // âœ¨ ID ì €ì¥
          currentPaymentIntentIdRef.current = paymentIntentId;

          // ğŸš¨ ì—°ê²° ì¤‘ ì·¨ì†Œ ì²´í¬ (ì¦‰ì‹œ ì¢…ë£Œ + í™•ì¸ì‚¬ì‚´)
          if (isCancelledRef.current) {
              console.log("âš ï¸ ì—°ê²° ì¤‘ ì·¨ì†Œ ê°ì§€! ì¦‰ì‹œ ì¢…ë£Œ ì‹œë„...");
              await cancelPayment(); 
              setTimeout(() => {
                  console.log("ğŸ”« í™•ì¸ ì‚¬ì‚´: ì·¨ì†Œ ëª…ë ¹ ì¬ì „ì†¡");
                  cancelPayment(); 
              }, 1500);
              
              throw new Error("Cancelled by User (Late)");
          }

          setCardStatusMessage("ğŸ’³ Please Insert / Tap Card");
          
          // 3. ë¬´í•œ ëŒ€ê¸° ë£¨í”„
          const maxTime = Date.now() + 300 * 1000; 
          let isSuccess = false;

          while (Date.now() < maxTime) {
              if (isCancelledRef.current) {
                  await cancelPayment(); 
                  throw new Error("Payment Cancelled by User");
              }

              try {
                  await new Promise(r => setTimeout(r, 1000));
                  const checkRes = await fetch('/api/stripe/capture', {
                      method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ paymentIntentId }),
                  });
                  const checkData = await checkRes.json();

                  if (checkData.status === 'succeeded') { 
                      isSuccess = true; 
                      break; 
                  } else if (checkData.status === 'canceled') {
                      throw new Error("Payment Canceled on Terminal");
                  } else if (checkData.status === 'failed') {
                      throw new Error("Card Declined");
                  }
              } catch (networkErr) {
                  console.warn("Polling glitch (ignored):", networkErr);
              }
          }
          
          if (isSuccess) {
              await finalizeTransaction('CARD', paymentIntentId, activeOrderId);
          } else {
              if (!isCancelledRef.current) throw new Error("Timeout: No payment detected.");
          }

      } catch (e: any) {
          console.error("Payment Failed:", e);
          
          if (e.message.includes("Cancelled") || e.message.includes("User")) {
              setCardStatusMessage("Transaction Cancelled.");
              if (currentPaymentIntentIdRef.current) cancelPayment();
          } else {
              setCardStatusMessage(`âŒ Error: ${e.message}`);
          }

          await new Promise(r => setTimeout(r, 2000)); 
          setIsCardProcessing(false); 
          // âœ¨ [ë³µêµ¬ë¨] ì—ëŸ¬ ì‹œ ì†ë‹˜ í™”ë©´ ì¹´íŠ¸ë¡œ ë³µê·€
          sendState('CART', cart, getSubtotal());
      }
  };
  
  const finalizeTransaction = async (method: 'CASH' | 'CARD', transactionId: string | null = null, existingOrderId: string | null = null) => {
      const displayTableNum = txn.tableNum ? (txn.orderType === 'to_go' ? `To Go #${txn.tableNum}` : txn.tableNum) : (txn.orderType === 'to_go' ? 'To Go' : '00');
      const orderIdToUse = existingOrderId || currentOrderId;
      const printScope = method === 'CARD' ? 'RECEIPT' : 'ALL';

      const result = await processOrder(
          cart, getSubtotal(), txn.tipAmount, method, 
          txn.orderType || 'dine_in', displayTableNum, currentEmployee, 
          orderIdToUse, transactionId,
          'paid',      
          printScope
      );

      if (result.success) {
          if (method === 'CARD') {
              setCardStatusMessage("âœ… Payment Complete!");
              await new Promise(r => setTimeout(r, 1000));
              setIsCardProcessing(false);
          }
          sendState('PAYMENT_SUCCESS', cart, getSubtotal());
          setCart([]);
          setTxn({ method: null, orderType: null, tableNum: null, tipAmount: 0 });
          setCurrentOrderId(null);
      } else {
          alert("Error finalizing: " + result.error);
          setIsCardProcessing(false);
      }
  };

  const handlePhoneOrderConfirm = async (customerName: string) => {
      setIsPhoneOrderModalOpen(false);
      const displayTableNum = `To Go: ${customerName}`;
      const result = await processOrder(cart, getSubtotal(), 0, 'PENDING', 'to_go', displayTableNum, currentEmployee, null, null, 'open', 'KITCHEN');
      if (result.success) { alert(`âœ… Phone Order Saved!`); setCart([]); } else { alert("Error: " + result.error); }
  };

  const handleRecallOrder = (order: any) => {
    const recreatedCart = order.order_items.map((dbItem: any, idx: number) => ({
        id: dbItem.menu_item_id, name: dbItem.item_name, price: dbItem.price, quantity: dbItem.quantity,
        selectedModifiers: dbItem.modifiers || [], totalPrice: dbItem.price,
        uniqueCartId: `recalled-${order.id}-${idx}`, notes: dbItem.notes || ''
    }));
    setCart(recreatedCart);
    let orderType: 'dine_in' | 'to_go' = 'dine_in';
    if (order.order_type === 'to_go' || order.table_number.toLowerCase().includes('to go')) orderType = 'to_go';
    setTxn({ method: null, orderType: orderType, tableNum: order.table_number, tipAmount: 0 });
    setCurrentOrderId(order.id);
    setIsOrderListOpen(false);
  };

  const handleRefund = async (order: any) => {
      if (!confirm(`Refund Order #${order.order_number}?`)) return;
      const res = await refundOrder(order.id, order.transaction_id, order.total_amount);
      if (res.success) { alert("Refunded"); setIsOrderListOpen(false); }
      else alert("Failed: " + res.error);
  };

  const resetFlow = () => {
    setIsOrderTypeOpen(false); setIsTableNumOpen(false); setIsTipOpen(false); 
    setIsCashModalOpen(false); setSelectedItemForMod(null); setShowDayWarning(false);
    // âœ¨ [ë³µêµ¬ë¨] ì·¨ì†Œ/ë¦¬ì…‹ ì‹œ ì†ë‹˜ í™”ë©´ë„ ì¹´íŠ¸ë¡œ ë³µê·€
    sendState('CART', cart, getSubtotal());
  };

  const handleLogout = () => { setCurrentEmployee(null); setCart([]); setCurrentOrderId(null); };

  return {
    currentEmployee, setCurrentEmployee, cart, categories, menuItems, modifiersObj,
    selectedCategory, setSelectedCategory, isLoading, currentOrderId, 
    isOrderListOpen, setIsOrderListOpen, txn,
    isOrderTypeOpen, setIsOrderTypeOpen, isTableNumOpen, setIsTableNumOpen,
    isTipOpen, setIsTipOpen, isCashModalOpen, setIsCashModalOpen,
    isPhoneOrderModalOpen, setIsPhoneOrderModalOpen,
    selectedItemForMod, closeModifierModal, editingNoteItem, setEditingNoteItem,
    showDayWarning, setShowDayWarning, warningTargetDay,
    isCardProcessing, cardStatusMessage,
    addToCart, removeFromCart, handleSaveNote, handleItemClick, getSubtotal,
    handlePhoneOrderClick: () => cart.length ? setIsPhoneOrderModalOpen(true) : alert("Empty"), 
    handlePhoneOrderConfirm,
    handleRecallOrder, handleRefundOrder: handleRefund,
    handlePaymentStart, handleOrderTypeSelect, handleTableNumConfirm, handleTipSelect,
    handleCashPaymentConfirm, resetFlow, handleLogout,
    
    // âœ¨ ì·¨ì†Œ í•¨ìˆ˜ ë‚´ë³´ë‚´ê¸°
    handleCancelPayment: cancelPayment 
  };
}

==================================================
FILE PATH: src\hooks\useTransaction.ts
==================================================
import { useState, useRef } from 'react'; // useRef ì¶”ê°€ë¨
import { CartItem, Employee } from '@/lib/types';

const PRINTER_SERVER_URL = 'http://localhost:4000/print';

export function useTransaction() {
  const [isCardProcessing, setIsCardProcessing] = useState(false);
  const [cardStatusMessage, setCardStatusMessage] = useState('');
  
  // âœ¨ [ì¶”ê°€] ì·¨ì†Œí•  ë•Œ í•„ìš”í•œ IDë¥¼ ì €ì¥í•˜ëŠ” ê¸ˆê³ 
  const currentPaymentIntentIdRef = useRef<string | null>(null);
  // âœ¨ [ì¶”ê°€] "ì·¨ì†Œ ë²„íŠ¼ ëˆŒë €ë‹ˆ?" í™•ì¸ìš© ê¹ƒë°œ
  const isCancelledRef = useRef(false);

  // 1. ì£¼ë¬¸ ì²˜ë¦¬ (ê¸°ì¡´ê³¼ ë™ì¼í•˜ì§€ë§Œ ì •ì„ ë²„ì „ ìœ ì§€)
  const processOrder = async (
      cart: CartItem[], 
      subtotal: number, 
      tip: number, 
      paymentMethod: 'CASH' | 'CARD' | 'PENDING', 
      orderType: string, 
      tableNum: string, 
      employee: Employee | null,
      orderId: string | null = null,
      transactionId: string | null = null,
      status: 'open' | 'paid' | 'processing' = 'paid',
      printScope: 'ALL' | 'KITCHEN' | 'RECEIPT' | 'NONE' = 'ALL' 
  ) => {
      const creditCardFee = paymentMethod === 'CARD' ? subtotal * 0.03 : 0;
      const finalTotal = subtotal + creditCardFee + tip;
      
      let newOrderNumber = '';
      let savedOrderId = orderId; 

      try {
          let saveRes;
          const bodyData = {
               items: cart, subtotal, tax: creditCardFee, tip, total: finalTotal,
               paymentMethod, transactionId, orderType, tableNum,
               employeeName: employee?.name || 'Unknown', status
          };

          if (orderId) {
             saveRes = await fetch('/api/orders/update', {
                 method: 'POST', headers: { 'Content-Type': 'application/json' },
                 body: JSON.stringify({ orderId, ...bodyData })
             });
          } else {
             saveRes = await fetch('/api/orders/create', {
                 method: 'POST', headers: { 'Content-Type': 'application/json' },
                 body: JSON.stringify(bodyData)
             });
          }
          
          const result = await saveRes.json();
          if (!result.success) throw new Error(result.error || "DB Save Failed");
          
          newOrderNumber = result.orderNumber || result.order?.order_number;
          savedOrderId = result.orderId || result.order?.id || orderId; 

          if (!savedOrderId) throw new Error("Critical Error: Server did not return Order ID.");

          if (printScope !== 'NONE') {
              try {
                  await fetch(PRINTER_SERVER_URL, { 
                      method: 'POST', headers: { 'Content-Type': 'application/json' },
                      body: JSON.stringify({
                          items: cart, orderNumber: newOrderNumber, tableNumber: tableNum, orderType,
                          subtotal, tax: creditCardFee, tipAmount: tip, totalAmount: finalTotal, 
                          paymentMethod, employeeName: employee?.name || 'Unknown',
                          date: new Date().toLocaleString(),
                          printKitchen: printScope === 'KITCHEN' || printScope === 'ALL',
                          printReceipt: printScope === 'RECEIPT' || printScope === 'ALL'
                      })
                  });
              } catch (printError) { console.error("âš ï¸ Print Ignored:", printError); }
          }
          return { success: true, orderNumber: newOrderNumber, orderId: savedOrderId };
      } catch (error: any) {
          console.error("Process Order Error:", error);
          return { success: false, error: error?.message || "Unknown Error" };
      }
  };

  // 2. í™˜ë¶ˆ í•¨ìˆ˜
  const refundOrder = async (orderId: string, paymentIntentId: string, amount: number) => {
      try {
          const res = await fetch('/api/stripe/refund', {
              method: 'POST', headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ orderId, paymentIntentId, amount })
          });
          return await res.json();
      } catch (e: any) { return { success: false, error: e.message }; }
  };

  // âœ¨ [ì‹ ê·œ] ê²°ì œ ì·¨ì†Œ í•¨ìˆ˜
  const cancelPayment = async () => {
      // ê¹ƒë°œì„ ë“¤ì–´ì„œ "ê·¸ë§Œí•´!"ë¼ê³  ì•Œë¦¼
      isCancelledRef.current = true;
      setCardStatusMessage("Cancelling...");

      const pid = currentPaymentIntentIdRef.current;
      if (pid) {
          try {
              await fetch('/api/stripe/cancel', {
                  method: 'POST', headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({ paymentIntentId: pid })
              });
          } catch (e) { console.error("Cancel API failed", e); }
      }
      setIsCardProcessing(false);
  };

  // ìƒíƒœê°’ê³¼ í•¨ìˆ˜ë“¤ ë‚´ë³´ë‚´ê¸° (refë„ í•¨ê»˜ ë‚´ë³´ë‚´ì„œ ë¡œì§ì—ì„œ ì”ë‹ˆë‹¤)
  return { 
      isCardProcessing, setIsCardProcessing, 
      cardStatusMessage, setCardStatusMessage, 
      processOrder, refundOrder, cancelPayment, // cancelPayment ì¶”ê°€ë¨
      currentPaymentIntentIdRef, isCancelledRef // ë¡œì§ ì œì–´ìš©
  };
}

==================================================
FILE PATH: src\lib\csvParser.ts
==================================================
// src/lib/csvParser.ts
import fs from 'fs';
import path from 'path';
import Papa from 'papaparse';
import { Category, MenuItem, ModifierGroup, ModifierOption } from './types';

// CSV íŒŒì‹± í—¬í¼
const parseCSV = async <T>(fileName: string): Promise<T[]> => {
    try {
        const filePath = path.join(process.cwd(), 'public/data', fileName);
        if (!fs.existsSync(filePath)) return [];

        const fileContent = fs.readFileSync(filePath, 'utf8');
        const { data } = Papa.parse(fileContent, {
            header: true,
            skipEmptyLines: true,
            dynamicTyping: true,
        });
        return data as T[];
    } catch (error) {
        console.error(`Error loading ${fileName}:`, error);
        return [];
    }
};

export const getKioskData = async () => {
    // 1. ëª¨ë“  CSV ë°ì´í„° ë¡œë“œ
    const rawCategories = await parseCSV<any>('Category.csv');
    const rawItems = await parseCSV<any>('Items.csv');
    const rawModifiers = await parseCSV<any>('Modifier.csv');

    // -------------------------------------------------------
    // 2. Modifier ë°ì´í„° ì •ë¦¬ (Group Name -> Option List)
    // -------------------------------------------------------
    const modifiersMap = new Map<string, ModifierGroup>();

    rawModifiers.forEach((row: any) => {
        // CSV ì»¬ëŸ¼ ë§¤ì¹­ (ëŒ€ì†Œë¬¸ì/ë„ì–´ì“°ê¸° ìœ ì—° ëŒ€ì‘)
        const groupName = (row['Modifier Group Name'] || row.GroupName || '').trim();
        const optionName = (row.Modifier || row.OptionName || '').trim();
        const price = row.Price || 0;

        if (!groupName || !optionName) return;

        if (!modifiersMap.has(groupName)) {
            modifiersMap.set(groupName, {
                name: groupName,
                options: [],
            });
        }
        modifiersMap.get(groupName)?.options.push({
            name: optionName,
            price: price
        });
    });

    // -------------------------------------------------------
    // 3. Item ë°ì´í„° ì •ë¦¬ (POS Name -> Item Object)
    // -------------------------------------------------------
    const itemsMap = new Map<string, any>();

    rawItems.forEach((row: any) => {
        // 'POS Name ' ì²˜ëŸ¼ ë’¤ì— ê³µë°±ì´ ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ trim() í•„ìˆ˜
        const posNameKey = (row['POS Name '] || row['POS Name'] || row.POSName || '').trim();

        if (posNameKey) {
            itemsMap.set(posNameKey, row);
        }
    });

    // -------------------------------------------------------
    // 4. Category ë°ì´í„° íŒŒì‹± ë° ìµœì¢… êµ¬ì¡° ìƒì„±
    // Category.csvëŠ” Headerê°€ ì¹´í…Œê³ ë¦¬ëª…, ê·¸ ì•„ë˜ê°€ Item Nameë“¤ì„
    // -------------------------------------------------------

    // PapaParse ê²°ê³¼ì¸ rawCategoriesëŠ” [{Header1: Item1, Header2: Item1}, ...] í˜•íƒœì˜ í–‰ ë¦¬ìŠ¤íŠ¸ì„.
    // ì´ë¥¼ ì¹´í…Œê³ ë¦¬ë³„ë¡œ ëª¨ìœ¼ê¸° ìœ„í•´ í—¤ë”(Category Names)ë¥¼ ë¨¼ì € ì¶”ì¶œí•©ë‹ˆë‹¤.
    const categoryNames = rawCategories.length > 0 ? Object.keys(rawCategories[0]) : [];

    const categories: Category[] = [];
    const allItems: MenuItem[] = []; // ì „ì²´ ì•„ì´í…œ ë¦¬ìŠ¤íŠ¸ (í™”ë©´ í‘œì‹œìš©)

    categoryNames.forEach((catName) => {
        if (!catName) return;

        const categoryItems: MenuItem[] = [];

        // ê° í–‰(Row)ì„ ìˆœíšŒí•˜ë©° í•´ë‹¹ ì»¬ëŸ¼(catName)ì— ìˆëŠ” ì•„ì´í…œ ì´ë¦„ì„ ê°€ì ¸ì˜´
        rawCategories.forEach((row: any) => {
            const itemPosName = (row[catName] || '').trim();
            if (!itemPosName) return; // ë¹ˆ ì…€ ê±´ë„ˆëœ€

            // Items.csvì—ì„œ í•´ë‹¹ ì´ë¦„ì˜ ì •ë³´ ì°¾ê¸°
            const itemData = itemsMap.get(itemPosName);

            if (itemData) {
                // Modifier Groups íŒŒì‹± ("Group1, Group2" -> ["Group1", "Group2"])
                let modGroups: string[] = [];
                const rawGroupStr = itemData['Modifier Groups'] || itemData.ModifierGroups;
                if (rawGroupStr && typeof rawGroupStr === 'string') {
                    modGroups = rawGroupStr.split(',').map(s => s.trim()).filter(s => s.length > 0);
                }

                const newItem: MenuItem = {
                    id: itemData['Clover ID'] || itemPosName,
                    posName: itemPosName,
                    name: itemData['Real Name'] || itemPosName, // í™”ë©´ì—” Real Name ìš°ì„ 
                    price: itemData.Price || 0,
                    category: catName,
                    description: itemData.Description || undefined,
                    modifierGroups: modGroups,
                    image: '/placeholder.png' // ì´ë¯¸ì§€ URLì´ ìˆë‹¤ë©´ itemData['ImageURL'] ì‚¬ìš©
                };

                categoryItems.push(newItem);
                allItems.push(newItem);
            } else {
                // console.warn(`Item not found in Items.csv: ${itemPosName} (Category: ${catName})`);
            }
        });

        if (categoryItems.length > 0) {
            categories.push({
                id: catName,
                name: catName,
                items: categoryItems
            });
        }
    });

    return { categories, items: allItems, modifiersMap };
};

==================================================
FILE PATH: src\lib\dataFetcher.ts
==================================================
import { createClient } from '@supabase/supabase-js';
import { Category, MenuItem, ModifierGroup } from './types';

const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
);

// âœ¨ ê³µí†µ: DB ë°ì´í„°ë¥¼ ìš°ë¦¬ ì•±ì˜ MenuItem íƒ€ì…ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
const mapToMenuItem = (item: any, catName: string, modGroups: string[]): MenuItem => ({
  id: item.id,
  name: item.name,
  posName: item.pos_name,
  price: item.price,
  category: catName,
  description: item.description,
  image: item.image_url || '/placeholder.png',
  modifierGroups: modGroups,
  sort_order: item.sort_order,
  is_available: item.is_available,
  clover_id: item.clover_id
});

// âœ¨ ê³µí†µ: ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ë¡œì§ (ë‚´ë¶€ìš©)
const fetchMenuData = async (isKioskMode: boolean) => {
  // 1. ì¿¼ë¦¬ ì‘ì„±
  let query = supabase
    .from('categories')
    .select(`
      id, 
      name,
      sort_order,
      items (
        id, 
        name, 
        pos_name, 
        price, 
        description, 
        image_url, 
        sort_order,
        is_available,
        is_kiosk_visible, 
        is_pos_visible,
        clover_id,  
        item_modifier_groups (
          modifier_groups (
            name,
            modifiers (name, price, sort_order)
          )
        )
      )
    `)
    .order('sort_order', { ascending: true });

  const { data: categoriesData, error } = await query;

  if (error) {
    console.error("âŒ DB Fetch Error:", error.message);
    return { categories: [], items: [], modifiersObj: {} };
  }

  const categories: Category[] = [];
  const allItems: MenuItem[] = [];
  const modifiersObj: { [key: string]: ModifierGroup } = {};

  categoriesData.forEach((cat: any) => {
    // âœ¨ [í•„í„°ë§ í•µì‹¬] ëª¨ë“œì— ë”°ë¼ ì•„ì´í…œ ê±¸ëŸ¬ë‚´ê¸°
    const rawItems = cat.items || [];
    const filteredItems = rawItems.filter((item: any) => {
      if (isKioskMode) {
        // í‚¤ì˜¤ìŠ¤í¬ ëª¨ë“œë©´: is_kiosk_visibleì´ trueì¸ ê²ƒë§Œ + í’ˆì ˆëœ ê²ƒë„ ë³´ì—¬ì¤„ì§€ëŠ” ì„ íƒ(ì¼ë‹¨ ë³´ì—¬ì¤Œ)
        return item.is_kiosk_visible !== false; 
      } else {
        // POS ëª¨ë“œë©´: is_pos_visibleì´ trueì¸ ê²ƒë§Œ (ì§ì›ìš© ìˆ¨ê¹€ ë©”ë‰´ ì²˜ë¦¬ ê°€ëŠ¥)
        return item.is_pos_visible !== false;
      }
    });

    // ì•„ì´í…œì´ í•˜ë‚˜ë„ ì—†ëŠ” ì¹´í…Œê³ ë¦¬ëŠ” ê±´ë„ˆë›¸ ìˆ˜ë„ ìˆì§€ë§Œ, ì¼ë‹¨ ë¹ˆ ì¹´í…Œê³ ë¦¬ë„ í‘œì‹œ
    categories.push({ 
      id: cat.id, 
      name: cat.name,
      items: [] 
    });

    // ì •ë ¬
    filteredItems.sort((a: any, b: any) => (Number(a.sort_order ?? 999) - Number(b.sort_order ?? 999)));

    filteredItems.forEach((item: any) => {
      const modGroups: string[] = [];

      if (item.item_modifier_groups) {
        item.item_modifier_groups.forEach((relation: any) => {
          const group = relation.modifier_groups;
          if (group) {
            modGroups.push(group.name);
            if (!modifiersObj[group.name]) {
              const sortedModifiers = (group.modifiers || []).sort(
                (a: any, b: any) => Number(a.sort_order ?? 0) - Number(b.sort_order ?? 0)
              );
              modifiersObj[group.name] = {
                name: group.name,
                options: sortedModifiers.map((m: any) => ({ name: m.name, price: m.price }))
              };
            }
          }
        });
      }

      allItems.push(mapToMenuItem(item, cat.name, modGroups));
    });
  });

  return { categories, items: allItems, modifiersObj };
};

// -----------------------------------------------------
// ğŸš€ ì™¸ë¶€ì—ì„œ ì‚¬ìš©í•˜ëŠ” í•¨ìˆ˜ë“¤ (ì´ì œ 2ê°œë¡œ ë‚˜ë‰©ë‹ˆë‹¤!)
// -----------------------------------------------------

// 1. ì†ë‹˜ìš© (í‚¤ì˜¤ìŠ¤í¬): ìˆ¨ê¹€ ì²˜ë¦¬ëœ ë©”ë‰´ëŠ” ì•ˆ ê°€ì ¸ì˜´
export const getKioskData = async () => {
  return await fetchMenuData(true);
};

// 2. ì§ì›ìš© (POS): ëª¨ë“  ë©”ë‰´ë¥¼ ê°€ì ¸ì˜´ (ì„¤ì •ì— ë”°ë¼ POS ìˆ¨ê¹€ì€ ê°€ëŠ¥)
export const getPosData = async () => {
  return await fetchMenuData(false);
};

==================================================
FILE PATH: src\lib\imageUploader.ts
==================================================
import { createClient } from '@supabase/supabase-js';

const supabase = createClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
);

export const uploadMenuImage = async (file: File, path: string) => {
    const fileExt = file.name.split('.').pop();
    const fileName = `${Date.now()}.${fileExt}`; // íŒŒì¼ëª… ì¤‘ë³µ ë°©ì§€
    const filePath = `${path}/${fileName}`;

    const { error } = await supabase.storage
        .from('menu-images') // ì•„ê¹Œ ë§Œë“  ë²„í‚· ì´ë¦„
        .upload(filePath, file);

    if (error) {
        console.error('Upload Error:', error);
        return null;
    }

    // ì—…ë¡œë“œëœ ì´ë¯¸ì§€ì˜ ê³µê°œ URL ê°€ì ¸ì˜¤ê¸°
    const { data } = supabase.storage
        .from('menu-images')
        .getPublicUrl(filePath);

    return data.publicUrl;
};

==================================================
FILE PATH: src\lib\printer-client.ts
==================================================


==================================================
FILE PATH: src\lib\types.ts
==================================================
// src/lib/types.ts

// 1. ì˜µì…˜ ê´€ë ¨ íƒ€ì…
export interface ModifierOption {
  name: string;
  price: number;
}

export interface ModifierGroup {
  name: string;
  options: ModifierOption[];
}

// 2. ë©”ë‰´ ì•„ì´í…œ
export interface MenuItem {
  id: string;
  name: string;
  posName?: string;
  price: number;
  category: string;
  description?: string;
  image?: string;
  image_url?: string; // ì´ë¯¸ì§€ URL í˜¸í™˜ì„± ì¶”ê°€
  modifierGroups: string[];
  sort_order?: number;
  is_available?: boolean;
  clover_id?: string;
  pos_name?: string;

  // âœ¨ [ì¶”ê°€] ë…¸ì¶œ ì—¬ë¶€ ì„¤ì •
  is_kiosk_visible?: boolean;
  is_pos_visible?: boolean;
}

// âœ¨ [ì¶”ê°€] Employee íƒ€ì… ì •ì˜
export interface Employee {
  id: number;
  name: string;
  role: string;     // 'manager', 'staff' ë“±
  pin?: string;     // ë¡œê·¸ì¸ìš© PIN (ì„ íƒ ì‚¬í•­)
}

// 3. ì¹´í…Œê³ ë¦¬
export interface Category {
  id: string;
  name: string;
  items: MenuItem[];
}

// 4. ì¥ë°”êµ¬ë‹ˆ ì•„ì´í…œ (âœ¨ ì—¬ê¸°ë¥¼ ìˆ˜ì •í•©ë‹ˆë‹¤!)
export interface CartItem extends MenuItem {
  uniqueCartId: string;
  selectedModifiers: ModifierOption[];
  quantity: number;
  totalPrice: number;
  
  // âœ¨ [ìˆ˜ì •] notesì™€ groupIdë¥¼ ì—¬ê¸°ë¡œ ì˜®ê¸°ë©´ ëª¨ë“  ì—ëŸ¬ê°€ ì‚¬ë¼ì§‘ë‹ˆë‹¤.
  // ?ê°€ ë¶™ì–´ìˆìœ¼ë¯€ë¡œ ê°’ì´ ì—†ì–´ë„ ì—ëŸ¬ê°€ ë‚˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
  notes?: string;   
  groupId?: string; 
}

// 5. í™•ì¥ ì•„ì´í…œ (ì´ì œ CartItemì´ ëª¨ë“  ê±¸ ê°–ê³  ìˆìœ¼ë¯€ë¡œ ë¹ˆ ì¸í„°í˜ì´ìŠ¤ì—¬ë„ ë©ë‹ˆë‹¤)
// ê¸°ì¡´ ì½”ë“œì™€ì˜ í˜¸í™˜ì„±ì„ ìœ„í•´ ë‚¨ê²¨ë‘ê¸°ë§Œ í•©ë‹ˆë‹¤.
export interface ExtendedCartItem extends CartItem {
  // ë‚´ìš©ì€ CartItemì—ì„œ ìƒì†ë°›ìœ¼ë¯€ë¡œ ë¹„ì›Œë„ ë©ë‹ˆë‹¤.
}

==================================================
FILE PATH: src\lib\usePosSync.ts
==================================================
// src/lib/usePosSync.ts
import { CartItem } from '@/lib/types';

export const usePosSync = () => {
  // í˜„ì¬ëŠ” Supabase ì„¤ì • ì „ì´ë¯€ë¡œ, ì—ëŸ¬ë¥¼ ë§‰ê¸° ìœ„í•œ ê°€ì§œ í•¨ìˆ˜ë§Œ ì œê³µí•©ë‹ˆë‹¤.
  
  const broadcastCart = async (cart: CartItem[], total: number) => {
    // console.log("Broadcasting cart:", total); // ë‚˜ì¤‘ì— ì‹¤ì œ ì „ì†¡ ì½”ë“œë¡œ ëŒ€ì²´
  };

  const broadcastStatus = async (status: string, message: string = '') => {
    // console.log("Broadcasting status:", status);
  };

  // ë‚˜ì¤‘ì— í•„ìš”í•  ë•Œ ì§„ì§œ Supabase ê°ì²´ì™€ ì±„ë„ëª…ìœ¼ë¡œ êµì²´í•˜ì„¸ìš”.
  return { 
    broadcastCart, 
    broadcastStatus, 
    supabase: null, 
    CHANNEL_NAME: 'pos-sync-room-1' 
  };
};

==================================================
FILE PATH: src\styles\globals.css
==================================================
@import "tailwindcss";
@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  --background: #ffffff;
  --foreground: #171717;
}

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);
}

@media (prefers-color-scheme: dark) {
  :root {
    --background: #0a0a0a;
    --foreground: #ededed;
  }
}

body {
  background: var(--background);
  color: var(--foreground);
  font-family: Arial, Helvetica, sans-serif;
}

html,
body {
  cursor: default !important;
  /* ê¸°ë³¸ í™”ì‚´í‘œ */
}

button,
a,
[role="button"] {
  cursor: pointer !important;
  /* í´ë¦­ ê°€ëŠ¥í•œ ê³³ì€ ì†ê°€ë½ ëª¨ì–‘ */
}

/* [ìˆ˜ì •] ê¸°ë³¸ ê¸€ì”¨ ìƒ‰ìƒì„ ë” ì§„í•˜ê²Œ ì„¤ì • */
body {
  color: #1f2937;
  /* Tailwind gray-800 ì™€ ë™ì¼ (ì§„í•œ íšŒìƒ‰) */
}

/* [New] 1920x1080 í•´ìƒë„ ëŒ€ì‘ (ê¸°ë³¸ 16px -> 12pxë¡œ 75% ì¶•ì†Œ) */
@media (max-width: 1920px) {
  html {
    font-size: 12px;
  }
}

==================================================
FILE PATH: src\utils\supabase\server-client.ts
==================================================
// src/utils/supabase/middleware.ts
import { createServerClient } from '@supabase/ssr';
import { NextResponse, type NextRequest } from 'next/server';

export async function updateSession(request: NextRequest) {
    let supabaseResponse = NextResponse.next({
        request,
    });

    const supabase = createServerClient(
        process.env.NEXT_PUBLIC_SUPABASE_URL!,
        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
        {
            cookies: {
                getAll() {
                    return request.cookies.getAll();
                },
                setAll(cookiesToSet) {
                    cookiesToSet.forEach(({ name, value, options }) => request.cookies.set(name, value));
                    supabaseResponse = NextResponse.next({ request });
                    cookiesToSet.forEach(({ name, value, options }) => supabaseResponse.cookies.set(name, value, options));
                },
            },
        }
    );

    // í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
    const { data: { user } } = await supabase.auth.getUser();

    // 1. ê´€ë¦¬ì í˜ì´ì§€(/admin)ì— ì ‘ê·¼í•˜ëŠ”ë° ë¡œê·¸ì¸ì´ ì•ˆ ëœ ê²½ìš° -> ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì«“ì•„ëƒ„
    if (request.nextUrl.pathname.startsWith('/admin') && !user) {
        const url = request.nextUrl.clone();
        url.pathname = '/login';
        return NextResponse.redirect(url);
    }

    // 2. ì´ë¯¸ ë¡œê·¸ì¸í–ˆëŠ”ë° ë¡œê·¸ì¸ í˜ì´ì§€(/login)ì— ê°€ë ¤ëŠ” ê²½ìš° -> ê´€ë¦¬ì í˜ì´ì§€ë¡œ ë³´ëƒ„
    if (request.nextUrl.pathname.startsWith('/login') && user) {
        const url = request.nextUrl.clone();
        url.pathname = '/admin';
        return NextResponse.redirect(url);
    }

    return supabaseResponse;
}
